{"version":3,"file":"qute-0.9.0.min.js","sources":["../../core/runtime/src/error.js","../../core/commons/lib/index.esm.js","../../core/runtime/src/utils.js","../../core/runtime/src/update.js","../../core/runtime/src/context.js","../../core/runtime/src/registry.js","../../core/runtime/src/binding.js","../../core/runtime/src/emit.js","../../core/runtime/src/rendering.js","../../core/runtime/src/list.js","../../core/runtime/src/vm.js","../../core/runtime/src/index.js"],"sourcesContent":["\nfunction ERR() {\n\tERR.resolve.apply(null, arguments);\n}\n\nERR.resolve = function() {\n\tthrow new Error('Qute Error: '+Array.prototype.slice.call(arguments));\n}\n\nexport default ERR;\n","var CAMEL_TO_KEBAB_RX = /([\\$A-Za-z0-9])([A-Z])/g;\n\nfunction camelToKebab(value) {\n\treturn value.replace(CAMEL_TO_KEBAB_RX, '$1-$2').toLowerCase();\n}\n\nfunction capitalizeFirst(value) {\n\treturn value[0].toUpperCase()+value.substring(1);\n}\n\nfunction kebabToCamel(value) {\n\tvar i = value.indexOf('-');\n\tif (i == -1) { return value; }\n\tvar out = value.substring(0, i);\n\tvar s = i+1;\n\ti = value.indexOf('-', s);\n\twhile (i > -1) {\n\t\tout += capitalizeFirst(value.substring(s, i));\n\t\ts = i+1;\n\t\ti = value.indexOf('-', s);\n\t}\n\tif (s < value.length) {\n\t\tout += capitalizeFirst(value.substring(s));\n\t}\n\treturn out;\n}\n\nexport { camelToKebab, capitalizeFirst, kebabToCamel };\n//# sourceMappingURL=index.esm.js.map\n","\nimport { kebabToCamel } from '@qutejs/commons';\n\nfunction stopEvent(e) {\n\te.preventDefault();\n\te.stopPropagation();\n}\n\nfunction chainFnAfter(fn, prevFn) {\n\treturn prevFn ? function(arg) {\n\t\tprevFn(arg);\n\t\treturn fn(arg);\n\t} : fn;\n}\n\nfunction closestVM(el) {\n\twhile (el && !el.__qute__) {\n\t\tel = el.parentNode;\n\t}\n\treturn el && el.__qute__;\n}\n\n// filter is a an array whoes first item is true or false. See compiler x-attrs encoding\nfunction filterKeys(obj, filter) {\n\tvar keys = Object.keys(obj);\n\tif (filter) {\n\t\tvar incl = filter[0]; // true: include, false: exclude\n\t\treturn keys.filter(function(key) {\n\t\t\treturn (filter.indexOf(key, 1) > -1) === incl;\n\t\t});\n\t} else {\n\t\treturn keys;\n\t}\n}\n\nexport { stopEvent, chainFnAfter, closestVM, filterKeys, kebabToCamel };\n","import window from '@qutejs/window';\nimport ERR from './error.js';\n\n\nvar UpdateQueue = {\n\tmaxNestedLoops: 50,\n\tqueue: [],\n\tafter: null, // routines to run after the queue is processed\n\tpush: function(op) {\n\t\tif (!this.queue.length) { // schedule\n\t\t\tvar self = this;\n\t\t\twindow.setTimeout(function() {\n\t\t\t\tself.run();\n\t\t\t}, 0);\n\t\t}\n\t\tthis.queue.push(op);\n\t},\n\t// Add a callback to be invoked after the current queue run. If the queue is empty then the callback is immediately run\n\t// As queue tasks may push tasks into the queue, pushing a regular task in the queue after an update does not guarantee\n\t// the task will be run at the end.\n\t// This is usefull to test (to make assertion after all the uopdates where done)\n\t// Usually this method is called after an update\n\trunAfter: function(runAfterCb) {\n\t\tif (!this.queue.length) {\n\t\t\trunAfterCb();\n\t\t} else {\n\t\t\tif (!this.after) this.after = [runAfterCb];\n\t\t\telse this.after.push(runAfterCb);\n\t\t}\n\t},\n\trun: function() {\n\t\tvar queue = this.queue;\n\t\tvar cnt = queue.length;\n\t\tvar max = cnt+this.maxNestedLoops; // allowed iteration to avoid infintite loops\n\t\twhile (queue.length > 0) {\n\t\t\tqueue[0]();\n\t\t\t// remove from queue after execution\n\t\t\tqueue.shift();\n\t\t\tif (++cnt > max) ERR(30);\n\t\t}\n\n\t\t// run the 'after' routines if any\n\t\tif (this.after) {\n\t\t\tvar after = this.after;\n\t\t\tfor (var i=0,l=after.length; i<l; i++) {\n\t\t\t\tafter[i]();\n\t\t\t}\n\t\t\tthis.after = null; // clear the after array\n\t\t}\n\t}\n\n}\n\nexport default UpdateQueue;\n","import window from '@qutejs/window';\nimport ERR from './error.js';\n\nexport default function Context(data) {\n\tif (data) Object.assign(this, data);\n\tthis.$topics = {lifecycle:[]}; // lifecycle is a bultin topic\n}\n\nContext.prototype = {\n\tpost: function(topic, msg, data) {\n\t\tvar listeners = this.$topics[topic];\n\t\tif (!listeners) ERR(38, topic);\n\t\tfor (var i=0,l=listeners.length;i<l;i++) {\n\t\t\tif (listeners[i](msg, data) === false) {\n\t\t\t\tbreak; // stop if one of the listeners returns false\n\t\t\t}\n\t\t}\n\t},\n\tpostAsync: function(topic, msg, data) {\n\t\tvar self = this;\n\t\twindow.setTimeout(function() { self.post(topic, msg, data); }, 0);\n\t},\n\tsubscribe: function(topic, listenerFn) {\n\t\tvar listeners = this.$topics[topic];\n\t\tif (!listeners) {\n\t\t\tthis.$topics[topic] = listeners = [];\n\t\t}\n\t\tlisteners.push(listenerFn);\n\t\treturn this;\n\t},\n\tsubscribeOnce: function(topic, event, listenerFn) {\n\t\tvar self = this;\n\t\tvar onceSubscription = function(msg, data) {\n\t\t\tif (msg === event) {\n\t\t\t\tlistenerFn(msg, data);\n\t\t\t\tself.unsubscribe(topic, onceSubscription);\n\t\t\t}\n\t\t}\n\t\tthis.subscribe(topic, onceSubscription);\n\t\treturn onceSubscription;\n\t},\n\tunsubscribe: function(topic, listenerFn) {\n\t\tvar listeners = this.$topics[topic];\n\t\tif (listeners) {\n\t\t\tvar i = listeners.indexOf(listenerFn);\n\t\t\tif (i > -1) {\n\t\t\t\tlisteners.splice(i, 1);\n\t\t\t}\n\t\t}\n\t},\n\tfreeze: function() {\n\t\tObject.freeze(this);\n\t}\n}\n","\n\nvar VMS = {};\nvar XTAGS = {};\n\nexport function getTag(tag) {\n\treturn XTAGS[tag];\n}\n\nexport function registerTag(tag, templateFn, isCompiled) {\n\tXTAGS[tag] = templateFn;\n\ttemplateFn.$compiled = !!isCompiled;\n\ttemplateFn.$tag = tag;\n\treturn templateFn;\n}\n\nexport function getVM(tag) {\n\treturn VMS[tag];\n}\n\nexport function registerVM(tag, vm) {\n\tVMS[tag] = vm;\n}\n\nexport function getVMOrTag(tag) {\n\treturn VMS[tag] || XTAGS[tag];\n}\n\nexport function snapshotRegistry() {\n\treturn {VMS: Object.assign({}, VMS), XTAGS: Object.assign({}, XTAGS)};\n}\n\nexport function restoreRegistry(snapshot) {\n\tVMS = snapshot.VMS;\n\tXTAGS = snapshot.XTAGS;\n}\n","import {stopEvent, filterKeys} from './utils.js';\n\nfunction addClassMap(cl, value) {\n\tvar keys = Object.keys(value);\n\tfor (var i=0,l=keys.length; i<l; i++) {\n\t\tvar key = keys[i];\n\t\tvar val = value[key];\n\t\tif (val) cl.add(key); else cl.remove(key);\n\t}\n}\n\nfunction bindClass(elt, value) {\n\tif (!value) return;\n\tvar cl = elt.classList;\n\tif (Array.isArray(value)) {\n\t\tfor (var i=0,l=value.length; i<l; i++) {\n\t\t\tvar val = value[i];\n\t\t\tif (val) {\n\t\t\t\tif (typeof val === 'string') {\n\t\t\t\t\tcl.add(val);\n\t\t\t\t} else { // an object?\n\t\t\t\t\taddClassMap(cl, val);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} else { // an object\n\t\taddClassMap(cl, value);\n\t}\n}\n\nfunction bindStyle(elt, value) {\n\tif (!value) return;\n\tvar style = elt.style;\n\tif (Array.isArray(value)) {\n\t\tfor (var i=0,l=value.length; i<l; i++) {\n\t\t\tObject.assign(style, value[i]);\n\t\t}\n\t} else { // an object\n\t\tObject.assign(style, value);\n\t}\n\n}\n\n// the listeners injected from a vm to a nested functional view\n// must run in parent vm, context not in fucntional view context!\n// This is why we need to use the vm from the closure scope when the listener was created\nexport function createListener(vm, fn) {\n\treturn function(e) {\n\t\tif (fn.call(vm, e) === false) {\n\t\t\tstopEvent(e);\n\t\t}\n\t};\n}\n\nexport function createListeners(vm, $listeners) {\n\tif ($listeners) {\n\t\tfor (var key in $listeners) {\n\t\t\t$listeners[key] = createListener(vm, $listeners[key]);\n\t\t}\n\t}\n\treturn $listeners;\n}\n\nexport function SetText(el, model, expr) {\n\treturn function() {\n\t\tvar val = expr(model);\n\t\tif (val !== el.nodeValue) {\n\t\t\tel.nodeValue = val;\n\t\t}\n\t}\n}\n\nexport function SetAttr(el, model, key, valFn) {\n\treturn function(changedKey) {\n\t\t//if (!changedKey || changedKey === key) {\n\t\t\tvar val = valFn(model);\n\t\t\tif (el.getAttribute(key) !== val) {\n\t\t\t\tif (val == null) {\n\t\t\t\t\tel.removeAttribute(key);\n\t\t\t\t} else {\n\t\t\t\t\tel.setAttribute(key, val);\n\t\t\t\t}\n\t\t\t}\n\t\t//}\n\t}\n}\n\n/*\nexport function SetBindings(el, model, bindFn) {\n\treturn function(changedKey) {\n\t\tvar bindings = bindFn(model);\n\t\tfor (var key in bindings) {\n\t\t\tvar val = bindings[key];\n\t\t\tif (el.getAttribute(key) !== val) {\n\t\t\t\tel.setAttribute(key, val);\n\t\t\t}\n\t\t}\n\t}\n}\n*/\nexport function SetInnerHTML(el, model, valFn) {\n\treturn function() {\n\t\tvar val = valFn(model);\n\t\tif (el.innerHTML !== val) {\n\t\t\tel.innerHTML = val || '';\n\t\t}\n\t}\n}\n\nexport function SetDisplay(el, model, valFn) {\n\treturn function() {\n\t\tvar val = valFn(model);\n\t\tvar display = el.style.display;\n\t\t// backup the current diaply when toggliong OFF to be able to restore if needed\n\t\tif (val) {\n\t\t\tif (display === 'none') {\n\t\t\t\tel.style.display = el.__qute_display || ''; // remove 'none'\n\t\t\t}\n\t\t} else if (display !== 'none') {\n\t\t\tif (el.__qute_display == null) el.__qute_display = display;\n\t\t\tel.style.display = 'none';\n\t\t}\n\t}\n}\n\n\nexport function SetToggle(el, model, valFn) {\n\t// valFn returns a map of attr keys to values\n\treturn function() {\n\t\tvar attrs = valFn(model);\n\t\tvar keys = Object.keys(attrs);\n\t\tfor (var i=0,l=keys.length;i<l;i++) {\n\t\t\tvar key = keys[i];\n\t\t\tif (attrs[key]) {\n\t\t\t\tel.setAttribute(key, key);\n\t\t\t} else {\n\t\t\t\tel.removeAttribute(key);\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport function SetClass(el, model, valFn) {\n\treturn function() {\n\t\t//TODO only if modified\n\t\tbindClass(el, valFn(model));\n\t}\n}\n\nexport function SetStyle(el, model, valFn) {\n\treturn function() {\n\t\t//TODO only if modified\n\t\tbindStyle(el, valFn(model));\n\t}\n}\n\nexport function SetProp(vm, model, key, valFn) {\n\treturn function(changedKey) {\n\t\t//if (!changedKey || changedKey === key) {\n\t\t\tvm.$set(key, valFn(model));\n\t\t//}\n\t}\n}\n\nexport function SetDOMAttrs(el, model, filter) {\n\treturn function() {\n\t\tvar $attrs = model.$attrs;\n\t\tif ($attrs) {\n\t\t\tvar keys = filterKeys($attrs, filter);\n\t\t\tfor (var i=0,l=keys.length; i<l; i++) {\n\t\t\t\tvar key = keys[i];\n\t\t\t\tel.setAttribute(key, $attrs[key]);\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport function SetFuncAttrs($attrs, vm, filter) { // vm is the parent vm (i.e. current model)\n\treturn function() {\n\t\tvar vmAttrs = vm.$attrs;\n\t\tif (vmAttrs) {\n\t\t\tvar keys = filterKeys(vmAttrs, filter);\n\t\t\tfor (var i=0,l=keys.length; i<l; i++) {\n\t\t\t\tvar key = keys[i];\n\t\t\t\t$attrs[key] = vmAttrs[key];\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport function SetFuncAttr($attrs, vm, key, val) { // vm is the parent vm (i.e. current model)\n\treturn function() {\n\t\t$attrs[key] = val(vm);\n\t}\n}\n// TODO set $attrs on VMs\nexport function SetVMAttrs(vm, parentVM, filter) {\n\treturn function() {\n\t\tvar parentAttrs = parentVM.$attrs;\n\t\tif (parentAttrs) {\n\t\t\tvar keys = filterKeys(parentAttrs, filter);\n\t\t\tfor (var i=0,l=keys.length; i<l; i++) {\n\t\t\t\tvar key = keys[i];\n\t\t\t\tvm.$set(key, parentAttrs[key]);\n\t\t\t}\n\t\t}\n\t}\n}\n\n","import window from '@qutejs/window';\nimport ERR from './error.js';\n\n// emitter prototype\nvar Emitter = {\n\temit: function(event, data) {\n\t\tif (!this.$el) ERR(35);\n\t\tthis.$el.dispatchEvent(new window.CustomEvent(event, {bubbles: true, detail: data === undefined ? this : data }));\n\n\t},\n\temitAsync: function(event, data, timeout) {\n\t\tvar self = this;\n\t\twindow.setTimeout(function() { self.emit(event, data); }, timeout || 0);\n\t}\n}\nexport default Emitter;\n","import {document} from '@qutejs/window';\nimport ERR from './error.js';\n\nimport Context from './context.js';\nimport { getVMOrTag, getVM } from './registry.js';\nimport {createListeners, createListener, SetClass, SetStyle, SetDisplay, SetToggle, SetText, SetInnerHTML, SetAttr, SetDOMAttrs, SetFuncAttrs, SetFuncAttr} from './binding.js';\nimport { filterKeys } from './utils.js';\nimport Emitter from './emit.js';\n\nfunction ViewRenderingContext(model, marker, isExpr, changeCb, noCache, xattrs, childrenFn) {\n\n\tvar cache = noCache ? null : {};\n\tvar r = null; // the view rendering context\n\tvar cview = null; // current element\n\treturn function(propKey, initialUpdate) {\n\t\tvar el, viewXTag = isExpr(model);\n\t\tif (viewXTag !== cview) {\n\t\t\tvar parent = marker.parentNode;\n\t\t\tif (r) {\n\t\t\t\tr.$disconnect();\n\t\t\t\tparent.removeChild(marker.previousSibling);\n\t\t\t}\n\t\t\tif (viewXTag) {\n\t\t\t\tr = cache && cache[viewXTag];\n\t\t\t\tif (!r) {\n\t\t\t\t\tr = new Rendering(model);\n\t\t\t\t\tif (cache) cache[viewXTag] = r;\n\t\t\t\t}\n\t\t\t\tel = r.r(viewXTag, xattrs, childrenFn(r));\n\t\t\t\tparent.insertBefore(el, marker);\n\t\t\t\tr.$connect();\n\t\t\t} else {\n\t\t\t\tr = null;\n\t\t\t}\n\n\t\t\tif (changeCb && !initialUpdate) { // avoid calling changeCb the first time the if is rendered\n\t\t\t\tchangeCb.call(model, el && el.__qute__);\n\t\t\t}\n\t\t\tcview = viewXTag;\n\t\t} else if (r) {\n\t\t\t// only update children\n\t\t\tr.$update();\n\t\t}\n\t}\n}\n\nfunction IfRenderingContext(model, start, end, expr, changeCb, _if, _else) {\n\tvar r = null; // the IF / ELSE rendering context\n\tvar state = undefined; // the current IF / ELSE value\n\treturn function(propKey, initialUpdate) {\n\t\tvar newState = !!expr(model);\n\t\tif (newState !== state) {\n\t\t\tr && r.$disconnect();\n\t\t\tvar parent = start.parentNode;\n\t\t\t// remove current if branch\n\t\t\twhile (start.nextSibling && start.nextSibling !== end) {\n\t\t\t\tparent.removeChild(start.nextSibling);\n\t\t\t}\n\t\t\tr = new Rendering(model); // create the IF / ELSE rendering context\n\t\t\tstate = newState;\n\t\t\tvar children = state ? _if(r) : (_else ? _else(r) : []); //_else may not be defined\n\t\t\tfor (var i=0,l=children.length; i<l; i++) {\n\t\t\t\tparent.insertBefore(children[i], end);\n\t\t\t}\n\t\t\tr.$connect();\n\t\t\tif (changeCb && !initialUpdate) { // avoid calling changeCb the first time the if is rendered\n\t\t\t\tchangeCb.call(model, state);\n\t\t\t}\n\t\t} else if (r) {\n\t\t\t// only update children\n\t\t\tr.$update();\n\t\t}\n\t}\n}\n\nfunction ForRenderingContext(model, start, end, listFn, iterationFn) {\n\tvar r = null; // the for rendering context\n\tvar list = null; // the current list\n\treturn function(propKey) {\n\t\tvar newList = listFn(model);\n\t\tif (newList !== list) {\n\t\t\tr && r.$disconnect();\n\t\t\tvar parent = start.parentNode;\n\t\t\t// remove current for content\n\t\t\twhile (start.nextSibling && start.nextSibling !== end) {\n\t\t\t\tparent.removeChild(start.nextSibling);\n\t\t\t}\n\t\t\tr = new Rendering(model); // create the FOR rendering context\n\t\t\tlist = newList;\n\t\t\t// render content\n\t\t\tif (list) {\n\t\t\t\tif (!Array.isArray(list)) {\n\t\t\t\t\t//if (list instanceof List) ERR(25);\n\t\t\t\t\tif (list.$createListFragment) ERR(25);\n\t\t\t\t\tlist = Object.keys(list);\n\t\t\t\t}\n\t\t\t\tif (list.length > 0) {\n\t\t\t\t\tvar l = list.length-1;\n\t\t\t\t\tfor (var i=0; i<l; i++) {\n\t\t\t\t\t\tvar children = iterationFn(list[i], i, true);\n\t\t\t\t\t\tif (children) {\n\t\t\t\t\t\t\tfor (var k=0,ll=children.length; k<ll; k++) {\n\t\t\t\t\t\t\t\tparent.insertBefore(children[k], end);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tvar children = iterationFn(list[i], i, false);\n\t\t\t\t\tif (children) {\n\t\t\t\t\t\tfor (var i=0,l=children.length; i<l; i++) {\n\t\t\t\t\t\t\tparent.insertBefore(children[i], end);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tr.$connect();\n\t\t} else if (r) {\n\t\t\t// just update children\n\t\t\tr.$update();\n\t\t}\n\t}\n}\n\nfunction isVM(obj) {\n\treturn obj && obj.prototype && obj.prototype.__VM__;\n}\n\nfunction appendChildren(parent, children) {\n\tfor (var i=0, l=children.length; i<l; i++) parent.appendChild(children[i]);\n}\nfunction removeRange(from, to) {\n\tvar parent = from.parentNode;\n\twhile (from.nextSibling && from.nextSibling !== to) {\n\t\tparent.removeChild(from.nextSibling);\n\t}\n}\n\nfunction applyListeners(el, vm, listeners, doNotWrap) {\n\tfor (var key in listeners) {\n\t\tvar fn = listeners[key];\n\t\tif (key === 'create') {\n\t\t\tfn.call(el, vm);\n\t\t} else {\n\t\t\tel.addEventListener(key, doNotWrap ? fn : createListener(vm, fn));\n\t\t}\n\t}\n}\n\nfunction extractSlots(children) {\n\tif (children && children.length) {\n\t\tvar namedSlots = {}, nestedCnt = 0, hasContent = false;\n\t\tfor (var i=0,l=children.length; i<l; i++) {\n\t\t\tvar child = children[i];\n\t\t\tvar nodeType = child.nodeType;\n\t\t\tswitch (nodeType) {\n\t\t\t\tcase 1:\n\t\t\t\t\tif (child.nodeName === 'NESTED') { // select only 'nested' elements\n\t\t\t\t\t\tvar slot = child.getAttribute('name') || 'default';\n\t\t\t\t\t\tvar slotChildren = [];\n\t\t\t\t\t\tvar node = child.firstChild;\n\t\t\t\t\t\twhile (node) {\n\t\t\t\t\t\t\tslotChildren.push(node);\n\t\t\t\t\t\t\tnode = node.nextSibling;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tnamedSlots[slot] = slotChildren;\n\t\t\t\t\t\tnestedCnt++;\n\t\t\t\t\t} else {\n\t\t\t\t\t\thasContent = true;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 3:\n\t\t\t\t\tif (child.nodeValue.trim()) hasContent = true;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (nestedCnt) {\n\t\t\treturn namedSlots;\n\t\t} else if (hasContent) { // default slot\n\t\t\tnamedSlots.default = children;\n\t\t\treturn namedSlots;\n\t\t}\n\t}\n\treturn null;\n}\n\n// ==============================================\n\n\nvar RenderingProto = {\n\tx: function(expr) { // expression {{ ... }}\n\t\tvar text = expr(this.vm);\n\t\tvar el = document.createTextNode(text);\n\t\tthis.up(SetText(el, this.vm, expr));\n\t\treturn el;\n\t},\n\tt: function(value) { // text\n\t\treturn document.createTextNode(value);\n\t},\n\tg: function(isFn, xattrs, children) { // dynamic tag using 'is'\n\t\tvar tag = isFn(this.vm);\n\t\tvar XTag = getVMOrTag(tag);\n\t\treturn XTag ? this.v(XTag, xattrs, children) : this.h(tag, xattrs, children);\n\t},\n\th: function(tag, xattrs, children) { // dom node\n\t\tvar el = document.createElement(tag);\n\t\tif (xattrs) {\n\t\t\tvar vm = this.vm;\n\t\t\tfor (var key in xattrs) {\n\t\t\t\tvar up = null;\n\t\t\t\tvar val = xattrs[key];\n\t\t\t\tif (key.charCodeAt(0) === 36) { // $ - extended attribute\n\t\t\t\t\tif (key === '$on') {\n\t\t\t\t\t\tapplyListeners(el, vm, val);\n\t\t\t\t\t} else if (key === '$class') {\n\t\t\t\t\t\tup = SetClass(el, vm, val);\n\t\t\t\t\t} else if (key === '$style') {\n\t\t\t\t\t\tup = SetStyle(el, vm, val);\n\t\t\t\t\t} else if (key === '$show') {\n\t\t\t\t\t\tup = SetDisplay(el, vm, val);\n\t\t\t\t\t} else if (key === '$toggle') {\n\t\t\t\t\t\tup = SetToggle(el, vm, val);\n\t\t\t\t\t} else if (key === '$html') {\n\t\t\t\t\t\tup = SetInnerHTML(el, vm, val);\n\t\t\t\t\t} else if (key === '$attrs') {\n\t\t\t\t\t\tup = SetDOMAttrs(el, vm, val);\n\t\t\t\t\t} else if (key === '$listeners') {\n\t\t\t\t\t\t//TODO filter like for $attrs\n\t\t\t\t\t\t//TODO value must be a function ... and not use directly vm.$listeners\n\t\t\t\t\t\tapplyListeners(el, vm, vm.$listeners, true); // do not wrap listeners fns (already wrapped by the parent context)\n\t\t\t\t\t\t//TODO\n\t\t\t\t\t} else if (key === '$channel') {\n\t\t\t\t\t\tERR(28, tag);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tERR(26, key);\n\t\t\t\t\t}\n\t\t\t\t} else if (typeof val === 'function') { // a dynamic binding\n\t\t\t\t\tup = SetAttr(el, vm, key, val);\n\t\t\t\t} else {\n\t\t\t\t\tel.setAttribute(key, val);\n\t\t\t\t}\n\t\t\t\tif (up) {\n\t\t\t\t\tthis.up(up)(); // push then execute\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (children) appendChildren(el, children);\n\t\treturn el;\n\t},\n\t// element with static children (innerHTML is set from the subtree)\n\thh:function(tag, xattrs, content, type) {\n\t\tvar el = this.h(tag, xattrs);\n\t\tif (type) { // convert can be a function to convert the content before injecting in the dom\n\t\t\tvar converter = Context.Qute.converters[type];\n\t\t\tif (!converter) {\n\t\t\t\tERR(27, type);\n\t\t\t}\n\t\t\tcontent = converter(content, this);\n\t\t}\n\t\tel.innerHTML = content;\n\t\treturn el;\n\t},\n\tr: function(tag, xattrs, children) {\n\t\tvar XTag = getVMOrTag(tag);\n\t\tif (!XTag) ERR(23, tag);\n\t\treturn this._v(XTag, xattrs, extractSlots(children));\n\t},\n\tv: function(XTag, xattrs, children) { // xtag is specified as a func reference. TODO No more used\n\t\treturn this._v(XTag, xattrs, extractSlots(children));\n\t},\n\t// vm component\n\t_v: function(XTag, xattrs, slots) { // a vm component (viewmodel)\n\t\tif (isVM(XTag)) {\n\t\t\tvar vm = new XTag(this.vm.$ctx);\n\t\t\treturn vm.$create(this, xattrs, slots);\n\t\t} else if (XTag.$compiled) { // a compiled template\n\t\t\tvar oldVm = this.vm;\n\t\t\tthis.vm = this.functx(this.vm, xattrs, slots);\n\t\t\tvar el = XTag(this, xattrs, slots); // pass xattrs and slots too?\n\t\t\tthis.vm.$el = el;\n\t\t\t// apply root bindings if any (x-class, x-style or x-show)\n\t\t\tif (this.vm.$bindings) {\n\t\t\t\tvar bindings = this.vm.$bindings;\n\t\t\t\tfor (var i=0,l=bindings.length; i<l; i+=2) {\n\t\t\t\t\tvar up = bindings[i](el, oldVm, bindings[i+1]);\n\t\t\t\t\tthis.up(up)();\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (this.vm.$listeners) applyListeners(el, this.vm, this.vm.$listeners, true);\n\t\t\tthis.vm = oldVm;\n\t\t\treturn el;\n\t\t} else { // a hand written function\n\t\t\treturn XTag(this, xattrs, slots);\n\t\t}\n\t},\n\ts: function(slotName, defaultChildren) {\n\t\tvar vm = this.vm;\n\t\tvar slots = vm.$slots;\n\t\tvar children = slots && slots[slotName || 'default'] || defaultChildren;\n\t\tif (children) {\n\t\t\tvar frag = document.createDocumentFragment();\n\t\t\tappendChildren(frag, children);\n\t\t\treturn frag;\n\t\t}\n\t\treturn document.createComment('[slot/]'); // placeholder\n\t},\n\tw: function(isExpr, changeCb, noCache, xattrs, childrenFn) { // dynamic view\n\t\tvar marker = document.createComment('[view/]');\n\t\tvar frag = document.createDocumentFragment();\n\t\tfrag.appendChild(marker);\n\t\tvar viewFrag = ViewRenderingContext(this.vm, marker, isExpr, changeCb, noCache, xattrs, childrenFn)\n\t\tmarker.__qute__ = viewFrag;\n\t\tviewFrag(null, true);\n\t\tthis.up(viewFrag);\n\t\treturn frag;\n\t},\n\ti: function(expr, changeCb, _if, _else) { // if / else\n\t\tvar start = document.createComment('[if]');\n\t\tvar end = document.createComment('[/if]');\n\t\tvar frag = document.createDocumentFragment();\n\t\tfrag.appendChild(start);\n\t\tfrag.appendChild(end);\n\t\tvar ieFrag = IfRenderingContext(this.vm, start, end, expr, changeCb, _if, _else);\n\t\tstart.__qute__ = ieFrag;\n\t\tieFrag(null, true);\n\t\tthis.up(ieFrag);\n\t\treturn frag;\n\t},\n\t// dynamic lists - which is tracking changes and update itself\n\tl: function(listFn, iterationFn) {\n\t\tvar list = listFn(this.vm);\n\t\t//if (!list instanceof List)) ERR(24);\n\t\tif (!list.$createListFragment) ERR(24);\n\t\treturn list.$createListFragment(this, iterationFn);\n\t},\n\t// static array variant of lists - this cannot be updated it is rendered once at creation\n\ta: function(listFn, iterationFn) {\n\t\tvar start = document.createComment('[for]');\n\t\tvar end = document.createComment('[/for]');\n\t\tvar frag = document.createDocumentFragment();\n\t\tfrag.appendChild(start);\n\t\tfrag.appendChild(end);\n\t\tvar forFrag = ForRenderingContext(this.vm, start, end, listFn, iterationFn);\n\t\tstart.__qute__ = forFrag;\n\t\tforFrag(null);\n\t\tthis.up(forFrag);\n\t\treturn frag;\n\t},\n\tup: function(fn) { // register a live update function\n\t\tthis.ups.push(fn);\n//\t\tthis.ups[this.ups.length-1].push(fn);\n\t\treturn fn;\n\t},\n\t//======\n\t// eval the value of an xattr given the key - if a fucntion invoke the function within the current context otherwise return the value as is\n\teval: function(xattr) {\n\t\treturn typeof xattr === 'function' ? xattr(this.vm) : xattr;\n\t},\n\n\t// connect all nested  VMs\n\t$connect: function() {\n\t\tif (!this.isc) {\n\t\t\tvar vms = this.vms;\n\t\t\tfor (var i=0,l=vms.length; i<l; i++) vms[i].$connect();\n\t\t\tthis.isc = true;\n\t\t}\n\t\treturn this;\n\t},\n\t// disconnect all nested VMs\n\t$disconnect: function() {\n\t\tif (this.isc) {\n\t\t\tvar vms = this.vms;\n\t\t\tfor (var i=0,l=vms.length; i<l; i++) vms[i].$disconnect();\n\t\t\tthis.isc = false;\n\t\t}\n\t\treturn this;\n\t},\n\t$push: function(r) { // push a sub-renderings\n\t\tthis.vms.push(r);\n\t\tif (this.isc) r.$connect();\n\t},\n\t// refresh the DOM - call all nested update functions\n\t$update: function() {\n\t\tvar model = this.vm, ups = this.ups;\n\t\tfor (var i=0,l=ups.length;i<l;i++) ups[i](model);\n\t\treturn this;\n\t},\n\tfunctx: function(vm, xattrs, slots) { // functional context\n\t\tvar $attrs = {};\n\t\tvar ctx = {\n\t\t\t$parent: vm,\n\t\t\t$attrs: $attrs,\n\t\t\t$listeners: null,\n\t\t\t$slots: slots,\n\t\t\t$el: null,\n\t\t\t$bindings: null,\n\t\t\temit: Emitter.emit,\n\t\t\temitAsync: Emitter.emitAsync\n\t\t}\n\t\tvar bindings = null;\n\n\t\tif (xattrs) {\n\t\t\tfor (var key in xattrs) { // class, style and show, $attrs, $listeners are ignored\n\t\t\t\tvar val = xattrs[key];\n\t\t\t\tif (key.charCodeAt(0) !== 36 || key === '$html') { // $ - extended attribute -> ignore all extended attrs but $html\n\t\t\t\t\tif (typeof val === 'function') {\n\t\t\t\t\t\tthis.up(SetFuncAttr($attrs, vm, key, val))();\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$attrs[key] = val;\n\t\t\t\t\t}\n\t\t\t\t\t//setFnContextAttr($attrs, vm, key, val);\n\t\t\t\t} else if (key === '$attrs') {\n\t\t\t\t\tif (vm.$attrs) {\n\t\t\t\t\t\t// inject attributes in functional tags\n\t\t\t\t\t\t// we need to create an update function to reinject attrs when model changes\n\t\t\t\t\t\t// otherwise we loose the reactivity on func tags 'x-attrs' attribute\n\t\t\t\t\t\tthis.up(SetFuncAttrs($attrs, vm, val))();\n\t\t\t\t\t}\n\t\t\t\t} else if (key === '$on') {\n\t\t\t\t\tctx.$listeners = createListeners(vm, val);\n\t\t\t\t} else if (key === '$class') {\n\t\t\t\t\tif (!bindings) bindings = [];\n\t\t\t\t\tbindings.push(SetClass, val);\n\t\t\t\t} else if (key === '$style') {\n\t\t\t\t\tif (!bindings) bindings = [];\n\t\t\t\t\tbindings.push(SetStyle, val);\n\t\t\t\t} else if (key === '$show') {\n\t\t\t\t\tif (!bindings) bindings = [];\n\t\t\t\t\tbindings.push(SetDisplay, val);\n\t\t\t\t} else if (key === '$toggle') {\n\t\t\t\t\tif (!bindings) bindings = [];\n\t\t\t\t\tbindings.push(SetToggle, val);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tctx.$bindings = bindings;\n\t\treturn ctx;\n\t}\n\n}\n\nfunction Rendering(vm) {\n\tthis.vm = vm; // defaults to current vm -> changed by functional views\n\tthis.ups = [];\n\t// vms are usually ViewModels but can be any object providing $connect and $disconnect methods\n\t// if you enrich the vms api you mustr check list.js since it register a ListFragment instance as a vm\n\tthis.vms = [];\n\tthis.isc = false; // is connected?\n}\nRendering.prototype = RenderingProto;\n\nexport default Rendering;\n","import {document} from '@qutejs/window';\nimport ERR from './error.js';\nimport UpdateQueue from './update.js';\nimport Rendering from './rendering.js';\n\nfunction ListFragment(rendering, listFn) {\n\tthis.start = document.createComment('[list]');\n\tthis.end = document.createComment('[/list]');\n\tthis.r = rendering;\n\tthis.listFn = listFn;\n\tthis.length = 0;\n\n\tthis.updateChildren = function(model) {\n\t\tvar first = this.start.nextSibling;\n\t\tif (!first || first === this.end || !first.$up) return;\n\t\tvar n = first, end = this.end;\n\t\twhile (n && n !== end) {\n\t\t\tif (n.$up) {\n\t\t\t\tvar ups = n.$up;\n\t\t\t\tfor (var i=0,l=ups.length;i<l;i++) {\n\t\t\t\t\tups[i](model);\n\t\t\t\t}\n\t\t\t}\n\t\t\tn = n.nextSibling;\n\t\t}\n\t}\n\n\tthis.clear = function() {\n\t\tvar n = this.start;\n\t\tvar end = this.end;\n\t\tvar parent = n.parentNode;\n\t\twhile (n.nextSibling && n.nextSibling !== end) {\n\t\t\tparent.removeChild(n.nextSibling);\n\t\t}\n\t\tif (!n.nextSibling) ERR(10);\n\t\tthis.length = 0;\n\t}\n\n\tthis.get = function(index) {\n\t\tif (index < 0 || index > this.length) {\n\t\t\treturn null;\n\t\t}\n\t\tvar l = this.length, n = null;\n\t\tif (index < l/2) { // from start\n\t\t\tn = this.start.nextSibling;\n\t\t\twhile (index-- > 0) n = n.nextSibling;\n\t\t} else { // from end\n\t\t\tindex = l - index - 1;\n\t\t\tn = this.end.previousSibling;\n\t\t\twhile (index-- > 0) n = n.previousSibling;\n\t\t}\n\t\treturn n;\n\t}\n\n\tthis.getInsertion = function(index) {\n\t\tif (index < 0 || index > this.length) ERR(11, index, length);\n\t\tif (index === 0) {\n\t\t\treturn this.start.nextSibling;\n\t\t}\n\t\tif (index === this.length) {\n\t\t\treturn this.end;\n\t\t}\n\t\treturn this.get(index);\n\t}\n\n\tthis.createItem = function(r, item, index, hasNext) {\n\t\treturn listFn(r, item, index, hasNext);\n\t}\n\n\tthis.insert = function(data, from, count) {\n\t\tif (!from) from = 0; // if undefined null or 0\n\t\tif (!count) count = data.length - from; // if undefined null or 0\n\t\tif (count < 1) return;\n\t\tvar l = from+count;\n\t\tvar listFn = this.listFn;\n\t\tvar r = this.r;\n\t\tvar node = this.getInsertion(from);\n\t\tif (!node) ERR(12, index, this.length);\n\t\t//TODO redraw if list fragment is broken insted of throwing an error?\n\t\tvar childR, vm = r.vm, parent = node.parentNode;\n\t\tvar ll = l-1;\n\t\tfor (var i=from; i<ll; i++) {\n\t\t\t// we need to wrapp each child in a rendering ctx to be able to disconnect when items are removed\n\t\t\tchildR = new Rendering(vm);\n\t\t\tvar child = this.createItem(childR, data[i], i, true);\n\t\t\tif (child) {\n\t\t\t\tparent.insertBefore(child, node);\n\t\t\t\tr.$push(childR);\n\t\t\t\tchild.__qute_ctx__ = childR;\n\t\t\t}\n\t\t}\n\t\tchildR = new Rendering(vm);\n\t\tvar child = this.createItem(childR, data[ll], ll, l<data.length);\n\t\tif (child) {\n\t\t\tparent.insertBefore(child, node);\n\t\t\tr.$push(childR);\n\t\t\tchild.__qute_ctx__ = childR;\n\t\t}\n\t\tthis.length = data.length;\n\t}\n\n\tthis.remove = function(from, count) {\n\t\tif (from + count > this.length) {\n\t\t\t// TODO enable only if debug mode\n\t\t\t//throw new Error('Removed range exceed the list length: '+from+'#'+count+'. Length is '+this.length);\n\t\t\treturn;\n\t\t}\n\t\tvar node = this.get(from);\n\t\tif (!node) ERR(13, from, this.length);\n\t\tvar i=0, parent = this.start.parentNode;\n\t\tnode = node.previousSibling; // cannot be null\n\t\twhile (i++<count) {\n\t\t\tvar child = node.nextSibling;\n\t\t\tchild.__qute_ctx__ && child.__qute_ctx__.$disconnect();\n\t\t\tparent.removeChild(child);\n\t\t}\n\t\tthis.length -= count;\n\t}\n\n\tthis.move = function(from, to) {\n\t\t// TODO this can be optimized (we can search for the 2 nodes in the same time: get2(i1, i2))\n\t\tvar node = this.get(from);\n\t\tif (!node) ERR(14, from, this.length);\n\t\tvar dstNode = this.get(to);\n\t\tif (!dstNode) ERR(15, to, this.length);\n\t\tdstNode = dstNode.nextSibling;\n\t\tif (dstNode) {\n\t\t\tdstNode.parentNode.insertBefore(node, dstNode);\n\t\t} else {\n\t\t\tdstNode.parentNode.append(node);\n\t\t}\n\t}\n}\n\n\n\nvar AP = Array.prototype;\nvar ListProto = {\n\t$createListFragment: function(rendering, listFn) {\n\t\tvar listRendering = new Rendering(rendering.vm);\n\t\tif (!this.lfs) this.lfs = [];\n\t\tvar lf = new ListFragment(listRendering, listFn);\n\t\tvar frag = document.createDocumentFragment();\n\t\tfrag.appendChild(lf.start);\n\t\tfrag.appendChild(lf.end);\n\t\tlf.insert(this.$data); // initialize\n\t\trendering.up(lf.updateChildren.bind(lf)); // register children updates\n\t\tthis.lfs.push(lf);\n\t\trendering.$push(listRendering);\n\t\treturn frag;\n\t},\n\t/*\n\t$destroy: function() { //TODO not used\n\t\tthis.lfs = null;\n\t},\n\t*/\n\t$updateNow: function() {\n\t\tif (this.lfs) {\n\t\t\tvar ops = this.ops;\n\t\t\tvar data = this.$data;\n\t\t\tvar lfs = this.lfs;\n\t\t\tvar l = lfs.length;\n\t\t\twhile (ops.length) {\n\t\t\t\tvar op = ops.shift();\n\t\t\t\tfor (var i=0,l=lfs.length; i<l; i++) {\n\t\t\t\t\top(lfs[i], data);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\t$update: function(op) {\n\t\tif (this.lfs) {\n\t\t\tif (this.ops.push(op) === 1) { // if queue is empty start an update task\n\t\t\t\tvar self = this;\n\t\t\t\tUpdateQueue.push(function() {\n\t\t\t\t\tself.$updateNow();\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t},\n\t$redraw: function() {\n\t\tthis.$update(function(lf, data) {\n\t\t\tlf.clear();\n\t\t\tlf.insert(data);\n\t\t});\n\t},\n\t$insert: function(from, count) {\n\t\tthis.$update(function(lf, data) {\n\t\t\tlf.insert(data, from, count);\n\t\t});\n\t},\n\t$remove: function(from, count) {\n\t\tthis.$update(function(lf, data) {\n\t\t\tlf.remove(from, count);\n\t\t});\n\t},\n\t$move: function(from, to) {\n\t\tthis.$update(function(lf, data) {\n\t\t\tlf.move(from, to);\n\t\t});\n\t},\n\n\ttoJSON: function() {\n\t\treturn this.$data;\n\t},\n\tdata: function() {\n\t\treturn this.$data;\n\t},\n\tnewList: function() {\n\t\treturn new List(this.$data);\n\t},\n\n\tclear: function() {\n\t\tthis.replace([]);\n\t},\n\treplace: function (ar) {\n\t\tthis.$data = ar;\n\t\tthis.$redraw();\n\t},\n\n\tmove: function(from, to) {\n\t\tthis.$data.splice(to, 0, this.$data.splice(from, 1)[0]);\n\t\tthis.$move(from, to);\n\t},\n\n\tremove: function(item) {\n\t\tvar i = this.$data.indexOf(item);\n\t\tif (i > -1) {\n\t\t\treturn this.splice(i, 1);\n\t\t}\n\t},\n\n\tpush: function() {\n\t\tvar from = this.$data.length;\n\t\tvar r = AP.push.apply(this.$data, arguments);\n\t\tthis.$insert(from, arguments.length);\n\t\treturn r;\n\t},\n\tunshift: function() {\n\t\tvar from = this.$data.length;\n\t\tvar r = AP.unshift.apply(this.$data, arguments);\n\t\tthis.$insert(0, arguments.length);\n\t\treturn r;\n\t},\n\tpop: function() {\n\t\tvar r = AP.pop.apply(this.$data, arguments);\n\t\tthis.$remove(this.$data.length, 1);\n\t\treturn r;\n\t},\n\tshift: function() {\n\t\tvar r = AP.shift.apply(this.$data, arguments);\n\t\tthis.$remove(0, 1);\n\t\treturn r;\n\t},\n\tsplice: function(start, deleteCount) {\n\t\tvar argsl = arguments.length;\n\t\tvar len = this.$data.length;\n\t\tvar r = AP.splice.apply(this.$data, arguments);\n\t\tif (argsl === 1) {\n\t\t\tthis.$remove(start, len-start);\n\t\t} else if (argsl === 2) {\n\t\t\tthis.$remove(start, deleteCount);\n\t\t} else { // some inserted items\n\t\t\tif (deleteCount) this.$remove(start, deleteCount);\n\t\t\tthis.$insert(start, argsl-2);\n\t\t}\n\t\treturn r;\n\t},\n\tsort: function(cmp) {\n\t\tthis.$data.sort(cmp);\n\t\tthis.$redraw();\n\t\treturn this.$data;\n\t},\n\treverse: function() {\n\t\tthis.$data.reverse();\n\t\tthis.$redraw();\n\t\treturn this.$data;\n\t},\n\tget: function(i) {\n\t\treturn this.$data[i];\n\t},\n\tslice: function() {\n\t\treturn AP.slice.apply(this.$data, arguments);\n\t},\n\tforEach: function(cb, thisArg) {\n\t\tthis.$data.forEach(cb, thisArg);\n\t},\n\tmap: function(cb, thisArg) {\n\t\treturn this.$data.map(cb, thisArg);\n\t},\n\tfilter: function(cb, thisArg) {\n\t\treturn this.$data.filter(cb, thisArg);\n\t},\n\tfind: function(cb, thisArg) {\n\t\treturn this.$data.find(cb, thisArg);\n\t},\n\tfindIndex: function(cb, thisArg) {\n\t\treturn this.$data.findIndex(cb, thisArg);\n\t},\n\treduce: function(cb, initialValue) {\n\t\treturn this.$data.reduce(cb, initialValue);\n\t},\n\treduceRight: function(cb, initialValue) {\n\t\treturn this.$data.reduceRight(cb, initialValue);\n\t},\n\tindexOf: function(elem, from) {\n\t\treturn this.$data.indexOf(elem, from || 0);\n\t},\n\tlastIndexOf: function(elem, from) {\n\t\treturn this.$data.lastIndexOf(elem, from || this.$data.length-1);\n\t},\n\t//TODO add some, every, ...\n}\nObject.defineProperty(ListProto, 'length', {get:function() {return this.$data.length}});\n\nexport default function List(data) {\n\tthis.ops = []; // update operations queue\n\tthis.lfs = null; // the list fragment\n\tthis.$data = data || []; // the backed data\n}\nList.prototype = ListProto;\n","import window, {document} from '@qutejs/window';\nimport ERR from './error.js';\nimport { stopEvent, chainFnAfter, closestVM, kebabToCamel } from './utils.js';\n\nimport Rendering from './rendering.js';\nimport List from './list.js';\nimport UpdateQueue from './update.js';\nimport Context from './context.js';\nimport {createListeners, SetProp, SetVMAttrs, SetClass, SetStyle, SetToggle, SetDisplay} from './binding.js';\nimport Emitter from './emit.js';\n\n\nfunction isEnumerable(key) {\n\treturn key.charCodeAt(0) !== 95; // keys starting with _ are not enumerable\n}\n\nfunction defProp(key) {\n\treturn {\n\t\tget: function() {\n\t\t\treturn this.$data[key];\n\t\t},\n\t\tset: function(value) {\n\t\t\tvar old = this.$data[key];\n\t\t\tif (old !== value) {\n\t\t\t\tthis.$data[key] = value;\n\t\t\t\tvar watcher = this.$el && this.$watch && this.$watch[key]; // if not connected whatchers are not enabled\n\t\t\t\t// avoid updating if watcher return false\n\t\t\t\tif (watcher && watcher.call(this, value, old) === false) return;\n\t\t\t\tthis.update(key);\n\t\t\t}\n\t\t},\n\t\tenumerable: isEnumerable(key) // keys starting with _ are not enumerable\n\t}\n}\n\nfunction listProp(key) {\n\treturn {\n\t\tget: function() {\n\t\t\treturn this.$data[key];\n\t\t},\n\t\tset: function(value) {\n\t\t\tvar old = this.$data[key];\n\t\t\tif (old !== value) {\n\t\t\t\tif (!value) { // remove list content\n\t\t\t\t\tthis.$data[key].clear();\n\t\t\t\t} else if (Array.isArray(value)) {\n\t\t\t\t\tthis.$data[key].replace(value);\n\t\t\t\t} else if (value instanceof List) {\n\t\t\t\t\t//TODO should we copy the data?\n\t\t\t\t\tif (old) old.$disconnect();\n\t\t\t\t\tthis.$data[key] = value;\n\t\t\t\t} else {\n\t\t\t\t\tERR(31, value);\n\t\t\t\t}\n\t\t\t\tvar watcher = this.$watch && this.$watch[key];\n\t\t\t\t// avoid updating if watcher return false\n\t\t\t\tif (watcher && watcher.call(this, value, old) === false) return;\n\t\t\t\tthis.update(key);\n\t\t\t}\n\t\t},\n\t\tenumerable: isEnumerable(key) // keys starting with _ are not enumerable\n\t}\n}\n\nfunction ViewModel(ctx, attrs) {\n\tvar prop = {};\n\t// the attributes set on vm tag which are not declared as props\n\tprop.value = {};\n\tObject.defineProperty(this, '$attrs', prop);\n\t// the app context if any\n\tprop.value = ctx instanceof Context ? ctx : new Context(ctx);\n\tObject.defineProperty(this, '$ctx', prop);\n\t// the listeners registered on the vm tag\n\tprop.value = null;\n\tprop.writable = true;\n\t// the associated rendering context\n\tObject.defineProperty(this, '$r', prop);\n\t// listeners injected through tag attributes (e.g. @click)\n\tObject.defineProperty(this, '$listeners', prop);\n\t// the slots injected by the caller\n\tObject.defineProperty(this, '$slots', prop);\n\t// the view root element\n\tObject.defineProperty(this, '$el', prop);\n\t// chained cleanup functions if any was registered\n\tObject.defineProperty(this, '$clean', prop);\n\t// States: 0 - initial, 1 - connected, 2 - updating\n\tprop.value = 0;\n\tObject.defineProperty(this, '$st', prop); // state: 0 - default, 1 updating , 2 frozen\n\n\tvar data = this.init(ctx) || {};\n\tprop.value = data;\n\tObject.defineProperty(this, '$data', prop);\n\tif (data) {\n\t\tfor (var key in data) {\n\t\t\tObject.defineProperty(this, key, data[key] instanceof List ? listProp(key) : defProp(key));\n\t\t}\n\t}\n\n\tif (!this.render) ERR(32);\n\n\t// initialize data model from attributes if any - this will not trigger an update\n\tif (attrs) {\n\t\tvar $data = this.$data;\n\t\tvar $attrs = this.$attrs;\n\t\tObject.keys(attrs).forEach(function(key) {\n\t\t\tvar value = attrs[key];\n\t\t\tif (key in $data) { // a declared property\n\t\t\t\t$data[key] = value;\n\t\t\t} else {\n\t\t\t\tvar camelKey = kebabToCamel(key);\n\t\t\t\tif (camelKey !== key && camelKey in $data) {\n\t\t\t\t\t$data[camelKey] = value;\n\t\t\t\t} else if ($attrs[key] !== value) {\n\t\t\t\t\t// attributes are not camelized\n\t\t\t\t\t$attrs[key] = value;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n}\n\nViewModel.prototype = {\n\t__VM__:true,\n\ttoString: function() {\n\t\treturn 'ViewModel <'+this.$tag+'/>';\n\t},\n\t// set an attribute value (can be either a free property (i.e $attrs[key]) or managed property (i.e. $data[key]))\n\t$set: function(key, value) {\n\t\tif (key in this.$data) { // a declared property\n\t\t\tthis[key] = value;\n\t\t} else {\n\t\t\tvar camelKey = kebabToCamel(key);\n\t\t\tif (camelKey !== key && camelKey in this.$data) {\n\t\t\t\tthis[camelKey] = value;\n\t\t\t} else if (this.$attrs[key] !== value) {\n\t\t\t\t// attributes are not camelized\n\t\t\t\tthis.$attrs[key] = value;\n\t\t\t\tthis.update();\n\t\t\t}\n\t\t}\n\t},\n\t// subscribe to the given channel name - for use on root VMs\n\tlisten: function(channelName) {\n\t\tif (!this.$channel) ERR(39, this.$tag);\n\t\t// add an init function\n\t\tthis.$init = chainFnAfter(function(thisObj) {\n\t\t\tthisObj.subscribe(channelName, thisObj.$channel);\n\t\t}, this.$init);\n\t\treturn this;\n\t},\n\t//TODO use setup in listen and $on\n\tsetup: function(setupFn) {\n\t\tthis.$init = chainFnAfter(setupFn, this.$init);\n\t\treturn this;\n\t},\n\tcleanup: function(fn) { // register a cleanup function when component is disconnected\n\t\tthis.$clean = chainFnAfter(fn, this.$clean);\n\t\treturn this;\n\t},\n\t$parent: function() {\n\t\tif (!this.$el) ERR(35);\n\t\treturn closestVM(this.$el.parentNode);\n\t},\n\t$root: function() {\n\t\tvar parent = this.$parent();\n\t\treturn parent ? parent.$root() : this;\n\t},\n\t$connect: function() {\n\t\tif (this.$st & 1) return; // ignore\n\t\tthis.$st |= 1; // set connected flag\n\t\t// $init may be defined by the prototype to do automatic setup when connected\n\t\t// (e.g. automatic installed listeners defined though VM definitioan 'on' property)\n\t\tif (this.$init) {\n\t\t\tthis.$init(this);\n\t\t}\n\t\tif (this.$listeners) {\n\t\t\tvar listeners = this.$listeners;\n\t\t\tfor (var key in listeners) {\n\t\t\t\tthis.$on(key, listeners[key]);\n\t\t\t}\n\t\t}\n\t\t// connect children vms\n\t\tthis.$r.$connect();\n\t\t// call the connected callback\n\t\tthis.connected && this.connected();\n\t\treturn this;\n\t},\n\t$disconnect: function() {\n\t\tif (!(this.$st & 1)) return; // ignore\n\t\tthis.$st ^= 1; // clear connected flag\n\t\tif (this.$clean) {\n\t\t\tthis.$clean();\n\t\t\tthis.$clean = null;\n\t\t}\n\t\tthis.$r.$disconnect(); // disconnect children vms\n\t\tthis.disconnected && this.disconnected();\n\t},\n\t// initialize a vm from tag raw data\n\t$load: function(rendering, xattrs, slots) {\n\t\tvar bindings = null;\n\t\tvar parentVM = rendering.vm;\n\t\tthis.$slots = slots;\n\t\tif (xattrs) {\n\t\t\tfor (var key in xattrs) {\n\t\t\t\tvar val = xattrs[key];\n\t\t\t\tif (key.charCodeAt(0) === 36) { // $ - extended attribute\n\t\t\t\t\tif (key === '$on') {\n\t\t\t\t\t\t//TODO we should make a copy of val since it is modified by createListeners!!!\n\t\t\t\t\t\tthis.$listeners = createListeners(parentVM, val); // use parent vm when creating listeners\n\t\t\t\t\t} else if (key === '$attrs') { // we must not delete keys from xattrs since it can break when vm is loaded by a dynamic component\n\t\t\t\t\t\t//TODO DO WE NEED to add an update fn? x-attrs are static\n\t\t\t\t\t\trendering.up(SetVMAttrs(this, parentVM, val))();\n\t\t\t\t\t} else if (key === '$class') {\n\t\t\t\t\t\tif (!bindings) bindings = [];\n\t\t\t\t\t\tbindings.push(SetClass, val);\n\t\t\t\t\t} else if (key === '$style') {\n\t\t\t\t\t\tif (!bindings) bindings = [];\n\t\t\t\t\t\tbindings.push(SetStyle, val);\n\t\t\t\t\t} else if (key === '$show') {\n\t\t\t\t\t\tif (!bindings) bindings = [];\n\t\t\t\t\t\tbindings.push(SetDisplay, val);\n\t\t\t\t\t} else if (key === '$toggle') {\n\t\t\t\t\t\tif (!bindings) bindings = [];\n\t\t\t\t\t\tbindings.push(SetToggle, val);\n\t\t\t\t\t} else if (key === '$channel') {\n\t\t\t\t\t\tthis.listen(val);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tERR(26, key);\n\t\t\t\t\t}\n\t\t\t\t} else if (typeof val === 'function') { // a dynamic binding\n\t\t\t\t\trendering.up(SetProp(this, parentVM, key, val))();\n\t\t\t\t} else { // static binding\n\t\t\t\t\tthis.$set(key, val);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn bindings;\n\t},\n\t$create: function(parentRendering, xattrs, slots) {\n\t\t// load definition\n\t\tvar bindings = parentRendering && this.$load(parentRendering, xattrs, slots);\n\t\tvar rendering = new Rendering(this);\n\t\t// must never return null - for non rendering components like popups we return a comment\n\t\tvar el = this.render(rendering) || document.createComment('<'+this.$tag+'/>');\n\t\tthis.$r = rendering;\n\t\tel.__qute__ = this;\n\t\tthis.$el = el;\n\t\tif (bindings) for (var i=0,l=bindings.length; i<l; i+=2) {\n\t\t\tvar binding = bindings[i];\n\t\t\tvar up = bindings[i](el, parentRendering.vm, bindings[i+1]);\n\t\t\tparentRendering.up(up)();\n\t\t}\n\t\tthis.created && this.created(el);\n\t\t// this can trigger a connect if tree is already connected (for example when inserting a comp in a connected list)\n\t\tparentRendering && parentRendering.$push(this);\n\t\treturn el;\n\t},\n\n\t// manual mount (only roots must be moutned this way)\n\tmount: function(elOrId, insertBefore) {\n\t\tif (this.$el) ERR(33); //TODO should check if connected and if not root\n\t\tvar target;\n\t\tif (elOrId) {\n\t\t\ttarget = typeof elOrId === 'string' ? document.getElementById(elOrId) : elOrId;\n\t\t} else {\n\t\t\ttarget = document.body;\n\t\t}\n\t\tvar el = this.$create();\n\t\tif (insertBefore) {\n\t\t\ttarget.parentNode.insertBefore(el, target);\n\t\t} else {\n\t\t\ttarget.appendChild(el);\n\t\t}\n\t\tthis.$connect();\n\t\t// announce the tree was attached to the DOM\n\t\treturn this;\n\t},\n\t// only manually mounted vms can be unmounted\n\tunmount: function() {\n\t\t// a child vm?\n\t\t//if (this.$p) ERR();\n\t\tif (!this.$el) ERR(34); // TODO check if root and mounted\n\t\tthis.$disconnect();\n\t\tthis.$el.parentNode.removeChild(this.$el);\n\t},\n\t$update: function(key) {\n\t\tif (this.$el) { // only if connected\n\t\t\tthis.$r.$update();\n\t\t}\n\t},\n\tupdate: function(key) {\n\t\tif (this.$st === 1) { // only if connected and not already scheduled to update\n\t\t\tthis.$st |= 2; // set updating flag\n\t\t\tvar self = this;\n\t\t\tUpdateQueue.push(function() {\n\t\t\t\tself.$update(key);\n\t\t\t\tself.$st ^= 2; // remove updating flag\n\t\t\t});\n\t\t}\n\t},\n\t$on: function(type/*, selector, cb*/) {\n\t\tif (!this.$el) ERR(34);\n\t\t//if (!this.$clean) this.$clean = [];\n\t\tvar selector, cb;\n\t\tif (arguments.length === 3) {\n\t\t\tselector = arguments[1];\n\t\t\tcb = arguments[2];\n\t\t\tif (!cb) {\n\t\t\t\tcb = selector;\n\t\t\t\tselector = null;\n\t\t\t\tif (!cb) throw new Error('on function requires a callback argument');\n\t\t\t}\n\t\t} else if (arguments.length === 2) {\n\t\t\tcb = arguments[1];\n\t\t} else {\n\t\t\tthrow new Error('on function takes 2 or 3 arguments: eventType[, seelctor], callback');\n\t\t}\n\t\tvar self = this;\n\t\tvar wrapper = function(e) {\n\t\t\tif (!selector || e.target.matches(selector)) {\n\t\t\t\tif (cb.call(self, e) === false) {\n\t\t\t\t\tstopEvent(e);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis.$el.addEventListener(type, wrapper);\n\t\tthis.cleanup(function() {\n\t\t\tself.$el.removeEventListener(type, wrapper);\n\t\t});\n\t\t//this.$clean.push(type, wrapper);\n\t},\n\temit: Emitter.emit,\n\temitAsync: Emitter.emitAsync,\n\t// -------- ctx event bus -------------\n\tpost: function(topic, msg, data) {\n\t\tthis.$ctx.post(topic, msg, data);\n\t},\n\tpostAsync: function(topic, msg, data) {\n\t\tthis.$ctx.postAsync(topic, msg, data);\n\t},\n\t// subscribe and register cleanup to remove subscription at disconnect\n\tsubscribe: function(name, listenerFn) {\n\t\tvar ctx = this.$ctx;\n\t\tctx.subscribe(name, listenerFn.bind(this));\n\t\tthis.cleanup(function() {\n\t\t\tctx.unsubscribe(name, listenerFn);\n\t\t});\n\t\treturn this;\n\t},\n\tsubscribeOnce: function(topic, event, listenerFn) {\n\t\tvar ctx = this.$ctx;\n\t\tvar onceSubscription = ctx.subscribeOnce(topic, event, listenerFn.bind(this));\n\t\tthis.cleanup(function() {\n\t\t\tctx.unsubscribe(topic, onceSubscription);\n\t\t});\n\t\treturn this;\n\t},\n\ttoHTML: function() {\n\t\treturn this.$el && this.$el.outerHTML;\n\t},\n\t// ---------------------------------------------\n\tinit: function() {} // do nothing\n}\n\nexport default ViewModel;\n","import window from '@qutejs/window';\n\nimport ERR from './error.js';\nimport { chainFnAfter, closestVM } from './utils.js';\n\nimport UpdateQueue from './update.js';\nimport Rendering from './rendering.js';\nimport ViewModel from './vm.js';\nimport Context from './context.js';\nimport List from './list.js';\nimport { createListener } from './binding.js';\nimport { registerTag, registerVM, getTag, getVM, getVMOrTag, snapshotRegistry, restoreRegistry } from './registry.js';\n\n/**\n * We cannot use Object.assign since getter are lost. So we copy the prop def itself\n */\nfunction assignPropDefs(dst, src) {\n\tvar keys = Object.keys(src);\n    for(var i=0,l=keys.length; i<l; i++) {\n      var key = keys[i];\n      Object.defineProperty(dst, key, Object.getOwnPropertyDescriptor(src, key));\n    }\n    return dst;\n}\n\nfunction Qute(tag, def, BaseVm) {\n\tif (!tag) ERR(5);\n\n\tfunction ViewModelImpl(ctx, attrs) {\n\t\tViewModel.call(this, ctx, attrs);\n\t}\n\n\tvar VMType, VMProto;\n\tif (typeof def === 'function') {\n\t\tif (def.prototype instanceof ViewModel)\t{\n\t\t\t// VM is defined as a class\n\t\t\tVMType = def;\n\t\t\tVMProto = VMType.prototype;\n\t\t} else {\n\t\t\t// a rendering function - we simply register the rendering fucntion for the given tag\n\t\t\treturn registerTag(tag, def);\n\t\t}\n\t} else { // VM definition object\n\t\tif (!BaseVm) BaseVm = ViewModel;\n\t\tVMProto = Object.create(BaseVm.prototype, {\n\t\t\tconstructor: {value:ViewModelImpl},\n\t\t});\n\t\tif (def) assignPropDefs(VMProto, def); // this is preserving getters\n\t\tVMProto.$super = BaseVm.prototype; // to be able to override methods and call the super method if needed\n\t\tViewModelImpl.prototype = VMProto;\n\n\t\tVMType = ViewModelImpl;\n\t}\n\n\t// add the rendering method of the tag if no one was provided\n\tif (!VMProto.render) {\n\t\tVMProto.render = Qute.template(tag);\n\t\tif (!VMProto.render) {\n\t\t\tERR(36, tag);\n\t\t}\n\t}\n\t// add the tag meta property\n\tVMProto.$tag = tag;\n\n\tregisterVM(tag, VMType);\n\n\tVMType.watch = function(prop, fn) {\n\t\tif (!VMProto.$watch) Object.defineProperty(VMProto, '$watch', {value:{}});\n\t\tVMProto.$watch[prop] = fn;\n\t\treturn VMType;\n\t}\n\tVMType.on = function(key, selector, cb) {\n\t\tVMProto.$init = chainFnAfter(function(thisObj) {\n\t\t\tthisObj.$on(key, selector, cb);\n\t\t}, VMProto.$init);\n\t\treturn VMType;\n\t}\n\tVMType.channel = function(listenFn) {\n\t\tVMProto.$channel = listenFn;\n\t\treturn this;\n\t}\n\n\treturn VMType;\n}\n\nQute.List = List;\nQute.ViewModel = ViewModel;\n\n// link a viewmodel to a template. Usefull for classes where defining prototype methods is not part of the class syntax\nQute.link = function(VMType, renderFn) {\n\tVMType.prototype.render = renderFn;\n}\n\n\nvar QUTE_STYLE=null;\nQute.css = function(css) {\n\tvar doc = window.document;\n\tif (!QUTE_STYLE) {\n\t\tvar style = doc.getElementById('--qute-inline-styles');\n\t\tif (!style) {\n\t\t\tstyle = doc.createElement('STYLE');\n\t\t\tstyle.id = '--qute-inline-styles';\n\t\t\tstyle.type = 'text/css';\n\t\t\tstyle.textContent = \"\\n\";\n\t\t\tdoc.head.insertBefore(style, doc.head.firstChild);\n\t\t}\n\t\tQUTE_STYLE = style;\n\t}\n\tQUTE_STYLE.textContent += css;\n}\n\nQute.converters = {};\nContext.Qute = Qute; // we need this to access globals defined in Qute like converters\nQute.Context = Context;\nQute.UpdateQueue = UpdateQueue;\nQute.Rendering = Rendering;\n// render a functional template given its tag name and a model\nQute.render = function(xtagName, model) {\n\treturn getTag(xtagName)(new Rendering(model));\n}\n\nQute.register = registerTag;\nQute.template = getTag;\nQute.snapshotRegistry = snapshotRegistry;\nQute.restoreRegistry = restoreRegistry;\nQute.vm = getVM;\nQute.vmOrTemplate = getVMOrTag;\n\nQute.runAfter = function(cb) { UpdateQueue.runAfter(cb); }\nQute.closest = closestVM;\nQute.ERR = ERR;\n\n\nexport default Qute;\n\n"],"names":["ERR","resolve","apply","arguments","capitalizeFirst","value","toUpperCase","substring","kebabToCamel","i","indexOf","out","s","length","stopEvent","e","preventDefault","stopPropagation","chainFnAfter","fn","prevFn","arg","closestVM","el","__qute__","parentNode","filterKeys","obj","filter","keys","Object","incl","key","Error","Array","prototype","slice","call","UpdateQueue","maxNestedLoops","queue","after","push","op","this","self","window","setTimeout","run","runAfter","runAfterCb","cnt","max","shift","l","Context","data","assign","$topics","lifecycle","post","topic","msg","listeners","postAsync","subscribe","listenerFn","subscribeOnce","event","onceSubscription","unsubscribe","splice","freeze","VMS","XTAGS","getTag","tag","registerTag","templateFn","isCompiled","$compiled","$tag","getVMOrTag","addClassMap","cl","add","remove","createListener","vm","createListeners","$listeners","SetAttr","model","valFn","changedKey","val","getAttribute","removeAttribute","setAttribute","SetInnerHTML","innerHTML","SetDisplay","display","style","__qute_display","SetToggle","attrs","SetClass","elt","classList","isArray","bindClass","SetStyle","bindStyle","SetProp","$set","SetDOMAttrs","$attrs","SetFuncAttrs","vmAttrs","SetFuncAttr","SetVMAttrs","parentVM","parentAttrs","Emitter","emit","$el","dispatchEvent","CustomEvent","bubbles","detail","undefined","emitAsync","timeout","appendChildren","parent","children","appendChild","applyListeners","doNotWrap","addEventListener","extractSlots","namedSlots","nestedCnt","hasContent","child","nodeType","nodeName","slot","slotChildren","node","firstChild","nextSibling","nodeValue","trim","default","RenderingProto","x","expr","text","document","createTextNode","up","t","g","isFn","xattrs","XTag","v","h","createElement","charCodeAt","hh","content","type","converter","Qute","converters","r","_v","slots","__VM__","$ctx","$create","oldVm","functx","$bindings","bindings","slotName","defaultChildren","$slots","frag","createDocumentFragment","createComment","w","isExpr","changeCb","noCache","childrenFn","marker","cache","cview","viewFrag","propKey","initialUpdate","viewXTag","$disconnect","removeChild","previousSibling","Rendering","insertBefore","$connect","$update","_if","_else","start","end","state","ieFrag","newState","listFn","iterationFn","list","$createListFragment","a","forFrag","newList","k","ll","ups","eval","xattr","isc","vms","$push","ctx","$parent","ListFragment","rendering","updateChildren","first","$up","n","clear","get","index","getInsertion","createItem","item","hasNext","insert","from","count","childR","__qute_ctx__","move","to","dstNode","append","AP","ListProto","listRendering","lfs","lf","$data","bind","$updateNow","ops","$redraw","$insert","$remove","$move","toJSON","List","replace","ar","unshift","pop","deleteCount","argsl","len","sort","cmp","reverse","forEach","cb","thisArg","map","find","findIndex","reduce","initialValue","reduceRight","elem","lastIndexOf","isEnumerable","defProp","set","old","watcher","$watch","update","enumerable","listProp","ViewModel","prop","defineProperty","writable","init","render","camelKey","def","BaseVm","ViewModelImpl","VMType","VMProto","create","constructor","dst","src","getOwnPropertyDescriptor","assignPropDefs","$super","template","watch","on","selector","$init","thisObj","$on","channel","listenFn","$channel","toString","listen","channelName","setup","setupFn","cleanup","$clean","$root","$st","$r","connected","disconnected","$load","parentRendering","created","mount","elOrId","target","getElementById","body","unmount","wrapper","matches","removeEventListener","name","toHTML","outerHTML","link","renderFn","QUTE_STYLE","css","doc","id","textContent","head","xtagName","register","snapshotRegistry","restoreRegistry","snapshot","vmOrTemplate","closest"],"mappings":"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"}