{"version":3,"file":"qute-all-0.9.1.min.js","sources":["../polyfill/lib/index.esm.js","../../core/commons/lib/index.esm.js","../../core/runtime/lib/index.esm.js","../../plugins/router/lib/index.esm.js","../../components/modal/lib/index.esm.js","../../components/popup/lib/index.esm.js","../../components/spinner/lib/index.esm.js"],"sourcesContent":["import window from '@qutejs/window';\n\n/* Polyfill from https://developer.mozilla.org/en-US/docs/Web/API/Element/classList */\n\n// removed polyfill code for IE7-8 the target is IE>=9\nif (!window.DOMException) { (window.DOMException = function(reason) {\n    this.message = reason;\n}).prototype = new Error; }\n\nvar wsRE = /[\\11\\12\\14\\15\\40]/,\n    wsIndex = 0,\n    checkIfValidClassListEntry = function(O, V) {\n        if (V === \"\") { throw new DOMException(\n            \"Failed to execute '\" + O + \"' on 'DOMTokenList': The token provided must not be empty.\"); }\n        if ((wsIndex = V.search(wsRE)) !== -1) { throw new DOMException(\"Failed to execute '\" + O + \"' on 'DOMTokenList': \" +\n            \"The token provided ('\" + V[wsIndex] + \"') contains HTML space characters, which are not valid in tokens.\"); }\n    };\n\n// 1. Implement the barebones DOMTokenList livelyness polyfill\nif (typeof window.DOMTokenList !== \"function\") {\n    var hasOwnProp = Object.prototype.hasOwnProperty;\n    var defineProperty = Object.defineProperty,\n        allowTokenListConstruction = 0,\n        skipPropChange = 0;\n\n    var DOMTokenList = function() {\n        if (!allowTokenListConstruction) { throw TypeError(\"Illegal constructor\"); } // internally let it through\n    };\n    DOMTokenList.prototype.toString = DOMTokenList.prototype.toLocaleString = function() {\n        return this.value\n    };\n    DOMTokenList.prototype.add = function() {\n        var arguments$1 = arguments;\n\n        a: for (var v = 0, argLen = arguments.length, val = \"\", ele = this[\" uCL\"], proto = ele[\" uCLp\"]; v !== argLen; ++v) {\n            val = arguments$1[v] + \"\", checkIfValidClassListEntry(\"add\", val);\n            for (var i = 0, Len = proto.length, resStr = val; i !== Len; ++i)\n                { if (this[i] === val) { continue a; }\n                else { resStr += \" \" + this[i]; } }\n            this[Len] = val, proto.length += 1, proto.value = resStr;\n        }\n        skipPropChange = 1,\n        ele.className = proto.value,\n        skipPropChange = 0;\n    };\n    DOMTokenList.prototype.remove = function() {\n        var arguments$1 = arguments;\n\n        for (var v = 0, argLen = arguments.length, val = \"\", ele = this[\" uCL\"], proto = ele[\" uCLp\"]; v !== argLen; ++v) {\n            val = arguments$1[v] + \"\", checkIfValidClassListEntry(\"remove\", val);\n            for (var i = 0, Len = proto.length, resStr = \"\", is = 0; i !== Len; ++i)\n                { if (is) {\n                    this[i - 1] = this[i];\n                } else {\n                    if (this[i] !== val) {\n                        resStr += this[i] + \" \";\n                    } else {\n                        is = 1;\n                    }\n                } }\n            if (!is) { continue; }\n            delete this[Len], proto.length -= 1, proto.value = resStr;\n        }\n        skipPropChange = 1, ele.className = proto.value, skipPropChange = 0;\n    };\n    window.DOMTokenList = DOMTokenList;\n\n    var whenPropChanges = function() {\n        var evt = window.event,\n            prop = evt.propertyName;\n        if (!skipPropChange && (prop === \"className\" || (prop === \"classList\" && !defineProperty))) {\n            var target = evt.srcElement,\n                protoObjProto = target[\" uCLp\"],\n                strval = \"\" + target[prop];\n            var tokens = strval.trim().split(wsRE),\n                resTokenList = target[prop === \"classList\" ? \" uCL\" : \"classList\"];\n            var oldLen = protoObjProto.length;\n            a: for (var cI = 0, cLen = protoObjProto.length = tokens.length, sub = 0; cI !== cLen; ++cI) {\n                for (var innerI = 0; innerI !== cI; ++innerI)\n                    { if (tokens[innerI] === tokens[cI]) {\n                        sub++;\n                        continue a;\n                    } }\n                resTokenList[cI - sub] = tokens[cI];\n            }\n            for (var i = cLen - sub; i < oldLen; ++i) { delete resTokenList[i]; } //remove trailing indexs\n            if (prop !== \"classList\") { return; }\n            skipPropChange = 1, target.classList = resTokenList, target.className = strval;\n            skipPropChange = 0, resTokenList.length = tokens.length - sub;\n        }\n    };\n\n    var polyfillClassList = function(ele) {\n        if (!ele || !(\"innerHTML\" in ele)) { throw TypeError(\"Illegal invocation\"); }\n        ele.detachEvent(\"onpropertychange\", whenPropChanges); // prevent duplicate handler infinite loop\n        allowTokenListConstruction = 1;\n        var protoObj = function() {};\n        try {\n            protoObj.prototype = new DOMTokenList();\n        } finally {\n            allowTokenListConstruction = 0;\n        }\n        var protoObjProto = protoObj.prototype,\n            resTokenList = new protoObj();\n        a: for (var toks = ele.className.trim().split(wsRE), cI = 0, cLen = toks.length, sub = 0; cI !== cLen; ++cI) {\n            for (var innerI = 0; innerI !== cI; ++innerI)\n                { if (toks[innerI] === toks[cI]) {\n                    sub++;\n                    continue a;\n                } }\n            this[cI - sub] = toks[cI];\n        }\n        protoObjProto.length = cLen - sub, protoObjProto.value = ele.className, protoObjProto[\" uCL\"] = ele;\n        if (defineProperty) {\n            defineProperty(ele, \"classList\", { // IE8 & IE9 allow defineProperty on the DOM\n                enumerable: 1,\n                get: function() {\n                    return resTokenList\n                },\n                configurable: 0,\n                set: function(newVal) {\n                    skipPropChange = 1, ele.className = protoObjProto.value = (newVal += \"\"), skipPropChange = 0;\n                    var toks = newVal.trim().split(wsRE),\n                        oldLen = protoObjProto.length;\n                    a: for (var cI = 0, cLen = protoObjProto.length = toks.length, sub = 0; cI !== cLen; ++cI) {\n                        for (var innerI = 0; innerI !== cI; ++innerI)\n                            { if (toks[innerI] === toks[cI]) {\n                                sub++;\n                                continue a;\n                            } }\n                        resTokenList[cI - sub] = toks[cI];\n                    }\n                    for (var i = cLen - sub; i < oldLen; ++i) { delete resTokenList[i]; } //remove trailing indexs\n                }\n            });\n            defineProperty(ele, \" uCLp\", { // for accessing the hidden prototype\n                enumerable: 0,\n                configurable: 0,\n                writeable: 0,\n                value: protoObj.prototype\n            });\n            defineProperty(protoObjProto, \" uCL\", {\n                enumerable: 0,\n                configurable: 0,\n                writeable: 0,\n                value: ele\n            });\n        } else {\n            ele.classList = resTokenList, ele[\" uCL\"] = resTokenList, ele[\" uCLp\"] = protoObj.prototype;\n        }\n        ele.attachEvent(\"onpropertychange\", whenPropChanges);\n    };\n    window.Object.defineProperty(window.Element.prototype, \"classList\", {\n        enumerable: 1,\n        get: function(val) {\n            if (!hasOwnProp.call(this, \"classList\")) { polyfillClassList(this); }\n            return this.classList;\n        },\n        configurable: 0,\n        set: function(val) {\n            this.className = val;\n        }\n    });\n}\n\n// 2. Patch in unsupported methods in DOMTokenList\nvar DOMTokenListProto = window.DOMTokenList.prototype;\nvar testClass = window.document.createElement(\"div\").classList;\nif (!DOMTokenListProto.item) { DOMTokenListProto.item = function(i) {\n    function NullCheck(n) {\n        return n === void 0 ? null : n\n    }\n    return NullCheck(this[i]);\n}; }\nif (!DOMTokenListProto.toggle || testClass.toggle(\"a\", 0) !== false) { DOMTokenListProto.toggle = function(val) {\n    if (arguments.length > 1) { return (this[arguments[1] ? \"add\" : \"remove\"](val), !!arguments[1]); }\n    var oldValue = this.value;\n    return (this.remove(oldValue), oldValue === this.value && (this.add(val), true) /*|| false*/ );\n}; }\nif (!DOMTokenListProto.replace || typeof testClass.replace(\"a\", \"b\") !== \"boolean\")\n    { DOMTokenListProto.replace = function(oldToken, newToken) {\n        checkIfValidClassListEntry(\"replace\", oldToken), checkIfValidClassListEntry(\"replace\", newToken);\n        var oldValue = this.value;\n        return (this.remove(oldToken), this.value !== oldValue && (this.add(newToken), true));\n    }; }\nif (!DOMTokenListProto.contains) { DOMTokenListProto.contains = function(value) {\n    for (var i = 0, Len = this.length; i !== Len; ++i)\n        { if (this[i] === value) { return true; } }\n    return false;\n}; }\nif (!DOMTokenListProto.forEach) { DOMTokenListProto.forEach = function(f) {\n    if (arguments.length === 1)\n        { for (var i = 0, Len = this.length; i !== Len; ++i) { f(this[i], i, this); } }\n    else\n        { for (var i = 0, Len = this.length, tArg = arguments[1]; i !== Len; ++i) { f.call(tArg, this[i], i, this); } }\n}; }\nif (!DOMTokenListProto.entries) { DOMTokenListProto.entries = function() {\n    var nextIndex = 0,\n        that = this;\n    return {\n        next: function() {\n            return nextIndex < that.length ? {\n                value: [nextIndex, that[nextIndex]],\n                done: false\n            } : {\n                done: true\n            };\n        }\n    };\n}; }\nif (!DOMTokenListProto.values) { DOMTokenListProto.values = function() {\n    var nextIndex = 0,\n        that = this;\n    return {\n        next: function() {\n            return nextIndex < that.length ? {\n                value: that[nextIndex],\n                done: false\n            } : {\n                done: true\n            };\n        }\n    };\n}; }\nif (!DOMTokenListProto.keys) { DOMTokenListProto.keys = function() {\n    var nextIndex = 0,\n        that = this;\n    return {\n        next: function() {\n            return nextIndex < that.length ? {\n                value: nextIndex,\n                done: false\n            } : {\n                done: true\n            };\n        }\n    };\n}; }\n\n/* Polyfill from https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign */\nif (typeof Object.assign !== 'function') {\n  // Must be writable: true, enumerable: false, configurable: true\n  Object.defineProperty(Object, \"assign\", {\n    value: function assign(target, varArgs) { // .length of function is 2\n      var arguments$1 = arguments;\n\n      if (target === null || target === undefined) {\n        throw new TypeError('Cannot convert undefined or null to object');\n      }\n\n      var to = Object(target);\n\n      for (var index = 1; index < arguments.length; index++) {\n        var nextSource = arguments$1[index];\n\n        if (nextSource !== null && nextSource !== undefined) {\n          for (var nextKey in nextSource) {\n            // Avoid bugs when hasOwnProperty is shadowed\n            if (Object.prototype.hasOwnProperty.call(nextSource, nextKey)) {\n              to[nextKey] = nextSource[nextKey];\n            }\n          }\n        }\n      }\n      return to;\n    },\n    writable: true,\n    configurable: true\n  });\n}\n\n/*\n * Polyfill from https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/startsWith\n */\n\nif (!String.prototype.startsWith) {\n    Object.defineProperty(String.prototype, 'startsWith', {\n        value: function(search, rawPos) {\n            var pos = rawPos > 0 ? rawPos|0 : 0;\n            return this.substring(pos, pos + search.length) === search;\n        }\n    });\n}\n\n/*\n * Polyfill from https://developer.mozilla.org/en-US/docs/Web/API/CustomEvent/CustomEvent#Polyfills\n */\n\nif ( typeof window.CustomEvent !== \"function\" ) {\n\twindow.CustomEvent = function ( event, params ) {\n\t\tparams = params || { bubbles: false, cancelable: false, detail: null };\n\t\tvar evt = window.document.createEvent( 'CustomEvent' );\n\t\tevt.initCustomEvent( event, params.bubbles, params.cancelable, params.detail );\n\t\treturn evt;\n\t};\n}\n\n/**\n * Polyfill from https://developer.mozilla.org/en-US/docs/Web/API/Element/matches\n */\n\n// matches polyfill\nvar Element = window.Element;\nif (!Element.prototype.matches) {\n  Element.prototype.matches =\n      Element.prototype.matchesSelector ||\n      Element.prototype.mozMatchesSelector ||\n      Element.prototype.msMatchesSelector ||\n      Element.prototype.oMatchesSelector ||\n      Element.prototype.webkitMatchesSelector ||\n      function(s) {\n        var matches = (this.document || this.ownerDocument).querySelectorAll(s),\n            i = matches.length;\n        while (--i >= 0 && matches.item(i) !== this) {}\n        return i > -1;\n      };\n}\n\n// Polyfill from https://developer.mozilla.org/en-US/docs/Web/API/Element/closest\n// closest polyfill\nif (!Element.prototype.closest) {\n  Element.prototype.closest = function(s) {\n    var el = this;\n    do {\n      if (el.matches(s)) { return el; }\n      el = el.parentElement || el.parentNode;\n    } while (el !== null && el.nodeType === 1);\n    return null;\n  };\n}\n//# sourceMappingURL=index.esm.js.map\n","var CAMEL_TO_KEBAB_RX = /([\\$A-Za-z0-9])([A-Z])/g;\n\nfunction camelToKebab(value) {\n\treturn value.replace(CAMEL_TO_KEBAB_RX, '$1-$2').toLowerCase();\n}\n\nfunction capitalizeFirst(value) {\n\treturn value[0].toUpperCase()+value.substring(1);\n}\n\nfunction kebabToCamel(value) {\n\tvar i = value.indexOf('-');\n\tif (i == -1) { return value; }\n\tvar out = value.substring(0, i);\n\tvar s = i+1;\n\ti = value.indexOf('-', s);\n\twhile (i > -1) {\n\t\tout += capitalizeFirst(value.substring(s, i));\n\t\ts = i+1;\n\t\ti = value.indexOf('-', s);\n\t}\n\tif (s < value.length) {\n\t\tout += capitalizeFirst(value.substring(s));\n\t}\n\treturn out;\n}\n\nexport { camelToKebab, capitalizeFirst, kebabToCamel };\n//# sourceMappingURL=index.esm.js.map\n","import window, { document } from '@qutejs/window';\nimport { kebabToCamel } from '@qutejs/commons';\n\nfunction ERR() {\n\tERR.resolve.apply(null, arguments);\n}\n\nERR.resolve = function() {\n\tthrow new Error('Qute Error: '+Array.prototype.slice.call(arguments));\n};\n\nfunction stopEvent(e) {\n\te.preventDefault();\n\te.stopPropagation();\n}\n\nfunction chainFnAfter(fn, prevFn) {\n\treturn prevFn ? function(arg) {\n\t\tprevFn(arg);\n\t\treturn fn(arg);\n\t} : fn;\n}\n\nfunction closestVM(el) {\n\twhile (el && !el.__qute__) {\n\t\tel = el.parentNode;\n\t}\n\treturn el && el.__qute__;\n}\n\n// filter is a an array whoes first item is true or false. See compiler x-attrs encoding\nfunction filterKeys(obj, filter) {\n\tvar keys = Object.keys(obj);\n\tif (filter) {\n\t\tvar incl = filter[0]; // true: include, false: exclude\n\t\treturn keys.filter(function(key) {\n\t\t\treturn (filter.indexOf(key, 1) > -1) === incl;\n\t\t});\n\t} else {\n\t\treturn keys;\n\t}\n}\n\nvar UpdateQueue = {\n\tmaxNestedLoops: 50,\n\tqueue: [],\n\tafter: null, // routines to run after the queue is processed\n\tpush: function(op) {\n\t\tif (!this.queue.length) { // schedule\n\t\t\tvar self = this;\n\t\t\twindow.setTimeout(function() {\n\t\t\t\tself.run();\n\t\t\t}, 0);\n\t\t}\n\t\tthis.queue.push(op);\n\t},\n\t// Add a callback to be invoked after the current queue run. If the queue is empty then the callback is immediately run\n\t// As queue tasks may push tasks into the queue, pushing a regular task in the queue after an update does not guarantee\n\t// the task will be run at the end.\n\t// This is usefull to test (to make assertion after all the uopdates where done)\n\t// Usually this method is called after an update\n\trunAfter: function(runAfterCb) {\n\t\tif (!this.queue.length) {\n\t\t\trunAfterCb();\n\t\t} else {\n\t\t\tif (!this.after) { this.after = [runAfterCb]; }\n\t\t\telse { this.after.push(runAfterCb); }\n\t\t}\n\t},\n\trun: function() {\n\t\tvar queue = this.queue;\n\t\tvar cnt = queue.length;\n\t\tvar max = cnt+this.maxNestedLoops; // allowed iteration to avoid infintite loops\n\t\twhile (queue.length > 0) {\n\t\t\tqueue[0]();\n\t\t\t// remove from queue after execution\n\t\t\tqueue.shift();\n\t\t\tif (++cnt > max) { ERR(30); }\n\t\t}\n\n\t\t// run the 'after' routines if any\n\t\tif (this.after) {\n\t\t\tvar after = this.after;\n\t\t\tfor (var i=0,l=after.length; i<l; i++) {\n\t\t\t\tafter[i]();\n\t\t\t}\n\t\t\tthis.after = null; // clear the after array\n\t\t}\n\t}\n\n};\n\nfunction Context(data) {\n\tif (data) { Object.assign(this, data); }\n\tthis.$topics = {lifecycle:[]}; // lifecycle is a bultin topic\n}\n\nContext.prototype = {\n\tpost: function(topic, msg, data) {\n\t\tvar listeners = this.$topics[topic];\n\t\tif (!listeners) { ERR(38, topic); }\n\t\tfor (var i=0,l=listeners.length;i<l;i++) {\n\t\t\tif (listeners[i](msg, data) === false) {\n\t\t\t\tbreak; // stop if one of the listeners returns false\n\t\t\t}\n\t\t}\n\t},\n\tpostAsync: function(topic, msg, data) {\n\t\tvar self = this;\n\t\twindow.setTimeout(function() { self.post(topic, msg, data); }, 0);\n\t},\n\tsubscribe: function(topic, listenerFn) {\n\t\tvar listeners = this.$topics[topic];\n\t\tif (!listeners) {\n\t\t\tthis.$topics[topic] = listeners = [];\n\t\t}\n\t\tlisteners.push(listenerFn);\n\t\treturn this;\n\t},\n\tsubscribeOnce: function(topic, event, listenerFn) {\n\t\tvar self = this;\n\t\tvar onceSubscription = function(msg, data) {\n\t\t\tif (msg === event) {\n\t\t\t\tlistenerFn(msg, data);\n\t\t\t\tself.unsubscribe(topic, onceSubscription);\n\t\t\t}\n\t\t};\n\t\tthis.subscribe(topic, onceSubscription);\n\t\treturn onceSubscription;\n\t},\n\tunsubscribe: function(topic, listenerFn) {\n\t\tvar listeners = this.$topics[topic];\n\t\tif (listeners) {\n\t\t\tvar i = listeners.indexOf(listenerFn);\n\t\t\tif (i > -1) {\n\t\t\t\tlisteners.splice(i, 1);\n\t\t\t}\n\t\t}\n\t},\n\tfreeze: function() {\n\t\tObject.freeze(this);\n\t}\n};\n\nvar VMS = {};\nvar XTAGS = {};\n\nfunction getTag(tag) {\n\treturn XTAGS[tag];\n}\n\nfunction registerTag(tag, templateFn, isCompiled) {\n\tXTAGS[tag] = templateFn;\n\ttemplateFn.$compiled = !!isCompiled;\n\ttemplateFn.$tag = tag;\n\treturn templateFn;\n}\n\nfunction getVM(tag) {\n\treturn VMS[tag];\n}\n\nfunction registerVM(tag, vm) {\n\tVMS[tag] = vm;\n}\n\nfunction getVMOrTag(tag) {\n\treturn VMS[tag] || XTAGS[tag];\n}\n\nfunction snapshotRegistry() {\n\treturn {VMS: Object.assign({}, VMS), XTAGS: Object.assign({}, XTAGS)};\n}\n\nfunction restoreRegistry(snapshot) {\n\tVMS = snapshot.VMS;\n\tXTAGS = snapshot.XTAGS;\n}\n\nfunction addClassMap(cl, value) {\n\tvar keys = Object.keys(value);\n\tfor (var i=0,l=keys.length; i<l; i++) {\n\t\tvar key = keys[i];\n\t\tvar val = value[key];\n\t\tif (val) { cl.add(key); } else { cl.remove(key); }\n\t}\n}\n\nfunction bindClass(elt, value) {\n\tif (!value) { return; }\n\tvar cl = elt.classList;\n\tif (Array.isArray(value)) {\n\t\tfor (var i=0,l=value.length; i<l; i++) {\n\t\t\tvar val = value[i];\n\t\t\tif (val) {\n\t\t\t\tif (typeof val === 'string') {\n\t\t\t\t\tcl.add(val);\n\t\t\t\t} else { // an object?\n\t\t\t\t\taddClassMap(cl, val);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} else { // an object\n\t\taddClassMap(cl, value);\n\t}\n}\n\nfunction bindStyle(elt, value) {\n\tif (!value) { return; }\n\tvar style = elt.style;\n\tif (Array.isArray(value)) {\n\t\tfor (var i=0,l=value.length; i<l; i++) {\n\t\t\tObject.assign(style, value[i]);\n\t\t}\n\t} else { // an object\n\t\tObject.assign(style, value);\n\t}\n\n}\n\n// the listeners injected from a vm to a nested functional view\n// must run in parent vm, context not in fucntional view context!\n// This is why we need to use the vm from the closure scope when the listener was created\nfunction createListener(vm, fn) {\n\treturn function(e) {\n\t\tif (fn.call(vm, e) === false) {\n\t\t\tstopEvent(e);\n\t\t}\n\t};\n}\n\nfunction createListeners(vm, $listeners) {\n\tif ($listeners) {\n\t\tfor (var key in $listeners) {\n\t\t\t$listeners[key] = createListener(vm, $listeners[key]);\n\t\t}\n\t}\n\treturn $listeners;\n}\n\nfunction SetText(el, model, expr) {\n\treturn function() {\n\t\tvar val = expr(model);\n\t\tif (val !== el.nodeValue) {\n\t\t\tel.nodeValue = val;\n\t\t}\n\t}\n}\n\nfunction SetAttr(el, model, key, valFn) {\n\treturn function(changedKey) {\n\t\t//if (!changedKey || changedKey === key) {\n\t\t\tvar val = valFn(model);\n\t\t\tif (el.getAttribute(key) !== val) {\n\t\t\t\tif (val == null) {\n\t\t\t\t\tel.removeAttribute(key);\n\t\t\t\t} else {\n\t\t\t\t\tel.setAttribute(key, val);\n\t\t\t\t}\n\t\t\t}\n\t\t//}\n\t}\n}\n\n/*\nexport function SetBindings(el, model, bindFn) {\n\treturn function(changedKey) {\n\t\tvar bindings = bindFn(model);\n\t\tfor (var key in bindings) {\n\t\t\tvar val = bindings[key];\n\t\t\tif (el.getAttribute(key) !== val) {\n\t\t\t\tel.setAttribute(key, val);\n\t\t\t}\n\t\t}\n\t}\n}\n*/\nfunction SetInnerHTML(el, model, valFn) {\n\treturn function() {\n\t\tvar val = valFn(model);\n\t\tif (el.innerHTML !== val) {\n\t\t\tel.innerHTML = val || '';\n\t\t}\n\t}\n}\n\nfunction SetDisplay(el, model, valFn) {\n\treturn function() {\n\t\tvar val = valFn(model);\n\t\tvar display = el.style.display;\n\t\t// backup the current diaply when toggliong OFF to be able to restore if needed\n\t\tif (val) {\n\t\t\tif (display === 'none') {\n\t\t\t\tel.style.display = el.__qute_display || ''; // remove 'none'\n\t\t\t}\n\t\t} else if (display !== 'none') {\n\t\t\tif (el.__qute_display == null) { el.__qute_display = display; }\n\t\t\tel.style.display = 'none';\n\t\t}\n\t}\n}\n\n\nfunction SetToggle(el, model, valFn) {\n\t// valFn returns a map of attr keys to values\n\treturn function() {\n\t\tvar attrs = valFn(model);\n\t\tvar keys = Object.keys(attrs);\n\t\tfor (var i=0,l=keys.length;i<l;i++) {\n\t\t\tvar key = keys[i];\n\t\t\tif (attrs[key]) {\n\t\t\t\tel.setAttribute(key, key);\n\t\t\t} else {\n\t\t\t\tel.removeAttribute(key);\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunction SetClass(el, model, valFn) {\n\treturn function() {\n\t\t//TODO only if modified\n\t\tbindClass(el, valFn(model));\n\t}\n}\n\nfunction SetStyle(el, model, valFn) {\n\treturn function() {\n\t\t//TODO only if modified\n\t\tbindStyle(el, valFn(model));\n\t}\n}\n\nfunction SetProp(vm, model, key, valFn) {\n\treturn function(changedKey) {\n\t\t//if (!changedKey || changedKey === key) {\n\t\t\tvm.$set(key, valFn(model));\n\t\t//}\n\t}\n}\n\nfunction SetDOMAttrs(el, model, filter) {\n\treturn function() {\n\t\tvar $attrs = model.$attrs;\n\t\tif ($attrs) {\n\t\t\tvar keys = filterKeys($attrs, filter);\n\t\t\tfor (var i=0,l=keys.length; i<l; i++) {\n\t\t\t\tvar key = keys[i];\n\t\t\t\tel.setAttribute(key, $attrs[key]);\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunction SetFuncAttrs($attrs, vm, filter) { // vm is the parent vm (i.e. current model)\n\treturn function() {\n\t\tvar vmAttrs = vm.$attrs;\n\t\tif (vmAttrs) {\n\t\t\tvar keys = filterKeys(vmAttrs, filter);\n\t\t\tfor (var i=0,l=keys.length; i<l; i++) {\n\t\t\t\tvar key = keys[i];\n\t\t\t\t$attrs[key] = vmAttrs[key];\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunction SetFuncAttr($attrs, vm, key, val) { // vm is the parent vm (i.e. current model)\n\treturn function() {\n\t\t$attrs[key] = val(vm);\n\t}\n}\n// TODO set $attrs on VMs\nfunction SetVMAttrs(vm, parentVM, filter) {\n\treturn function() {\n\t\tvar parentAttrs = parentVM.$attrs;\n\t\tif (parentAttrs) {\n\t\t\tvar keys = filterKeys(parentAttrs, filter);\n\t\t\tfor (var i=0,l=keys.length; i<l; i++) {\n\t\t\t\tvar key = keys[i];\n\t\t\t\tvm.$set(key, parentAttrs[key]);\n\t\t\t}\n\t\t}\n\t}\n}\n\n// emitter prototype\nvar Emitter = {\n\temit: function(event, data) {\n\t\tif (!this.$el) { ERR(35); }\n\t\tthis.$el.dispatchEvent(new window.CustomEvent(event, {bubbles: true, detail: data === undefined ? this : data }));\n\n\t},\n\temitAsync: function(event, data, timeout) {\n\t\tvar self = this;\n\t\twindow.setTimeout(function() { self.emit(event, data); }, timeout || 0);\n\t}\n};\n\nfunction ViewRenderingContext(model, marker, isExpr, changeCb, noCache, xattrs, childrenFn) {\n\n\tvar cache = noCache ? null : {};\n\tvar r = null; // the view rendering context\n\tvar cview = null; // current element\n\treturn function(propKey, initialUpdate) {\n\t\tvar el, viewXTag = isExpr(model);\n\t\tif (viewXTag !== cview) {\n\t\t\tvar parent = marker.parentNode;\n\t\t\tif (r) {\n\t\t\t\tr.$disconnect();\n\t\t\t\tparent.removeChild(marker.previousSibling);\n\t\t\t}\n\t\t\tif (viewXTag) {\n\t\t\t\tr = cache && cache[viewXTag];\n\t\t\t\tif (!r) {\n\t\t\t\t\tr = new Rendering(model);\n\t\t\t\t\tif (cache) { cache[viewXTag] = r; }\n\t\t\t\t}\n\t\t\t\tel = r.r(viewXTag, xattrs, childrenFn(r));\n\t\t\t\tparent.insertBefore(el, marker);\n\t\t\t\tr.$connect();\n\t\t\t} else {\n\t\t\t\tr = null;\n\t\t\t}\n\n\t\t\tif (changeCb && !initialUpdate) { // avoid calling changeCb the first time the if is rendered\n\t\t\t\tchangeCb.call(model, el && el.__qute__);\n\t\t\t}\n\t\t\tcview = viewXTag;\n\t\t} else if (r) {\n\t\t\t// only update children\n\t\t\tr.$update();\n\t\t}\n\t}\n}\n\nfunction IfRenderingContext(model, start, end, expr, changeCb, _if, _else) {\n\tvar r = null; // the IF / ELSE rendering context\n\tvar state = undefined; // the current IF / ELSE value\n\treturn function(propKey, initialUpdate) {\n\t\tvar newState = !!expr(model);\n\t\tif (newState !== state) {\n\t\t\tr && r.$disconnect();\n\t\t\tvar parent = start.parentNode;\n\t\t\t// remove current if branch\n\t\t\twhile (start.nextSibling && start.nextSibling !== end) {\n\t\t\t\tparent.removeChild(start.nextSibling);\n\t\t\t}\n\t\t\tr = new Rendering(model); // create the IF / ELSE rendering context\n\t\t\tstate = newState;\n\t\t\tvar children = state ? _if(r) : (_else ? _else(r) : []); //_else may not be defined\n\t\t\tfor (var i=0,l=children.length; i<l; i++) {\n\t\t\t\tparent.insertBefore(children[i], end);\n\t\t\t}\n\t\t\tr.$connect();\n\t\t\tif (changeCb && !initialUpdate) { // avoid calling changeCb the first time the if is rendered\n\t\t\t\tchangeCb.call(model, state);\n\t\t\t}\n\t\t} else if (r) {\n\t\t\t// only update children\n\t\t\tr.$update();\n\t\t}\n\t}\n}\n\nfunction ForRenderingContext(model, start, end, listFn, iterationFn) {\n\tvar r = null; // the for rendering context\n\tvar list = null; // the current list\n\treturn function(propKey) {\n\t\tvar newList = listFn(model);\n\t\tif (newList !== list) {\n\t\t\tr && r.$disconnect();\n\t\t\tvar parent = start.parentNode;\n\t\t\t// remove current for content\n\t\t\twhile (start.nextSibling && start.nextSibling !== end) {\n\t\t\t\tparent.removeChild(start.nextSibling);\n\t\t\t}\n\t\t\tr = new Rendering(model); // create the FOR rendering context\n\t\t\tlist = newList;\n\t\t\t// render content\n\t\t\tif (list) {\n\t\t\t\tif (!Array.isArray(list)) {\n\t\t\t\t\t//if (list instanceof List) ERR(25);\n\t\t\t\t\tif (list.$createListFragment) { ERR(25); }\n\t\t\t\t\tlist = Object.keys(list);\n\t\t\t\t}\n\t\t\t\tif (list.length > 0) {\n\t\t\t\t\tvar l = list.length-1;\n\t\t\t\t\tfor (var i=0; i<l; i++) {\n\t\t\t\t\t\tvar children = iterationFn(list[i], i, true);\n\t\t\t\t\t\tif (children) {\n\t\t\t\t\t\t\tfor (var k=0,ll=children.length; k<ll; k++) {\n\t\t\t\t\t\t\t\tparent.insertBefore(children[k], end);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tvar children = iterationFn(list[i], i, false);\n\t\t\t\t\tif (children) {\n\t\t\t\t\t\tfor (var i=0,l=children.length; i<l; i++) {\n\t\t\t\t\t\t\tparent.insertBefore(children[i], end);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tr.$connect();\n\t\t} else if (r) {\n\t\t\t// just update children\n\t\t\tr.$update();\n\t\t}\n\t}\n}\n\nfunction isVM(obj) {\n\treturn obj && obj.prototype && obj.prototype.__VM__;\n}\n\nfunction appendChildren(parent, children) {\n\tfor (var i=0, l=children.length; i<l; i++) { parent.appendChild(children[i]); }\n}\n\nfunction applyListeners(el, vm, listeners, doNotWrap) {\n\tfor (var key in listeners) {\n\t\tvar fn = listeners[key];\n\t\tif (key === 'create') {\n\t\t\tfn.call(el, vm);\n\t\t} else {\n\t\t\tel.addEventListener(key, doNotWrap ? fn : createListener(vm, fn));\n\t\t}\n\t}\n}\n\nfunction extractSlots(children) {\n\tif (children && children.length) {\n\t\tvar namedSlots = {}, nestedCnt = 0, hasContent = false;\n\t\tfor (var i=0,l=children.length; i<l; i++) {\n\t\t\tvar child = children[i];\n\t\t\tvar nodeType = child.nodeType;\n\t\t\tswitch (nodeType) {\n\t\t\t\tcase 1:\n\t\t\t\t\tif (child.nodeName === 'NESTED') { // select only 'nested' elements\n\t\t\t\t\t\tvar slot = child.getAttribute('name') || 'default';\n\t\t\t\t\t\tvar slotChildren = [];\n\t\t\t\t\t\tvar node = child.firstChild;\n\t\t\t\t\t\twhile (node) {\n\t\t\t\t\t\t\tslotChildren.push(node);\n\t\t\t\t\t\t\tnode = node.nextSibling;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tnamedSlots[slot] = slotChildren;\n\t\t\t\t\t\tnestedCnt++;\n\t\t\t\t\t} else {\n\t\t\t\t\t\thasContent = true;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 3:\n\t\t\t\t\tif (child.nodeValue.trim()) { hasContent = true; }\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (nestedCnt) {\n\t\t\treturn namedSlots;\n\t\t} else if (hasContent) { // default slot\n\t\t\tnamedSlots.default = children;\n\t\t\treturn namedSlots;\n\t\t}\n\t}\n\treturn null;\n}\n\n// ==============================================\n\n\nvar RenderingProto = {\n\tx: function(expr) { // expression {{ ... }}\n\t\tvar text = expr(this.vm);\n\t\tvar el = document.createTextNode(text);\n\t\tthis.up(SetText(el, this.vm, expr));\n\t\treturn el;\n\t},\n\tt: function(value) { // text\n\t\treturn document.createTextNode(value);\n\t},\n\tg: function(isFn, xattrs, children) { // dynamic tag using 'is'\n\t\tvar tag = isFn(this.vm);\n\t\tvar XTag = getVMOrTag(tag);\n\t\treturn XTag ? this.v(XTag, xattrs, children) : this.h(tag, xattrs, children);\n\t},\n\th: function(tag, xattrs, children) { // dom node\n\t\tvar el = document.createElement(tag);\n\t\tif (xattrs) {\n\t\t\tvar vm = this.vm;\n\t\t\tfor (var key in xattrs) {\n\t\t\t\tvar up = null;\n\t\t\t\tvar val = xattrs[key];\n\t\t\t\tif (key.charCodeAt(0) === 36) { // $ - extended attribute\n\t\t\t\t\tif (key === '$on') {\n\t\t\t\t\t\tapplyListeners(el, vm, val);\n\t\t\t\t\t} else if (key === '$class') {\n\t\t\t\t\t\tup = SetClass(el, vm, val);\n\t\t\t\t\t} else if (key === '$style') {\n\t\t\t\t\t\tup = SetStyle(el, vm, val);\n\t\t\t\t\t} else if (key === '$show') {\n\t\t\t\t\t\tup = SetDisplay(el, vm, val);\n\t\t\t\t\t} else if (key === '$toggle') {\n\t\t\t\t\t\tup = SetToggle(el, vm, val);\n\t\t\t\t\t} else if (key === '$html') {\n\t\t\t\t\t\tup = SetInnerHTML(el, vm, val);\n\t\t\t\t\t} else if (key === '$attrs') {\n\t\t\t\t\t\tup = SetDOMAttrs(el, vm, val);\n\t\t\t\t\t} else if (key === '$listeners') {\n\t\t\t\t\t\t//TODO filter like for $attrs\n\t\t\t\t\t\t//TODO value must be a function ... and not use directly vm.$listeners\n\t\t\t\t\t\tapplyListeners(el, vm, vm.$listeners, true); // do not wrap listeners fns (already wrapped by the parent context)\n\t\t\t\t\t\t//TODO\n\t\t\t\t\t} else if (key === '$channel') {\n\t\t\t\t\t\tERR(28, tag);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tERR(26, key);\n\t\t\t\t\t}\n\t\t\t\t} else if (typeof val === 'function') { // a dynamic binding\n\t\t\t\t\tup = SetAttr(el, vm, key, val);\n\t\t\t\t} else {\n\t\t\t\t\tel.setAttribute(key, val);\n\t\t\t\t}\n\t\t\t\tif (up) {\n\t\t\t\t\tthis.up(up)(); // push then execute\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (children) { appendChildren(el, children); }\n\t\treturn el;\n\t},\n\t// element with static children (innerHTML is set from the subtree)\n\thh:function(tag, xattrs, content, type) {\n\t\tvar el = this.h(tag, xattrs);\n\t\tif (type) { // convert can be a function to convert the content before injecting in the dom\n\t\t\tvar converter = Context.Qute.converters[type];\n\t\t\tif (!converter) {\n\t\t\t\tERR(27, type);\n\t\t\t}\n\t\t\tcontent = converter(content, this);\n\t\t}\n\t\tel.innerHTML = content;\n\t\treturn el;\n\t},\n\tr: function(tag, xattrs, children) {\n\t\tvar XTag = getVMOrTag(tag);\n\t\tif (!XTag) { ERR(23, tag); }\n\t\treturn this._v(XTag, xattrs, extractSlots(children));\n\t},\n\tv: function(XTag, xattrs, children) { // xtag is specified as a func reference. TODO No more used\n\t\treturn this._v(XTag, xattrs, extractSlots(children));\n\t},\n\t// vm component\n\t_v: function(XTag, xattrs, slots) { // a vm component (viewmodel)\n\t\tif (isVM(XTag)) {\n\t\t\tvar vm = new XTag(this.vm.$ctx);\n\t\t\treturn vm.$create(this, xattrs, slots);\n\t\t} else if (XTag.$compiled) { // a compiled template\n\t\t\tvar oldVm = this.vm;\n\t\t\tthis.vm = this.functx(this.vm, xattrs, slots);\n\t\t\tvar el = XTag(this, xattrs, slots); // pass xattrs and slots too?\n\t\t\tthis.vm.$el = el;\n\t\t\t// apply root bindings if any (x-class, x-style or x-show)\n\t\t\tif (this.vm.$bindings) {\n\t\t\t\tvar bindings = this.vm.$bindings;\n\t\t\t\tfor (var i=0,l=bindings.length; i<l; i+=2) {\n\t\t\t\t\tvar up = bindings[i](el, oldVm, bindings[i+1]);\n\t\t\t\t\tthis.up(up)();\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (this.vm.$listeners) { applyListeners(el, this.vm, this.vm.$listeners, true); }\n\t\t\tthis.vm = oldVm;\n\t\t\treturn el;\n\t\t} else { // a hand written function\n\t\t\treturn XTag(this, xattrs, slots);\n\t\t}\n\t},\n\ts: function(slotName, defaultChildren) {\n\t\tvar vm = this.vm;\n\t\tvar slots = vm.$slots;\n\t\tvar children = slots && slots[slotName || 'default'] || defaultChildren;\n\t\tif (children) {\n\t\t\tvar frag = document.createDocumentFragment();\n\t\t\tappendChildren(frag, children);\n\t\t\treturn frag;\n\t\t}\n\t\treturn document.createComment('[slot/]'); // placeholder\n\t},\n\tw: function(isExpr, changeCb, noCache, xattrs, childrenFn) { // dynamic view\n\t\tvar marker = document.createComment('[view/]');\n\t\tvar frag = document.createDocumentFragment();\n\t\tfrag.appendChild(marker);\n\t\tvar viewFrag = ViewRenderingContext(this.vm, marker, isExpr, changeCb, noCache, xattrs, childrenFn);\n\t\tmarker.__qute__ = viewFrag;\n\t\tviewFrag(null, true);\n\t\tthis.up(viewFrag);\n\t\treturn frag;\n\t},\n\ti: function(expr, changeCb, _if, _else) { // if / else\n\t\tvar start = document.createComment('[if]');\n\t\tvar end = document.createComment('[/if]');\n\t\tvar frag = document.createDocumentFragment();\n\t\tfrag.appendChild(start);\n\t\tfrag.appendChild(end);\n\t\tvar ieFrag = IfRenderingContext(this.vm, start, end, expr, changeCb, _if, _else);\n\t\tstart.__qute__ = ieFrag;\n\t\tieFrag(null, true);\n\t\tthis.up(ieFrag);\n\t\treturn frag;\n\t},\n\t// dynamic lists - which is tracking changes and update itself\n\tl: function(listFn, iterationFn) {\n\t\tvar list = listFn(this.vm);\n\t\t//if (!list instanceof List)) ERR(24);\n\t\tif (!list.$createListFragment) { ERR(24); }\n\t\treturn list.$createListFragment(this, iterationFn);\n\t},\n\t// static array variant of lists - this cannot be updated it is rendered once at creation\n\ta: function(listFn, iterationFn) {\n\t\tvar start = document.createComment('[for]');\n\t\tvar end = document.createComment('[/for]');\n\t\tvar frag = document.createDocumentFragment();\n\t\tfrag.appendChild(start);\n\t\tfrag.appendChild(end);\n\t\tvar forFrag = ForRenderingContext(this.vm, start, end, listFn, iterationFn);\n\t\tstart.__qute__ = forFrag;\n\t\tforFrag(null);\n\t\tthis.up(forFrag);\n\t\treturn frag;\n\t},\n\tup: function(fn) { // register a live update function\n\t\tthis.ups.push(fn);\n//\t\tthis.ups[this.ups.length-1].push(fn);\n\t\treturn fn;\n\t},\n\t//======\n\t// eval the value of an xattr given the key - if a fucntion invoke the function within the current context otherwise return the value as is\n\teval: function(xattr) {\n\t\treturn typeof xattr === 'function' ? xattr(this.vm) : xattr;\n\t},\n\n\t// connect all nested  VMs\n\t$connect: function() {\n\t\tif (!this.isc) {\n\t\t\tvar vms = this.vms;\n\t\t\tfor (var i=0,l=vms.length; i<l; i++) { vms[i].$connect(); }\n\t\t\tthis.isc = true;\n\t\t}\n\t\treturn this;\n\t},\n\t// disconnect all nested VMs\n\t$disconnect: function() {\n\t\tif (this.isc) {\n\t\t\tvar vms = this.vms;\n\t\t\tfor (var i=0,l=vms.length; i<l; i++) { vms[i].$disconnect(); }\n\t\t\tthis.isc = false;\n\t\t}\n\t\treturn this;\n\t},\n\t$push: function(r) { // push a sub-renderings\n\t\tthis.vms.push(r);\n\t\tif (this.isc) { r.$connect(); }\n\t},\n\t// refresh the DOM - call all nested update functions\n\t$update: function() {\n\t\tvar model = this.vm, ups = this.ups;\n\t\tfor (var i=0,l=ups.length;i<l;i++) { ups[i](model); }\n\t\treturn this;\n\t},\n\tfunctx: function(vm, xattrs, slots) { // functional context\n\t\tvar $attrs = {};\n\t\tvar ctx = {\n\t\t\t$parent: vm,\n\t\t\t$attrs: $attrs,\n\t\t\t$listeners: null,\n\t\t\t$slots: slots,\n\t\t\t$el: null,\n\t\t\t$bindings: null,\n\t\t\temit: Emitter.emit,\n\t\t\temitAsync: Emitter.emitAsync\n\t\t};\n\t\tvar bindings = null;\n\n\t\tif (xattrs) {\n\t\t\tfor (var key in xattrs) { // class, style and show, $attrs, $listeners are ignored\n\t\t\t\tvar val = xattrs[key];\n\t\t\t\tif (key.charCodeAt(0) !== 36 || key === '$html') { // $ - extended attribute -> ignore all extended attrs but $html\n\t\t\t\t\tif (typeof val === 'function') {\n\t\t\t\t\t\tthis.up(SetFuncAttr($attrs, vm, key, val))();\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$attrs[key] = val;\n\t\t\t\t\t}\n\t\t\t\t\t//setFnContextAttr($attrs, vm, key, val);\n\t\t\t\t} else if (key === '$attrs') {\n\t\t\t\t\tif (vm.$attrs) {\n\t\t\t\t\t\t// inject attributes in functional tags\n\t\t\t\t\t\t// we need to create an update function to reinject attrs when model changes\n\t\t\t\t\t\t// otherwise we loose the reactivity on func tags 'x-attrs' attribute\n\t\t\t\t\t\tthis.up(SetFuncAttrs($attrs, vm, val))();\n\t\t\t\t\t}\n\t\t\t\t} else if (key === '$on') {\n\t\t\t\t\tctx.$listeners = createListeners(vm, val);\n\t\t\t\t} else if (key === '$class') {\n\t\t\t\t\tif (!bindings) { bindings = []; }\n\t\t\t\t\tbindings.push(SetClass, val);\n\t\t\t\t} else if (key === '$style') {\n\t\t\t\t\tif (!bindings) { bindings = []; }\n\t\t\t\t\tbindings.push(SetStyle, val);\n\t\t\t\t} else if (key === '$show') {\n\t\t\t\t\tif (!bindings) { bindings = []; }\n\t\t\t\t\tbindings.push(SetDisplay, val);\n\t\t\t\t} else if (key === '$toggle') {\n\t\t\t\t\tif (!bindings) { bindings = []; }\n\t\t\t\t\tbindings.push(SetToggle, val);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tctx.$bindings = bindings;\n\t\treturn ctx;\n\t}\n\n};\n\nfunction Rendering(vm) {\n\tthis.vm = vm; // defaults to current vm -> changed by functional views\n\tthis.ups = [];\n\t// vms are usually ViewModels but can be any object providing $connect and $disconnect methods\n\t// if you enrich the vms api you mustr check list.js since it register a ListFragment instance as a vm\n\tthis.vms = [];\n\tthis.isc = false; // is connected?\n}\nRendering.prototype = RenderingProto;\n\nfunction ListFragment(rendering, listFn) {\n\tthis.start = document.createComment('[list]');\n\tthis.end = document.createComment('[/list]');\n\tthis.r = rendering;\n\tthis.listFn = listFn;\n\tthis.length = 0;\n\n\tthis.updateChildren = function(model) {\n\t\tvar first = this.start.nextSibling;\n\t\tif (!first || first === this.end || !first.$up) { return; }\n\t\tvar n = first, end = this.end;\n\t\twhile (n && n !== end) {\n\t\t\tif (n.$up) {\n\t\t\t\tvar ups = n.$up;\n\t\t\t\tfor (var i=0,l=ups.length;i<l;i++) {\n\t\t\t\t\tups[i](model);\n\t\t\t\t}\n\t\t\t}\n\t\t\tn = n.nextSibling;\n\t\t}\n\t};\n\n\tthis.clear = function() {\n\t\tvar n = this.start;\n\t\tvar end = this.end;\n\t\tvar parent = n.parentNode;\n\t\twhile (n.nextSibling && n.nextSibling !== end) {\n\t\t\tparent.removeChild(n.nextSibling);\n\t\t}\n\t\tif (!n.nextSibling) { ERR(10); }\n\t\tthis.length = 0;\n\t};\n\n\tthis.get = function(index) {\n\t\tif (index < 0 || index > this.length) {\n\t\t\treturn null;\n\t\t}\n\t\tvar l = this.length, n = null;\n\t\tif (index < l/2) { // from start\n\t\t\tn = this.start.nextSibling;\n\t\t\twhile (index-- > 0) { n = n.nextSibling; }\n\t\t} else { // from end\n\t\t\tindex = l - index - 1;\n\t\t\tn = this.end.previousSibling;\n\t\t\twhile (index-- > 0) { n = n.previousSibling; }\n\t\t}\n\t\treturn n;\n\t};\n\n\tthis.getInsertion = function(index) {\n\t\tif (index < 0 || index > this.length) { ERR(11, index, length); }\n\t\tif (index === 0) {\n\t\t\treturn this.start.nextSibling;\n\t\t}\n\t\tif (index === this.length) {\n\t\t\treturn this.end;\n\t\t}\n\t\treturn this.get(index);\n\t};\n\n\tthis.createItem = function(r, item, index, hasNext) {\n\t\treturn listFn(r, item, index, hasNext);\n\t};\n\n\tthis.insert = function(data, from, count) {\n\t\tif (!from) { from = 0; } // if undefined null or 0\n\t\tif (!count) { count = data.length - from; } // if undefined null or 0\n\t\tif (count < 1) { return; }\n\t\tvar l = from+count;\n\t\tvar listFn = this.listFn;\n\t\tvar r = this.r;\n\t\tvar node = this.getInsertion(from);\n\t\tif (!node) { ERR(12, index, this.length); }\n\t\t//TODO redraw if list fragment is broken insted of throwing an error?\n\t\tvar childR, vm = r.vm, parent = node.parentNode;\n\t\tvar ll = l-1;\n\t\tfor (var i=from; i<ll; i++) {\n\t\t\t// we need to wrapp each child in a rendering ctx to be able to disconnect when items are removed\n\t\t\tchildR = new Rendering(vm);\n\t\t\tvar child = this.createItem(childR, data[i], i, true);\n\t\t\tif (child) {\n\t\t\t\tparent.insertBefore(child, node);\n\t\t\t\tr.$push(childR);\n\t\t\t\tchild.__qute_ctx__ = childR;\n\t\t\t}\n\t\t}\n\t\tchildR = new Rendering(vm);\n\t\tvar child = this.createItem(childR, data[ll], ll, l<data.length);\n\t\tif (child) {\n\t\t\tparent.insertBefore(child, node);\n\t\t\tr.$push(childR);\n\t\t\tchild.__qute_ctx__ = childR;\n\t\t}\n\t\tthis.length = data.length;\n\t};\n\n\tthis.remove = function(from, count) {\n\t\tif (from + count > this.length) {\n\t\t\t// TODO enable only if debug mode\n\t\t\t//throw new Error('Removed range exceed the list length: '+from+'#'+count+'. Length is '+this.length);\n\t\t\treturn;\n\t\t}\n\t\tvar node = this.get(from);\n\t\tif (!node) { ERR(13, from, this.length); }\n\t\tvar i=0, parent = this.start.parentNode;\n\t\tnode = node.previousSibling; // cannot be null\n\t\twhile (i++<count) {\n\t\t\tvar child = node.nextSibling;\n\t\t\tchild.__qute_ctx__ && child.__qute_ctx__.$disconnect();\n\t\t\tparent.removeChild(child);\n\t\t}\n\t\tthis.length -= count;\n\t};\n\n\tthis.move = function(from, to) {\n\t\t// TODO this can be optimized (we can search for the 2 nodes in the same time: get2(i1, i2))\n\t\tvar node = this.get(from);\n\t\tif (!node) { ERR(14, from, this.length); }\n\t\tvar dstNode = this.get(to);\n\t\tif (!dstNode) { ERR(15, to, this.length); }\n\t\tdstNode = dstNode.nextSibling;\n\t\tif (dstNode) {\n\t\t\tdstNode.parentNode.insertBefore(node, dstNode);\n\t\t} else {\n\t\t\tdstNode.parentNode.append(node);\n\t\t}\n\t};\n}\n\n\n\nvar AP = Array.prototype;\nvar ListProto = {\n\t$createListFragment: function(rendering, listFn) {\n\t\tvar listRendering = new Rendering(rendering.vm);\n\t\tif (!this.lfs) { this.lfs = []; }\n\t\tvar lf = new ListFragment(listRendering, listFn);\n\t\tvar frag = document.createDocumentFragment();\n\t\tfrag.appendChild(lf.start);\n\t\tfrag.appendChild(lf.end);\n\t\tlf.insert(this.$data); // initialize\n\t\trendering.up(lf.updateChildren.bind(lf)); // register children updates\n\t\tthis.lfs.push(lf);\n\t\trendering.$push(listRendering);\n\t\treturn frag;\n\t},\n\t/*\n\t$destroy: function() { //TODO not used\n\t\tthis.lfs = null;\n\t},\n\t*/\n\t$updateNow: function() {\n\t\tif (this.lfs) {\n\t\t\tvar ops = this.ops;\n\t\t\tvar data = this.$data;\n\t\t\tvar lfs = this.lfs;\n\t\t\tvar l = lfs.length;\n\t\t\twhile (ops.length) {\n\t\t\t\tvar op = ops.shift();\n\t\t\t\tfor (var i=0,l=lfs.length; i<l; i++) {\n\t\t\t\t\top(lfs[i], data);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\t$update: function(op) {\n\t\tif (this.lfs) {\n\t\t\tif (this.ops.push(op) === 1) { // if queue is empty start an update task\n\t\t\t\tvar self = this;\n\t\t\t\tUpdateQueue.push(function() {\n\t\t\t\t\tself.$updateNow();\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t},\n\t$redraw: function() {\n\t\tthis.$update(function(lf, data) {\n\t\t\tlf.clear();\n\t\t\tlf.insert(data);\n\t\t});\n\t},\n\t$insert: function(from, count) {\n\t\tthis.$update(function(lf, data) {\n\t\t\tlf.insert(data, from, count);\n\t\t});\n\t},\n\t$remove: function(from, count) {\n\t\tthis.$update(function(lf, data) {\n\t\t\tlf.remove(from, count);\n\t\t});\n\t},\n\t$move: function(from, to) {\n\t\tthis.$update(function(lf, data) {\n\t\t\tlf.move(from, to);\n\t\t});\n\t},\n\n\ttoJSON: function() {\n\t\treturn this.$data;\n\t},\n\tdata: function() {\n\t\treturn this.$data;\n\t},\n\tnewList: function() {\n\t\treturn new List(this.$data);\n\t},\n\n\tclear: function() {\n\t\tthis.replace([]);\n\t},\n\treplace: function (ar) {\n\t\tthis.$data = ar;\n\t\tthis.$redraw();\n\t},\n\n\tmove: function(from, to) {\n\t\tthis.$data.splice(to, 0, this.$data.splice(from, 1)[0]);\n\t\tthis.$move(from, to);\n\t},\n\n\tremove: function(item) {\n\t\tvar i = this.$data.indexOf(item);\n\t\tif (i > -1) {\n\t\t\treturn this.splice(i, 1);\n\t\t}\n\t},\n\n\tpush: function() {\n\t\tvar from = this.$data.length;\n\t\tvar r = AP.push.apply(this.$data, arguments);\n\t\tthis.$insert(from, arguments.length);\n\t\treturn r;\n\t},\n\tunshift: function() {\n\t\tvar from = this.$data.length;\n\t\tvar r = AP.unshift.apply(this.$data, arguments);\n\t\tthis.$insert(0, arguments.length);\n\t\treturn r;\n\t},\n\tpop: function() {\n\t\tvar r = AP.pop.apply(this.$data, arguments);\n\t\tthis.$remove(this.$data.length, 1);\n\t\treturn r;\n\t},\n\tshift: function() {\n\t\tvar r = AP.shift.apply(this.$data, arguments);\n\t\tthis.$remove(0, 1);\n\t\treturn r;\n\t},\n\tsplice: function(start, deleteCount) {\n\t\tvar argsl = arguments.length;\n\t\tvar len = this.$data.length;\n\t\tvar r = AP.splice.apply(this.$data, arguments);\n\t\tif (argsl === 1) {\n\t\t\tthis.$remove(start, len-start);\n\t\t} else if (argsl === 2) {\n\t\t\tthis.$remove(start, deleteCount);\n\t\t} else { // some inserted items\n\t\t\tif (deleteCount) { this.$remove(start, deleteCount); }\n\t\t\tthis.$insert(start, argsl-2);\n\t\t}\n\t\treturn r;\n\t},\n\tsort: function(cmp) {\n\t\tthis.$data.sort(cmp);\n\t\tthis.$redraw();\n\t\treturn this.$data;\n\t},\n\treverse: function() {\n\t\tthis.$data.reverse();\n\t\tthis.$redraw();\n\t\treturn this.$data;\n\t},\n\tget: function(i) {\n\t\treturn this.$data[i];\n\t},\n\tslice: function() {\n\t\treturn AP.slice.apply(this.$data, arguments);\n\t},\n\tforEach: function(cb, thisArg) {\n\t\tthis.$data.forEach(cb, thisArg);\n\t},\n\tmap: function(cb, thisArg) {\n\t\treturn this.$data.map(cb, thisArg);\n\t},\n\tfilter: function(cb, thisArg) {\n\t\treturn this.$data.filter(cb, thisArg);\n\t},\n\tfind: function(cb, thisArg) {\n\t\treturn this.$data.find(cb, thisArg);\n\t},\n\tfindIndex: function(cb, thisArg) {\n\t\treturn this.$data.findIndex(cb, thisArg);\n\t},\n\treduce: function(cb, initialValue) {\n\t\treturn this.$data.reduce(cb, initialValue);\n\t},\n\treduceRight: function(cb, initialValue) {\n\t\treturn this.$data.reduceRight(cb, initialValue);\n\t},\n\tindexOf: function(elem, from) {\n\t\treturn this.$data.indexOf(elem, from || 0);\n\t},\n\tlastIndexOf: function(elem, from) {\n\t\treturn this.$data.lastIndexOf(elem, from || this.$data.length-1);\n\t},\n\t//TODO add some, every, ...\n};\nObject.defineProperty(ListProto, 'length', {get:function() {return this.$data.length}});\n\nfunction List(data) {\n\tthis.ops = []; // update operations queue\n\tthis.lfs = null; // the list fragment\n\tthis.$data = data || []; // the backed data\n}\nList.prototype = ListProto;\n\nfunction isEnumerable(key) {\n\treturn key.charCodeAt(0) !== 95; // keys starting with _ are not enumerable\n}\n\nfunction defProp(key) {\n\treturn {\n\t\tget: function() {\n\t\t\treturn this.$data[key];\n\t\t},\n\t\tset: function(value) {\n\t\t\tvar old = this.$data[key];\n\t\t\tif (old !== value) {\n\t\t\t\tthis.$data[key] = value;\n\t\t\t\tvar watcher = this.$el && this.$watch && this.$watch[key]; // if not connected whatchers are not enabled\n\t\t\t\t// avoid updating if watcher return false\n\t\t\t\tif (watcher && watcher.call(this, value, old) === false) { return; }\n\t\t\t\tthis.update(key);\n\t\t\t}\n\t\t},\n\t\tenumerable: isEnumerable(key) // keys starting with _ are not enumerable\n\t}\n}\n\nfunction listProp(key) {\n\treturn {\n\t\tget: function() {\n\t\t\treturn this.$data[key];\n\t\t},\n\t\tset: function(value) {\n\t\t\tvar old = this.$data[key];\n\t\t\tif (old !== value) {\n\t\t\t\tif (!value) { // remove list content\n\t\t\t\t\tthis.$data[key].clear();\n\t\t\t\t} else if (Array.isArray(value)) {\n\t\t\t\t\tthis.$data[key].replace(value);\n\t\t\t\t} else if (value instanceof List) {\n\t\t\t\t\t//TODO should we copy the data?\n\t\t\t\t\tif (old) { old.$disconnect(); }\n\t\t\t\t\tthis.$data[key] = value;\n\t\t\t\t} else {\n\t\t\t\t\tERR(31, value);\n\t\t\t\t}\n\t\t\t\tvar watcher = this.$watch && this.$watch[key];\n\t\t\t\t// avoid updating if watcher return false\n\t\t\t\tif (watcher && watcher.call(this, value, old) === false) { return; }\n\t\t\t\tthis.update(key);\n\t\t\t}\n\t\t},\n\t\tenumerable: isEnumerable(key) // keys starting with _ are not enumerable\n\t}\n}\n\nfunction ViewModel(ctx, attrs) {\n\tvar prop = {};\n\t// the attributes set on vm tag which are not declared as props\n\tprop.value = {};\n\tObject.defineProperty(this, '$attrs', prop);\n\t// the app context if any\n\tprop.value = ctx instanceof Context ? ctx : new Context(ctx);\n\tObject.defineProperty(this, '$ctx', prop);\n\t// the listeners registered on the vm tag\n\tprop.value = null;\n\tprop.writable = true;\n\t// the associated rendering context\n\tObject.defineProperty(this, '$r', prop);\n\t// listeners injected through tag attributes (e.g. @click)\n\tObject.defineProperty(this, '$listeners', prop);\n\t// the slots injected by the caller\n\tObject.defineProperty(this, '$slots', prop);\n\t// the view root element\n\tObject.defineProperty(this, '$el', prop);\n\t// chained cleanup functions if any was registered\n\tObject.defineProperty(this, '$clean', prop);\n\t// States: 0 - initial, 1 - connected, 2 - updating\n\tprop.value = 0;\n\tObject.defineProperty(this, '$st', prop); // state: 0 - default, 1 updating , 2 frozen\n\n\tvar data = this.init(ctx) || {};\n\tprop.value = data;\n\tObject.defineProperty(this, '$data', prop);\n\tif (data) {\n\t\tfor (var key in data) {\n\t\t\tObject.defineProperty(this, key, data[key] instanceof List ? listProp(key) : defProp(key));\n\t\t}\n\t}\n\n\tif (!this.render) { ERR(32); }\n\n\t// initialize data model from attributes if any - this will not trigger an update\n\tif (attrs) {\n\t\tvar $data = this.$data;\n\t\tvar $attrs = this.$attrs;\n\t\tObject.keys(attrs).forEach(function(key) {\n\t\t\tvar value = attrs[key];\n\t\t\tif (key in $data) { // a declared property\n\t\t\t\t$data[key] = value;\n\t\t\t} else {\n\t\t\t\tvar camelKey = kebabToCamel(key);\n\t\t\t\tif (camelKey !== key && camelKey in $data) {\n\t\t\t\t\t$data[camelKey] = value;\n\t\t\t\t} else if ($attrs[key] !== value) {\n\t\t\t\t\t// attributes are not camelized\n\t\t\t\t\t$attrs[key] = value;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n}\n\nViewModel.prototype = {\n\t__VM__:true,\n\ttoString: function() {\n\t\treturn 'ViewModel <'+this.$tag+'/>';\n\t},\n\t// set an attribute value (can be either a free property (i.e $attrs[key]) or managed property (i.e. $data[key]))\n\t$set: function(key, value) {\n\t\tif (key in this.$data) { // a declared property\n\t\t\tthis[key] = value;\n\t\t} else {\n\t\t\tvar camelKey = kebabToCamel(key);\n\t\t\tif (camelKey !== key && camelKey in this.$data) {\n\t\t\t\tthis[camelKey] = value;\n\t\t\t} else if (this.$attrs[key] !== value) {\n\t\t\t\t// attributes are not camelized\n\t\t\t\tthis.$attrs[key] = value;\n\t\t\t\tthis.update();\n\t\t\t}\n\t\t}\n\t},\n\t// subscribe to the given channel name - for use on root VMs\n\tlisten: function(channelName) {\n\t\tif (!this.$channel) { ERR(39, this.$tag); }\n\t\t// add an init function\n\t\tthis.$init = chainFnAfter(function(thisObj) {\n\t\t\tthisObj.subscribe(channelName, thisObj.$channel);\n\t\t}, this.$init);\n\t\treturn this;\n\t},\n\t//TODO use setup in listen and $on\n\tsetup: function(setupFn) {\n\t\tthis.$init = chainFnAfter(setupFn, this.$init);\n\t\treturn this;\n\t},\n\tcleanup: function(fn) { // register a cleanup function when component is disconnected\n\t\tthis.$clean = chainFnAfter(fn, this.$clean);\n\t\treturn this;\n\t},\n\t$parent: function() {\n\t\tif (!this.$el) { ERR(35); }\n\t\treturn closestVM(this.$el.parentNode);\n\t},\n\t$root: function() {\n\t\tvar parent = this.$parent();\n\t\treturn parent ? parent.$root() : this;\n\t},\n\t$connect: function() {\n\t\tif (this.$st & 1) { return; } // ignore\n\t\tthis.$st |= 1; // set connected flag\n\t\t// $init may be defined by the prototype to do automatic setup when connected\n\t\t// (e.g. automatic installed listeners defined though VM definitioan 'on' property)\n\t\tif (this.$init) {\n\t\t\tthis.$init(this);\n\t\t}\n\t\tif (this.$listeners) {\n\t\t\tvar listeners = this.$listeners;\n\t\t\tfor (var key in listeners) {\n\t\t\t\tthis.$on(key, listeners[key]);\n\t\t\t}\n\t\t}\n\t\t// connect children vms\n\t\tthis.$r.$connect();\n\t\t// call the connected callback\n\t\tthis.connected && this.connected();\n\t\treturn this;\n\t},\n\t$disconnect: function() {\n\t\tif (!(this.$st & 1)) { return; } // ignore\n\t\tthis.$st ^= 1; // clear connected flag\n\t\tif (this.$clean) {\n\t\t\tthis.$clean();\n\t\t\tthis.$clean = null;\n\t\t}\n\t\tthis.$r.$disconnect(); // disconnect children vms\n\t\tthis.disconnected && this.disconnected();\n\t},\n\t// initialize a vm from tag raw data\n\t$load: function(rendering, xattrs, slots) {\n\t\tvar bindings = null;\n\t\tvar parentVM = rendering.vm;\n\t\tthis.$slots = slots;\n\t\tif (xattrs) {\n\t\t\tfor (var key in xattrs) {\n\t\t\t\tvar val = xattrs[key];\n\t\t\t\tif (key.charCodeAt(0) === 36) { // $ - extended attribute\n\t\t\t\t\tif (key === '$on') {\n\t\t\t\t\t\t//TODO we should make a copy of val since it is modified by createListeners!!!\n\t\t\t\t\t\tthis.$listeners = createListeners(parentVM, val); // use parent vm when creating listeners\n\t\t\t\t\t} else if (key === '$attrs') { // we must not delete keys from xattrs since it can break when vm is loaded by a dynamic component\n\t\t\t\t\t\t//TODO DO WE NEED to add an update fn? x-attrs are static\n\t\t\t\t\t\trendering.up(SetVMAttrs(this, parentVM, val))();\n\t\t\t\t\t} else if (key === '$class') {\n\t\t\t\t\t\tif (!bindings) { bindings = []; }\n\t\t\t\t\t\tbindings.push(SetClass, val);\n\t\t\t\t\t} else if (key === '$style') {\n\t\t\t\t\t\tif (!bindings) { bindings = []; }\n\t\t\t\t\t\tbindings.push(SetStyle, val);\n\t\t\t\t\t} else if (key === '$show') {\n\t\t\t\t\t\tif (!bindings) { bindings = []; }\n\t\t\t\t\t\tbindings.push(SetDisplay, val);\n\t\t\t\t\t} else if (key === '$toggle') {\n\t\t\t\t\t\tif (!bindings) { bindings = []; }\n\t\t\t\t\t\tbindings.push(SetToggle, val);\n\t\t\t\t\t} else if (key === '$channel') {\n\t\t\t\t\t\tthis.listen(val);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tERR(26, key);\n\t\t\t\t\t}\n\t\t\t\t} else if (typeof val === 'function') { // a dynamic binding\n\t\t\t\t\trendering.up(SetProp(this, parentVM, key, val))();\n\t\t\t\t} else { // static binding\n\t\t\t\t\tthis.$set(key, val);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn bindings;\n\t},\n\t$create: function(parentRendering, xattrs, slots) {\n\t\t// load definition\n\t\tvar bindings = parentRendering && this.$load(parentRendering, xattrs, slots);\n\t\tvar rendering = new Rendering(this);\n\t\t// must never return null - for non rendering components like popups we return a comment\n\t\tvar el = this.render(rendering) || document.createComment('<'+this.$tag+'/>');\n\t\tthis.$r = rendering;\n\t\tel.__qute__ = this;\n\t\tthis.$el = el;\n\t\tif (bindings) { for (var i=0,l=bindings.length; i<l; i+=2) {\n\t\t\tvar binding = bindings[i];\n\t\t\tvar up = bindings[i](el, parentRendering.vm, bindings[i+1]);\n\t\t\tparentRendering.up(up)();\n\t\t} }\n\t\tthis.created && this.created(el);\n\t\t// this can trigger a connect if tree is already connected (for example when inserting a comp in a connected list)\n\t\tparentRendering && parentRendering.$push(this);\n\t\treturn el;\n\t},\n\n\t// manual mount (only roots must be moutned this way)\n\tmount: function(elOrId, insertBefore) {\n\t\tif (this.$el) { ERR(33); } //TODO should check if connected and if not root\n\t\tvar target;\n\t\tif (elOrId) {\n\t\t\ttarget = typeof elOrId === 'string' ? document.getElementById(elOrId) : elOrId;\n\t\t} else {\n\t\t\ttarget = document.body;\n\t\t}\n\t\tvar el = this.$create();\n\t\tif (insertBefore) {\n\t\t\ttarget.parentNode.insertBefore(el, target);\n\t\t} else {\n\t\t\ttarget.appendChild(el);\n\t\t}\n\t\tthis.$connect();\n\t\t// announce the tree was attached to the DOM\n\t\treturn this;\n\t},\n\t// only manually mounted vms can be unmounted\n\tunmount: function() {\n\t\t// a child vm?\n\t\t//if (this.$p) ERR();\n\t\tif (!this.$el) { ERR(34); } // TODO check if root and mounted\n\t\tthis.$disconnect();\n\t\tthis.$el.parentNode.removeChild(this.$el);\n\t},\n\t$update: function(key) {\n\t\tif (this.$el) { // only if connected\n\t\t\tthis.$r.$update();\n\t\t}\n\t},\n\tupdate: function(key) {\n\t\tif (this.$st === 1) { // only if connected and not already scheduled to update\n\t\t\tthis.$st |= 2; // set updating flag\n\t\t\tvar self = this;\n\t\t\tUpdateQueue.push(function() {\n\t\t\t\tself.$update(key);\n\t\t\t\tself.$st ^= 2; // remove updating flag\n\t\t\t});\n\t\t}\n\t},\n\t$on: function(type/*, selector, cb*/) {\n\t\tif (!this.$el) { ERR(34); }\n\t\t//if (!this.$clean) this.$clean = [];\n\t\tvar selector, cb;\n\t\tif (arguments.length === 3) {\n\t\t\tselector = arguments[1];\n\t\t\tcb = arguments[2];\n\t\t\tif (!cb) {\n\t\t\t\tcb = selector;\n\t\t\t\tselector = null;\n\t\t\t\tif (!cb) { throw new Error('on function requires a callback argument'); }\n\t\t\t}\n\t\t} else if (arguments.length === 2) {\n\t\t\tcb = arguments[1];\n\t\t} else {\n\t\t\tthrow new Error('on function takes 2 or 3 arguments: eventType[, seelctor], callback');\n\t\t}\n\t\tvar self = this;\n\t\tvar wrapper = function(e) {\n\t\t\tif (!selector || e.target.matches(selector)) {\n\t\t\t\tif (cb.call(self, e) === false) {\n\t\t\t\t\tstopEvent(e);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\tthis.$el.addEventListener(type, wrapper);\n\t\tthis.cleanup(function() {\n\t\t\tself.$el.removeEventListener(type, wrapper);\n\t\t});\n\t\t//this.$clean.push(type, wrapper);\n\t},\n\temit: Emitter.emit,\n\temitAsync: Emitter.emitAsync,\n\t// -------- ctx event bus -------------\n\tpost: function(topic, msg, data) {\n\t\tthis.$ctx.post(topic, msg, data);\n\t},\n\tpostAsync: function(topic, msg, data) {\n\t\tthis.$ctx.postAsync(topic, msg, data);\n\t},\n\t// subscribe and register cleanup to remove subscription at disconnect\n\tsubscribe: function(name, listenerFn) {\n\t\tvar ctx = this.$ctx;\n\t\tctx.subscribe(name, listenerFn.bind(this));\n\t\tthis.cleanup(function() {\n\t\t\tctx.unsubscribe(name, listenerFn);\n\t\t});\n\t\treturn this;\n\t},\n\tsubscribeOnce: function(topic, event, listenerFn) {\n\t\tvar ctx = this.$ctx;\n\t\tvar onceSubscription = ctx.subscribeOnce(topic, event, listenerFn.bind(this));\n\t\tthis.cleanup(function() {\n\t\t\tctx.unsubscribe(topic, onceSubscription);\n\t\t});\n\t\treturn this;\n\t},\n\ttoHTML: function() {\n\t\treturn this.$el && this.$el.outerHTML;\n\t},\n\t// ---------------------------------------------\n\tinit: function() {} // do nothing\n};\n\n/**\n * We cannot use Object.assign since getter are lost. So we copy the prop def itself\n */\nfunction assignPropDefs(dst, src) {\n\tvar keys = Object.keys(src);\n    for(var i=0,l=keys.length; i<l; i++) {\n      var key = keys[i];\n      Object.defineProperty(dst, key, Object.getOwnPropertyDescriptor(src, key));\n    }\n    return dst;\n}\n\nfunction Qute(tag, def, BaseVm) {\n\tif (!tag) { ERR(5); }\n\n\tfunction ViewModelImpl(ctx, attrs) {\n\t\tViewModel.call(this, ctx, attrs);\n\t}\n\n\tvar VMType, VMProto;\n\tif (typeof def === 'function') {\n\t\tif (def.prototype instanceof ViewModel)\t{\n\t\t\t// VM is defined as a class\n\t\t\tVMType = def;\n\t\t\tVMProto = VMType.prototype;\n\t\t} else {\n\t\t\t// a rendering function - we simply register the rendering fucntion for the given tag\n\t\t\treturn registerTag(tag, def);\n\t\t}\n\t} else { // VM definition object\n\t\tif (!BaseVm) { BaseVm = ViewModel; }\n\t\tVMProto = Object.create(BaseVm.prototype, {\n\t\t\tconstructor: {value:ViewModelImpl},\n\t\t});\n\t\tif (def) { assignPropDefs(VMProto, def); } // this is preserving getters\n\t\tVMProto.$super = BaseVm.prototype; // to be able to override methods and call the super method if needed\n\t\tViewModelImpl.prototype = VMProto;\n\n\t\tVMType = ViewModelImpl;\n\t}\n\n\t// add the rendering method of the tag if no one was provided\n\tif (!VMProto.render) {\n\t\tVMProto.render = Qute.template(tag);\n\t\tif (!VMProto.render) {\n\t\t\tERR(36, tag);\n\t\t}\n\t}\n\t// add the tag meta property\n\tVMProto.$tag = tag;\n\n\tregisterVM(tag, VMType);\n\n\tVMType.watch = function(prop, fn) {\n\t\tif (!VMProto.$watch) { Object.defineProperty(VMProto, '$watch', {value:{}}); }\n\t\tVMProto.$watch[prop] = fn;\n\t\treturn VMType;\n\t};\n\tVMType.on = function(key, selector, cb) {\n\t\tVMProto.$init = chainFnAfter(function(thisObj) {\n\t\t\tthisObj.$on(key, selector, cb);\n\t\t}, VMProto.$init);\n\t\treturn VMType;\n\t};\n\tVMType.channel = function(listenFn) {\n\t\tVMProto.$channel = listenFn;\n\t\treturn this;\n\t};\n\n\treturn VMType;\n}\n\nQute.List = List;\nQute.ViewModel = ViewModel;\n\n// link a viewmodel to a template. Usefull for classes where defining prototype methods is not part of the class syntax\nQute.link = function(VMType, renderFn) {\n\tVMType.prototype.render = renderFn;\n};\n\n\nvar QUTE_STYLE=null;\nQute.css = function(css) {\n\tvar doc = window.document;\n\tif (!QUTE_STYLE) {\n\t\tvar style = doc.getElementById('--qute-inline-styles');\n\t\tif (!style) {\n\t\t\tstyle = doc.createElement('STYLE');\n\t\t\tstyle.id = '--qute-inline-styles';\n\t\t\tstyle.type = 'text/css';\n\t\t\tstyle.textContent = \"\\n\";\n\t\t\tdoc.head.insertBefore(style, doc.head.firstChild);\n\t\t}\n\t\tQUTE_STYLE = style;\n\t}\n\tQUTE_STYLE.textContent += css;\n};\n\nQute.converters = {};\nContext.Qute = Qute; // we need this to access globals defined in Qute like converters\nQute.Context = Context;\nQute.UpdateQueue = UpdateQueue;\nQute.Rendering = Rendering;\n// render a functional template given its tag name and a model\nQute.render = function(xtagName, model) {\n\treturn getTag(xtagName)(new Rendering(model));\n};\n\nQute.register = registerTag;\nQute.template = getTag;\nQute.snapshotRegistry = snapshotRegistry;\nQute.restoreRegistry = restoreRegistry;\nQute.vm = getVM;\nQute.vmOrTemplate = getVMOrTag;\n\nQute.runAfter = function(cb) { UpdateQueue.runAfter(cb); };\nQute.closest = closestVM;\nQute.ERR = ERR;\n\nexport default Qute;\n//# sourceMappingURL=index.esm.js.map\n","import Qute from '@qutejs/runtime';\nimport window, { document } from '@qutejs/window';\n\n/*\n* Extracted from Backbone.js History 1.1.0\n*/\n\n//helper functions\nvar objectAssign = Object.assign ? Object.assign : function extend(obj, source) {\n  for (var prop in source) {\n    obj[prop] = source[prop];\n  }\n  return obj;\n};\nfunction on(obj, type, fn) {\n  if (obj.attachEvent) {\n    obj['e'+type+fn] = fn;\n    obj[type+fn] = function(){ obj['e'+type+fn]( window.event ); };\n    obj.attachEvent( 'on'+type, obj[type+fn] );\n  } else {\n    obj.addEventListener( type, fn, false );\n  }\n}\nfunction off(obj, type, fn) {\n  if (obj.detachEvent) {\n    obj.detachEvent('on'+type, obj[type+fn]);\n    obj[type+fn] = null;\n  } else {\n    obj.removeEventListener(type, fn, false);\n  }\n}\n\n// handlers were removed - we simply use listeners without regex matching\n//\n// Backbone.History\n// ----------------\n\n// Handles cross-browser history management, based on either\n// [pushState](http://diveintohtml5.info/history.html) and real URLs, or\n// [onhashchange](https://developer.mozilla.org/en-US/docs/DOM/window.onhashchange)\n// and URL fragments.\nvar History = function() {\n  this.listeners = [];\n\n  var self = this;\n  var checkUrl = this.checkUrl;\n  this.checkUrl = function () {\n    checkUrl.apply(self, arguments);\n  };\n\n  // Ensure that `History` can be used outside of the browser.\n  if (typeof window !== 'undefined') {\n    this.location = window.location;\n    this.history = window.history;\n  }\n};\n\n// Cached regex for stripping a leading hash/slash and trailing space.\nvar routeStripper = /^[#\\/]|\\s+$/g;\n\n// Cached regex for stripping leading and trailing slashes.\nvar rootStripper = /^\\/+|\\/+$/g;\n\n// Cached regex for removing a trailing slash.\nvar trailingSlash = /\\/$/;\n\n// Cached regex for stripping urls of hash.\nvar pathStripper = /#.*$/;\n\n// MODIFICATION OF ORIGINAL BACKBONE.HISTORY\n// Has the history handling already been started?\n// History.started = false;\n\n// Set up all inheritable **Backbone.History** properties and methods.\nobjectAssign(History.prototype, {\n\n  // Are we at the app root?\n  atRoot: function() {\n    return this.location.pathname.replace(/[^\\/]$/, '$&/') === this.root;\n  },\n\n  // Gets the true hash value. Cannot use location.hash directly due to bug\n  // in Firefox where location.hash will always be decoded.\n  getHash: function(window) {\n    var match = (window || this).location.href.match(/#(.*)$/);\n    return match ? match[1] : '';\n  },\n\n  // Get the cross-browser normalized URL fragment, either from the URL,\n  // the hash, or the override.\n  getFragment: function(fragment, forcePushState) {\n    if (fragment == null) {\n      if (this._hasPushState || !this._wantsHashChange || forcePushState) {\n        fragment = decodeURI(this.location.pathname + this.location.search);\n        var root = this.root.replace(trailingSlash, '');\n        if (!fragment.indexOf(root)) { fragment = fragment.slice(root.length); }\n      } else {\n        fragment = this.getHash();\n      }\n    }\n    return fragment.replace(routeStripper, '');\n  },\n\n  // Start the hash change handling, returning `true` if the current URL matches\n  // an existing route, and `false` otherwise.\n  start: function(options) {\n    // MODIFICATION OF ORIGINAL BACKBONE.HISTORY\n    // if (History.started) throw new Error(\"LocationBar has already been started\");\n    // History.started = true;\n    this.started = true;\n\n    // Figure out the initial configuration.\n    // Is pushState desired ... is it available?\n    this.options          = objectAssign({root: '/'}, options);\n    this.location         = this.options.location || this.location;\n    this.history          = this.options.history || this.history;\n    this.root             = this.options.root;\n    this._wantsHashChange = this.options.hashChange !== false;\n    this._wantsPushState  = !!this.options.pushState;\n    this._hasPushState    = !!(this.options.pushState && this.history && this.history.pushState);\n    var fragment          = this.getFragment();\n\n    // Normalize root to always include a leading and trailing slash.\n    this.root = ('/' + this.root + '/').replace(rootStripper, '/');\n\n    // Depending on whether we're using pushState or hashes, and whether\n    // 'onhashchange' is supported, determine how we check the URL state.\n    if (this._hasPushState) {\n      on(window, 'popstate', this.checkUrl);\n    } else {\n      on(window, 'hashchange', this.checkUrl);\n    }\n\n    // Determine if we need to change the base url, for a pushState link\n    // opened by a non-pushState browser.\n    this.fragment = fragment;\n    var loc = this.location;\n\n    // Transition from hashChange to pushState or vice versa if both are\n    // requested.\n    if (this._wantsHashChange && this._wantsPushState) {\n\n      // If we've started off with a route from a `pushState`-enabled\n      // browser, but we're currently in a browser that doesn't support it...\n      if (!this._hasPushState && !this.atRoot()) {\n        this.fragment = this.getFragment(null, true);\n        this.location.replace(this.root + '#' + this.fragment);\n        // Return immediately as browser will do redirect to new url\n        return true;\n\n      // Or if we've started out with a hash-based route, but we're currently\n      // in a browser where it could be `pushState`-based instead...\n      } else if (this._hasPushState && this.atRoot() && loc.hash) {\n        this.fragment = this.getHash().replace(routeStripper, '');\n        this.history.replaceState({}, document.title, this.root + this.fragment);\n      }\n\n    }\n\n    if (!this.options.silent) { return this.loadUrl(); }\n  },\n\n  // Disable Backbone.history, perhaps temporarily. Not useful in a real app,\n  // but possibly useful for unit testing Routers.\n  stop: function() {\n    off(window, 'popstate', this.checkUrl);\n    off(window, 'hashchange', this.checkUrl);\n    this.started = false;\n  },\n\n\n  // Checks the current URL to see if it has changed, and if it has,\n  // calls `loadUrl`.\n  checkUrl: function() {\n    var current = this.getFragment();\n    if (current === this.fragment) { return false; }\n    this.loadUrl();\n  },\n\n  // Attempt to load the current URL fragment. If a route succeeds with a\n  // match, returns `true`. If no defined routes matches the fragment,\n  // returns `false`.\n  loadUrl: function(fragment) {\n    fragment = this.fragment = this.getFragment(fragment);\n    var listeners = this.listeners;\n    for (var i=0,l=listeners.length; i<l; i++) {\n      listeners[i](fragment);\n    }\n  },\n\n  // Save a fragment into the hash history, or replace the URL state if the\n  // 'replace' option is passed. You are responsible for properly URL-encoding\n  // the fragment in advance.\n  //\n  // The options object can contain `trigger: true` if you wish to have the\n  // route callback be fired (not usually desirable), or `replace: true`, if\n  // you wish to modify the current URL without adding an entry to the history.\n  navigate: function(fragment, options) {\n    if (!this.started) { return false; }\n    if (!options || options === true) { options = {trigger: !!options}; }\n\n    var url = this.root + (fragment = this.getFragment(fragment || ''));\n\n    // Strip the hash for matching.\n    fragment = fragment.replace(pathStripper, '');\n\n    if (this.fragment === fragment) { return; }\n    this.fragment = fragment;\n\n    // Don't include a trailing slash on the root.\n    if (fragment === '' && url !== '/') { url = url.slice(0, -1); }\n\n    // If pushState is available, we use it to set the fragment as a real URL.\n    if (this._hasPushState) {\n      this.history[options.replace ? 'replaceState' : 'pushState']({}, document.title, url);\n\n    // If hash changes haven't been explicitly disabled, update the hash\n    // fragment to store history.\n    } else if (this._wantsHashChange) {\n      this._updateHash(this.location, fragment, options.replace);\n    // If you've told us that you explicitly don't want fallback hashchange-\n    // based history, then `navigate` becomes a page refresh.\n    } else {\n      return this.location.assign(url);\n    }\n    if (options.trigger) { return this.loadUrl(fragment); }\n  },\n\n  // Update the hash location, either replacing the current entry, or adding\n  // a new one to the browser history.\n  _updateHash: function(location, fragment, replace) {\n    if (replace) {\n      var href = location.href.replace(/(javascript:|#).*$/, '');\n      location.replace(href + '#' + fragment);\n    } else {\n      // Some browsers require that `hash` contains a leading #.\n      location.hash = '#' + fragment;\n    }\n  }\n\n});\n\n\n\n// add some features to History\n\n// a more intuitive alias for navigate\nHistory.prototype.update = function () {\n  this.navigate.apply(this, arguments);\n};\n\n// a generic callback for any changes\nHistory.prototype.onChange = function (callback) {\n  this.listeners.push(callback);\n};\n\n// checks if the browser has pushstate support\nHistory.prototype.hasPushState = function () {\n  // MODIFICATION OF ORIGINAL BACKBONE.HISTORY\n  if (!this.started) {\n    throw new Error(\"only available after LocationBar.start()\");\n  }\n  return this._hasPushState;\n};\n\nvar VARS_RX = /\\$\\{([a-zA-Z_$][a-zA-Z_0-9$]*)\\}/g;\n\nfunction expandVars$1(text, vars) {\n\treturn text.replace(VARS_RX, function(m, p1) {\n\t\tvar val = vars[p1];\n\t\treturn val === undefined ? m : String(val);\n\t})\n}\n\nfunction absPath(path) {\n\treturn path.charCodeAt(0) !== 47 ? '/'+path : path;\n}\n\nvar VARS_RX$1 = /<([^>:]*)(?:\\:([^>]*))?>/;\n\nfunction RxMatcher(rx, vars) {\n\treturn function(segment, params) {\n\t\tvar m = rx.exec(segment);\n\t\tif (m) {\n\t\t\tfor (var i=1, l=m.length; i<l; i++) {\n\t\t\t\tvar v = vars[i-1];\n\t\t\t\tif (v) {\n\t\t\t\t\tvar param = m[i];\n\t\t\t\t\tif (param) {\n\t\t\t\t\t\tif (v.mod) { // remove leading / if any\n\t\t\t\t\t\t\tif (param.charCodeAt(0) === 47) {\n\t\t\t\t\t\t\t\tparam = param.substring(1);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tparams[v.name] = param;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n}\n\nfunction TextMatcher(text) {\n\treturn function(segment, params) {\n\t\treturn segment === text;\n\t}\n}\n\nfunction ANY() { return true; }\nANY.$vars = 100000; // should be the last when sorting\n\nfunction PathBinding(pattern, value) {\n\n\tfunction isModifier(path, index) {\n\t\tif (path.length === index+1 || path.charCodeAt(index+1) === 47) { // next is / or end of path\n\t\t\tswitch (path.charCodeAt(index)) {\n\t\t\t\tcase 63: return 1; // ?\n\t\t\t\tcase 42: return 2; // *\n\t\t\t\tcase 43: return 3; // +\n\t\t\t}\n\t\t}\n\t\treturn 0;\n\t}\n\n\tfunction compilePath(path) {\n\t\tif (path === '/*') { return ANY; }\n\t\tvar i = path.indexOf('<');\n\t\tif (i === -1) { return TextMatcher(path); }\n\n\t\tvar m = VARS_RX$1.exec(path);\n\n\t\tif (!m) { return TextMatcher(path); }\n\n\t\tvar out = '', vars = [];\n\t\twhile (m) {\n\t\t\tvar prefix = m.index > 0 ? path.substring(0, m.index).replace(/\\.\\(\\)\\$\\^\\[\\]\\?\\*\\+/g, '\\\\$1') : null;\n\t\t\tvar nextIndex = m.index+m[0].length, rx = m[2] || '[^/]+';\n\t\t\tvar nextCh = path.charCodeAt(nextIndex);\n\t\t\tvar mod = isModifier(path, nextIndex);\n\t\t\t// if next chars are +/, */, ?/ or +, *, ?\n\t\t\tif (mod) { // ?+* modifier is present\n\t\t\t\tif (prefix && prefix.charCodeAt(prefix.length-1) === 47) {\n\t\t\t\t\t// remove trailing / since it will be included in the rx\n\t\t\t\t\tprefix = prefix.substring(0, prefix.length-1);\n\t\t\t\t} else {\n\t\t\t\t\tthrow new Error('Modifier +, * and ? can be used only on named path segments: '+path);\n\t\t\t\t}\n\t\t\t\t// remove modifier char from path\n\t\t\t\tnextIndex++;\n\t\t\t\tif (mod === 1) {\n\t\t\t\t\trx = '((?:/'+rx+')?)';\n\t\t\t\t} else if (mod === 2) {\n\t\t\t\t\trx = '((?:/'+rx+')*)';\n\t\t\t\t} else if (mod === 3) {\n\t\t\t\t\trx = '((?:/'+rx+')+)';\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\trx = '('+rx+')';\n\t\t\t}\n\t\t\tvars.push({name: m[1].trim(), mod: mod});\n\t\t\tout += prefix ? prefix+rx : rx;\n\t\t\tpath = path.substring(nextIndex);\n\t\t\tm = VARS_RX$1.exec(path);\n\t\t}\n\t\tif (path.length) {\n\t\t\tout += path.replace(/\\.\\(\\)\\$\\^\\[\\]\\?\\*\\+/g, '\\\\$1');\n\t\t}\n\t\tvar matcher = RxMatcher(new RegExp(out), vars);\n\t\tmatcher.$vars = vars.length;\n\t\treturn matcher;\n\t}\n\n\tthis.pattern = absPath(pattern);\n\tthis.match = compilePath(this.pattern);\n\tthis.vars = this.match.$vars || 0; // how many vars in pattern\n\tthis.value = value;\n}\n\nfunction PathMapping(bindings) {\n\tthis.bindings = [];\n\tbindings && this.map(bindings);\n}\n\nPathMapping.prototype = {\n\tadd: function(path, value) {\n\t\tthis.bindings.push(new PathBinding(path, value));\n\t},\n\tmap: function(bindings) {\n\t\tif (bindings) {\n\t\t\tvar self = this;\n\t\t\tObject.keys(bindings).forEach(function(key) {\n\t\t\t\tself.add(key, bindings[key]);\n\t\t\t});\n\t\t\t// sort bindings\n\t\t\tthis.sort();\n\t\t}\n\t},\n\tsort: function() {\n\t\tthis.bindings.sort(function(a, b) {\n\t\t\tvar r = a.vars - b.vars;\n\t\t\treturn r ? r : b.pattern.localeCompare(a.pattern);\n\t\t});\n\t},\n\tget: function(path) {\n\t\tpath = absPath(path);\n\t\tvar params = {};\n\t\tvar bindings = this.bindings;\n\t\tfor (var i=0,l=bindings.length; i<l; i++) {\n\t\t\tvar binding = bindings[i];\n\t\t\tif (binding.match(path, params)) {\n\t\t\t\treturn [binding.value, params];\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n};\n\nfunction detectCycles(redirects, from) {\n\tvar visited = {};\n\tvisited[from] = true;\n\tvar to = redirects[from];\n\twhile (to) {\n\t\tif (visited[to]) { throw new Error('Found a redirection cycle: ['+from+\"] -> [\"+to+\"]\"); }\n\t\tvisited[to] = true;\n\t\tto = redirects[to];\n\t}\n}\n\nfunction Router(bindings) {\n\n\tthis.navigo = new History();\n\tthis.routes = new PathMapping();\n\tthis.redirects = {};\n\n\tbindings && this.map(bindings);\n}\n\nRouter.prototype = {\n\thandlerFromString: function(to) {\n\t\treturn null;\n\t},\n\tcreateRedirect: function(path, to) {\n\t\tto = absPath(to);\n\t\tthis.redirects[path] = to;\n\t\tdetectCycles(this.redirects);\n\t\tvar self = this;\n\t\treturn function(path, params) {\n\t\t\tself.navigate(expandVars$1(to, params), true); // replace the existing entry\n\t\t}\n\t},\n\tmap: function(bindings) {\n\t\tif (bindings) {\n\t\t\tvar self = this;\n\t\t\tObject.keys(bindings).forEach(function(key) {\n\t\t\t\tself.add(key, bindings[key]);\n\t\t\t});\n\t\t}\n\t\treturn this;\n\t},\n\tadd: function(path, to) {\n\t\tpath = absPath(path);\n\t\tvar handler = null;\n\t\tif (typeof to === 'string') {\n\t\t\thandler = this.handlerFromString(path, to);\n\t\t\tif (!handler) { // a redirect?\n\t\t\t\thandler = this.createRedirect(path, to);\n\t\t\t}\n\t\t}\n\t\tif (!handler) {\n\t\t\thandler = to;\n\t\t}\n\t\tthis.routes.add(path, handler);\n\t\treturn this;\n\t},\n\tstart: function(settings) {\n\t\tif (!this.routes.bindings.length) { throw new Error('No routes set!'); }\n\t\tthis.routes.sort();\n\n\t\tvar self = this;\n\t\tthis.navigo.onChange(function(path) {\n\t\t\tvar r = self.routes.get(path);\n\t\t\tif (r) {\n\t\t\t\tr[0](path, r[1]);\n\t\t\t} else {\n\t\t\t\tthrow new Error('No route found for \"'+path+'\"');\n\t\t\t}\n\t\t});\n\t\tvar loadCb = function() {\n\t\t\tself.navigo.start(settings);\n\t\t\twindow.removeEventListener('load', loadCb);\n\t\t};\n\t\twindow.addEventListener('load', loadCb);\n\t\treturn this;\n\t},\n\tstop: function() {\n\t\tthis.navigo.stop();\n\t},\n\tnavigate: function(path, replace) {\n\t\tpath = absPath(path);\n\t\tif (!this.navigo.hasPushState()) {\n\t\t\tpath = '#'+path;\n\t\t}\n\t\tthis.navigo.navigate(path, replace ? {replace:true} : undefined);\n\t},\n\troute: function(path, replace) { // an alias to navigate\n\t\tthis.navigate(path, replace);\n\t},\n\tonChange: function(callback) {\n\t\tthis.navigo.onChange(function(path) {\n\t\t\tcallback(absPath(path));\n\t\t});\n\t},\n\tpath: function() {\n\t\treturn absPath(this.navigo.getFragment());\n\t}\n};\n\nfunction QuteRouter(bindings, quteCtx) {\n\tRouter.call(this, bindings);\n\tthis.ctx = null;\n\tquteCtx && this.install(quteCtx);\n}\n\nvar QuteRouterProto = Object.create(Router.prototype);\nQuteRouterProto.handlerFromString = function(path, to) {\n\tif (to.substring(0, 5) === 'post:') {\n\t\tif (!this.ctx) { throw new Error('Using \"post:\" protocol without a Qute context!'); }\n\t\tvar target = to.substring(5);\n\t\tvar i = target.indexOf('/');\n\t\tif (i === -1) { throw new Error('Invalid message post target. Expecting \"post:channel/message-name\" but got '+to); }\n\t\tvar msg = target.substring(i+1);\n\t\tvar channel = target.substring(0,  i);\n\t\tvar ctx = this.ctx;\n\t\treturn function(path, params) {\n\t\t\tctx.postAsync(expandVars(channel, params), expandVars(msg, params), params);\n\t\t}\n\t}\n\treturn null;\n};\nQuteRouterProto.install = function(ctx) {\n\tif (this.ctx) { throw new Error('Qute Router already installed!'); }\n\tif (ctx.$ctx) { ctx = ctx.$ctx; } // accept Qute components too.\n\tthis.ctx = ctx;\n\tctx.router = this;\n\tctx.subscribe('route', function(msg, data) {\n\t\t// data can be 'true' to replace the current entry in history\n\t\tctx.router.navigate(msg, data);\n\t});\n\treturn this;\n};\n\nQuteRouter.prototype = QuteRouterProto;\n\nQute.Router = QuteRouter;\n\nexport default QuteRouter;\n//# sourceMappingURL=index.esm.js.map\n","import Qute from '@qutejs/runtime';\nimport { document as document$1 } from '@qutejs/window';\n\n/*\n@see https://tympanus.net/codrops/2013/06/25/nifty-modal-window-effects/ for modal effects\n@see https://davidwalsh.name/css-vertical-center for vertical centering using translate\n*/\n\nfunction toggleScroll(enable) {\n\tvar body = document$1.body;\n\tif (enable) {\n        Object.assign(body.style, {overflow: 'initial', height: 'initial'});\n\t} else {\n        Object.assign(body.style, {overflow: 'hidden', height: '100vh'});\n\t}\n}\n\nfunction getFocusableElements(root) {\n\treturn (root || document$1).querySelectorAll('button, a[href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])');\n}\n\nfunction createModal(id, content, effect) {\n\tvar container = document$1.createElement('DIV');\n\tcontainer.id = id;\n\tvar modal = document$1.createElement('DIV');\n\tmodal.className = effect ? 'md-modal md-effect-'+effect : 'md-modal';\n\tmodal.tabIndex = -1;\n\tvar contentEl = document$1.createElement('DIV');\n\tcontentEl.className = 'md-content';\n\tmodal.appendChild(contentEl);\n\tvar overlay = document$1.createElement('DIV');\n\toverlay.className = 'md-overlay';\n\tcontainer.appendChild(modal);\n\tcontainer.appendChild(overlay);\n\n\tif (content.jquery) {\n\t\tcontentEl.appendChild(content[0]);\n\t} else if (typeof content === 'string') {\n\t\tcontentEl.innerHTML = content;\n\t} else if (Array.isArray(content)) {\n\t\tfor (var i=0, l=content.length; i<l; i++) {\n\t\t\tcontentEl.appendChild(content[i]);\n\t\t}\n\t} else { // assume a element\n\t\tcontentEl.appendChild(content);\n\t}\n\n\treturn container;\n}\n\n\nfunction Modal(name, content, settings) {\n\tthis.id = '--qute-modal-'+name;\n\tthis.settings = {\n\t\teffect: null,\n\t\tcloseOnEsc: true,\n\t\tcloseOnClick: true,\n\t\tdisableScroll: true\n\t};\n\tif (settings) {\n\t\tObject.assign(this.settings, settings);\n\t}\n\tthis.el = createModal(this.id, content, settings.effect);\n\tthis.activeElement = null;\n\tthis.cleanup = null;\n}\nModal.prototype = {\n\topen: function() {\n\t\tvar modal = this.el.firstChild;\n\t\tvar cl = modal.classList;\n\t\tif (cl.contains('md-show')) { return; } // already visible\n\n\t\tvar self = this;\n\t\tvar settings = this.settings;\n\t\tsettings.open && settings.open(this);\n\n\t\tcl.add('md-show');\n\t\t// 0. save focus status\n\t\tthis.activeElement = document$1.activeElement; // save the active element before opening\n\t\t// 1. disable scroll\n\t\tif (settings.disableScroll) { toggleScroll(false); }\n\t\t// 2. add click listener to handle close and other actions\n\t\tthis.addListener(this.el, 'click', function(e) {\n\t\t\tvar handled = false, target = e.target;\n\t\t\tif ((target === self.el.lastChild && settings.closeOnClick) || target.classList.contains('md-close')) {\n\t\t\t\t// click on overlay or .md-close\n\t\t\t\tself.close();\n\t\t\t\thandled = true;\n\t\t\t} else if (settings.action) {\n\t\t\t\tvar action = target.getAttribute('data-md-action');\n\t\t\t\tif (action === 'close') {\n\t\t\t\t\tself.close();\n\t\t\t\t\thandled = true;\n\t\t\t\t} else if (action) {\n\t\t\t\t\tsettings.action(action, target);\n\t\t\t\t\thandled = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (handled) {\n\t\t\t\te.preventDefault();\n\t\t\t\te.stopPropagation();\n\t\t\t}\n\t\t});\n\t\t//3. add keydown listener to trap focus inside the modal and to handle close on escape\n\t\tvar focusable = getFocusableElements(modal);\n\t\tvar firstFocusable, lastFocusable;\n\t\tif (focusable.length) {\n\t\t\tfirstFocusable = focusable[0];\n\t\t\tlastFocusable = focusable[focusable.length-1];\n\t\t}\n\t\tthis.addListener(modal, 'keydown', function(e) {\n\t\t\tif (e.keyCode === 27) {\n\t\t\t\tself.settings.closeOnEsc && self.close();\n\t\t\t} else if (firstFocusable && e.keyCode === 9) {\n\t\t\t\tvar toFocus, focus = document$1.activeElement;\n\t\t\t\tif (e.shiftKey) {\n\t\t\t\t\tif (firstFocusable === focus) {\n\t\t\t\t\t\ttoFocus = lastFocusable;\n\t\t\t\t\t}\n\t\t\t\t} else if (lastFocusable === focus) {\n\t\t\t\t\ttoFocus = firstFocusable;\n\t\t\t\t}\n\t\t\t\tif (toFocus) {\n\t\t\t\t\ttoFocus.focus();\n\t\t\t\t\te.preventDefault();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t// acquire focus - set focus on .md-focus marked element otherwise on the modal itself\n\t\tvar toFocus = modal.getElementsByClassName('md-focus')[0] || modal;\n\t\tfunction acquireFocus() {\n\t\t\ttoFocus.focus();\n\t\t\tsettings.ready && settings.ready(this);\n\t\t}\n\t\tif (settings.effect) {\n\t\t\tvar transitionEnd = function() {\n\t\t\t\tacquireFocus();\n\t\t\t\tmodal.firstChild.removeEventListener('transitionend', transitionEnd);\n\t\t\t};\n\t\t\tmodal.firstChild.addEventListener('transitionend', transitionEnd);\n\t\t} else {\n\t\t\tacquireFocus();\n\t\t}\n\t},\n\tclose: function() {\n\t\tthis.el.firstChild.classList.remove('md-show');\n\t\tthis.settings.close && this.settings.close(this);\n\t\tif (this.settings.disableScroll) { toggleScroll(true); }\n\t\tif (this.activeElement) { this.activeElement.focus(); }\n\t\tthis.activeElement = null;\n\t\tif (this.cleanup) {\n\t\t\tthis.cleanup();\n\t\t\tthis.cleanup = null;\n\t\t}\n\t},\n\taddListener: function(el, name, fn) {\n\t\tel.addEventListener(name, fn);\n\t\tvar nextCleanup = this.cleanup;\n\t\tthis.cleanup = function() {\n\t\t\tel.removeEventListener(name, fn);\n\t\t\tnextCleanup && nextCleanup();\n\t\t};\n\t},\n\t// dinamically change the effect\n\teffect: function(effect) {\n\t\tthis.settings.effect = effect;\n\t\tif (this.el) {\n\t\t\tthis.el.firstChild.className = effect ? 'md-modal md-effect-'+effect : 'md-modal';\n\t\t}\n\t}\n\n};\n\nvar css = \"\\n.md-close {\\n\\topacity: .5;\\n}\\n.md-close:hover {\\n\\topacity: .8;\\n}\\n.md-close:before {\\n\\tposition: absolute;\\n\\tright:0;\\n\\ttop:0;\\n\\tcursor: pointer;\\n\\tcontent: \\\"\\\\00d7\\\";\\n\\tfont-size: 24px;\\n\\tline-height: 24px;\\n\\tfont-weight: 500;\\n\\tpadding: 6px 14px;\\n}\\n\\n.md-modal {\\n\\tposition: fixed;\\n\\ttop: 50%;\\n\\tleft: 50%;\\n\\twidth: 50%;\\n\\tmax-width: 630px;\\n\\tmin-width: 320px;\\n\\theight: auto;\\n\\tz-index: 2000;\\n\\tvisibility: hidden;\\n\\t-webkit-backface-visibility: hidden;\\n\\t-moz-backface-visibility: hidden;\\n\\tbackface-visibility: hidden;\\n\\t-webkit-transform: translateX(-50%) translateY(-50%);\\n\\t-moz-transform: translateX(-50%) translateY(-50%);\\n\\t-ms-transform: translateX(-50%) translateY(-50%);\\n\\ttransform: translateX(-50%) translateY(-50%);\\n}\\n.md-modal:focus {\\n\\toutline:none;\\n}\\n\\n.md-show {\\n\\tvisibility: visible;\\n}\\n\\n.md-overlay {\\n\\tposition: fixed;\\n\\twidth: 100%;\\n\\theight: 100%;\\n\\tvisibility: hidden;\\n\\ttop: 0;\\n\\tleft: 0;\\n\\tz-index: 1000;\\n\\topacity: 0;\\n\\tbackground: rgba(0,0,0,0.6);\\n\\t-webkit-transition: all 0.3s;\\n\\t-moz-transition: all 0.3s;\\n\\ttransition: all 0.3s;\\n}\\n\\n.md-show ~ .md-overlay {\\n\\topacity: 1;\\n\\tvisibility: visible;\\n}\\n\\n/* Content styles */\\n.md-content {\\n\\tcolor: #333;\\n\\tbackground: white;\\n\\tposition: relative;\\n\\tborder-radius: 3px;\\n\\tmargin: 0 auto;\\n}\\n\\n/* ---------------------- effects --------------------- */\\n\\n/* Effect 1: Fade in and scale up */\\n.md-effect-scale-up .md-content {\\n\\t-webkit-transform: scale(0.7);\\n\\t-moz-transform: scale(0.7);\\n\\t-ms-transform: scale(0.7);\\n\\ttransform: scale(0.7);\\n\\topacity: 0;\\n\\t-webkit-transition: all 0.3s;\\n\\t-moz-transition: all 0.3s;\\n\\ttransition: all 0.3s;\\n}\\n\\n.md-show.md-effect-scale-up .md-content {\\n\\t-webkit-transform: scale(1);\\n\\t-moz-transform: scale(1);\\n\\t-ms-transform: scale(1);\\n\\ttransform: scale(1);\\n\\topacity: 1;\\n}\\n\\n/* Effect 2: Slide from the right */\\n.md-effect-slide-right .md-content {\\n\\t-webkit-transform: translateX(20%);\\n\\t-moz-transform: translateX(20%);\\n\\t-ms-transform: translateX(20%);\\n\\ttransform: translateX(20%);\\n\\topacity: 0;\\n\\t-webkit-transition: all 0.3s cubic-bezier(0.25, 0.5, 0.5, 0.9);\\n\\t-moz-transition: all 0.3s cubic-bezier(0.25, 0.5, 0.5, 0.9);\\n\\ttransition: all 0.3s cubic-bezier(0.25, 0.5, 0.5, 0.9);\\n}\\n\\n.md-show.md-effect-slide-right .md-content {\\n\\t-webkit-transform: translateX(0);\\n\\t-moz-transform: translateX(0);\\n\\t-ms-transform: translateX(0);\\n\\ttransform: translateX(0);\\n\\topacity: 1;\\n}\\n\\n/* Effect 3: Slide from the bottom */\\n.md-effect-slide-bottom .md-content {\\n\\t-webkit-transform: translateY(20%);\\n\\t-moz-transform: translateY(20%);\\n\\t-ms-transform: translateY(20%);\\n\\ttransform: translateY(20%);\\n\\topacity: 0;\\n\\t-webkit-transition: all 0.3s;\\n\\t-moz-transition: all 0.3s;\\n\\ttransition: all 0.3s;\\n}\\n\\n.md-show.md-effect-slide-bottom .md-content {\\n\\t-webkit-transform: translateY(0);\\n\\t-moz-transform: translateY(0);\\n\\t-ms-transform: translateY(0);\\n\\ttransform: translateY(0);\\n\\topacity: 1;\\n}\\n\\n/* Effect 4: Newspaper */\\n.md-effect-newspaper .md-content {\\n\\t-webkit-transform: scale(0) rotate(720deg);\\n\\t-moz-transform: scale(0) rotate(720deg);\\n\\t-ms-transform: scale(0) rotate(720deg);\\n\\ttransform: scale(0) rotate(720deg);\\n\\topacity: 0;\\n}\\n\\n.md-show.md-effect-newspaper ~ .md-overlay,\\n.md-effect-newspaper .md-content {\\n\\t-webkit-transition: all 0.5s;\\n\\t-moz-transition: all 0.5s;\\n\\ttransition: all 0.5s;\\n}\\n\\n.md-show.md-effect-newspaper .md-content {\\n\\t-webkit-transform: scale(1) rotate(0deg);\\n\\t-moz-transform: scale(1) rotate(0deg);\\n\\t-ms-transform: scale(1) rotate(0deg);\\n\\ttransform: scale(1) rotate(0deg);\\n\\topacity: 1;\\n}\\n\\n/* Effect 5: fall */\\n.md-effect-fall.md-modal {\\n\\t-webkit-perspective: 1300px;\\n\\t-moz-perspective: 1300px;\\n\\tperspective: 1300px;\\n}\\n\\n.md-effect-fall .md-content {\\n\\t-webkit-transform-style: preserve-3d;\\n\\t-moz-transform-style: preserve-3d;\\n\\ttransform-style: preserve-3d;\\n\\t-webkit-transform: translateZ(600px) rotateX(20deg);\\n\\t-moz-transform: translateZ(600px) rotateX(20deg);\\n\\t-ms-transform: translateZ(600px) rotateX(20deg);\\n\\ttransform: translateZ(600px) rotateX(20deg);\\n\\topacity: 0;\\n}\\n\\n.md-show.md-effect-fall .md-content {\\n\\t-webkit-transition: all 0.3s ease-in;\\n\\t-moz-transition: all 0.3s ease-in;\\n\\ttransition: all 0.3s ease-in;\\n\\t-webkit-transform: translateZ(0px) rotateX(0deg);\\n\\t-moz-transform: translateZ(0px) rotateX(0deg);\\n\\t-ms-transform: translateZ(0px) rotateX(0deg);\\n\\ttransform: translateZ(0px) rotateX(0deg);\\n\\topacity: 1;\\n}\\n\\n/* Effect 6: side fall */\\n.md-effect-side-fall.md-modal {\\n\\t-webkit-perspective: 1300px;\\n\\t-moz-perspective: 1300px;\\n\\tperspective: 1300px;\\n}\\n\\n.md-effect-side-fall .md-content {\\n\\t-webkit-transform-style: preserve-3d;\\n\\t-moz-transform-style: preserve-3d;\\n\\ttransform-style: preserve-3d;\\n\\t-webkit-transform: translate(30%) translateZ(600px) rotate(10deg);\\n\\t-moz-transform: translate(30%) translateZ(600px) rotate(10deg);\\n\\t-ms-transform: translate(30%) translateZ(600px) rotate(10deg);\\n\\ttransform: translate(30%) translateZ(600px) rotate(10deg);\\n\\topacity: 0;\\n}\\n\\n.md-show.md-effect-side-fall .md-content {\\n\\t-webkit-transition: all 0.3s ease-in;\\n\\t-moz-transition: all 0.3s ease-in;\\n\\ttransition: all 0.3s ease-in;\\n\\t-webkit-transform: translate(0%) translateZ(0) rotate(0deg);\\n\\t-moz-transform: translate(0%) translateZ(0) rotate(0deg);\\n\\t-ms-transform: translate(0%) translateZ(0) rotate(0deg);\\n\\ttransform: translate(0%) translateZ(0) rotate(0deg);\\n\\topacity: 1;\\n}\\n\\n/* Effect 7:  slide and stick to top */\\n.md-effect-sticky-up {\\n\\ttop: 0;\\n\\t-webkit-transform: translateX(-50%);\\n\\t-moz-transform: translateX(-50%);\\n\\t-ms-transform: translateX(-50%);\\n\\ttransform: translateX(-50%);\\n}\\n\\n.md-effect-sticky-up .md-content {\\n\\t-webkit-transform: translateY(-200%);\\n\\t-moz-transform: translateY(-200%);\\n\\t-ms-transform: translateY(-200%);\\n\\ttransform: translateY(-200%);\\n\\t-webkit-transition: all .3s;\\n\\t-moz-transition: all .3s;\\n\\ttransition: all .3s;\\n\\topacity: 0;\\n}\\n\\n.md-show.md-effect-sticky-up .md-content {\\n\\t-webkit-transform: translateY(0%);\\n\\t-moz-transform: translateY(0%);\\n\\t-ms-transform: translateY(0%);\\n\\ttransform: translateY(0%);\\n\\tborder-radius: 0 0 3px 3px;\\n\\topacity: 1;\\n}\\n\\n\\n\";\n\nQute.css(css);\n\nvar modal_id = 0;\n\n/**\n */\nvar index = Qute(\"modal\", {\n\tinit: function() {\n\t\treturn {\n\t\t\tanimation: null,\n\t\t\tcloseOnEsc: true,\n\t\t\tcloseOnClick: true,\n\t\t\tdisableScroll: true\n\t\t };\n\t},\n\trender: function() {\n\t\treturn document.createComment('[modal]');\n\t},\n\tcreated: function() {\n\t\tvar slots = this.$slots;\n\t\tif (!slots || !slots.default) { throw new Error('<modal> requires a content!'); }\n\n\t\tvar self = this;\n\t\tthis.modal = new Modal('qute-modal-'+(modal_id++), slots.default, {\n\t\t\teffect: this.animation,\n\t\t\tcloseOnEsc:this.closeOnEsc,\n\t\t\tcloseOnClick: this.closeOnClick,\n\t\t\tdisableScroll: this.disableScroll,\n\t\t\topen: function(modal) {\n\t\t\t\tself.emit(\"open\", self.modal.el);\n\t\t\t},\n\t\t\tclose: function(modal) {\n\t\t\t\tself.emit(\"close\", self.modal.el);\n\t\t\t},\n\t\t\tready: function(modal) {\n\t\t\t\tself.emit(\"ready\", self.modal.el);\n\t\t\t},\n\t\t\taction: function(action, target) {\n\t\t\t\tself.emit(\"action\", {modal: self.modal.el, name: action, target: target});\n\t\t\t}\n\t\t});\n\t},\n\tconnected: function() {\n\t\tdocument.body.appendChild(this.modal.el);\n\t},\n\tdisconnected: function() {\n\t\tdocument.body.removeChild(this.modal.el);\n\t},\n\topen: function() {\n\t\tthis.modal.open();\n\t},\n\tclose: function() {\n\t\tthis.modal.close();\n\t}\n}).channel(function(msg) {\n\tif (msg === 'open') {\n\t\tthis.open();\n\t} else if (msg === 'close') {\n\t\tthis.close();\n\t}\n}).watch('animation', function(value) {\n\tthis.modal.effect(value);\n\treturn false;\n}).watch('closeOnEsc', function(value) {\n\tthis.modal.settings.closeOnEsc = !!value;\n\treturn false;\n}).watch('closeOnClick', function(value) {\n\tthis.modal.settings.closeOnClick = !!value;\n\treturn false;\n}).watch('disableScroll', function(value) {\n\tthis.modal.settings.disableScroll = !!value;\n\treturn false;\n});\n\nexport default index;\n//# sourceMappingURL=index.esm.js.map\n","import Qute from '@qutejs/runtime';\nimport window, { document as document$1 } from '@qutejs/window';\n\n//TODO: 1. add position classes to be able to adapt the effects: bottom, top, right, left\n// 2. remove popup.css and use some global animation css?\n// 3. use same api notations and styles with modal.js\n\nfunction toBottom(erect, rect, crect, out) {\n\tout.top = rect.bottom;\n\tif (out.top + erect.height > crect.bottom) { // flip to top\n\t\tout.top = rect.top - erect.height;\n\t}\n}\n\nfunction toTop(erect, rect, crect, out) {\n\tout.top = rect.top - erect.height;\n\tif (out.top < crect.top) { // flip to bottom\n\t\tout.top = rect.bottom;\n\t}\n}\n\nfunction toVStart(erect, rect, crect, out) {\n\tout.top = rect.top;\n\tif (out.top + erect.height > crect.bottom) { // flip\n\t\tout.top = rect.bottom - erect.height;\n\t}\n}\n\nfunction toVEnd(erect, rect, crect, out) {\n\tout.top = rect.bottom - erect.height;\n\tif (out.top < crect.top) { // flip\n\t\tout.top = rect.top;\n\t}\n}\n\nfunction toVCenter(erect, rect, crect, out) {\n\tout.top = rect.top + (rect.height - erect.height) / 2;\n}\n\nfunction toRight(erect, rect, crect, out) {\n\tout.left = rect.right;\n\tif (out.left + erect.width > crect.right) { // flip to left\n\t\tout.left = rect.left - erect.width;\n\t}\n}\n\nfunction toLeft(erect, rect, crect, out) {\n\tout.left = rect.left - erect.width;\n\tif (out.left < crect.left) { // flip to right\n\t\tout.left = rect.right;\n\t}\n}\n\n\nfunction toHStart(erect, rect, crect, out) {\n\tout.left = rect.left;\n\tif (out.left + erect.width > crect.right) { // flip\n\t\tout.left = rect.right - erect.width;\n\t}\n}\n\nfunction toHEnd(erect, rect, crect, out) {\n\tout.left = rect.right - erect.width;\n\tif (out.left < crect.left) { // flip\n\t\tout.left = rect.left;\n\t}\n}\n\nfunction toHCenter(erect, rect, crect, out) {\n\tout.left = rect.left + (rect.width - erect.width) / 2;\n}\n\n\n\nvar POS_FNS = {\n\ttop: toTop,\n\tbottom: toBottom,\n\tleft: toLeft,\n\tright: toRight\n};\n\nvar VALIGN_FNS = {\n\tstart: toVStart,\n\tend: toVEnd,\n\tcenter: toVCenter,\n\ttop: toTop,\n\tbottom: toBottom\n};\n\nvar HALIGN_FNS = {\n\tstart: toHStart,\n\tend: toHEnd,\n\tcenter: toHCenter,\n\tleft: toLeft,\n\tright: toRight\n};\n\n\n\n/*\n* Get the visible client rect contenttaining the target - relative to viewport\n*/\nfunction getVisibleClientRect(target, overflowingParents) {\n\tvar left=0, top=0, right = window.innerWidth, bottom = window.innerHeight;\n\tif (overflowingParents.length) {\n\t\tfor (var i=0,l=overflowingParents.length; i<l; i++) {\n\t\t\tvar parent = overflowingParents[i];\n\t\t\t// TODO bounding client rect includes the border -> use clientRect to remove border?\n\t\t\tvar prect = parent.getBoundingClientRect();\n\t\t\tif (prect.left > left) { left = prect.left; }\n\t\t\tif (prect.right < right) { right = prect.right; }\n\t\t\tif (prect.top > top) { top = prect.top; }\n\t\t\tif (prect.bottom < bottom) { bottom = prect.bottom; }\n\t\t}\n\t}\n\treturn {\n\t\tleft: left, top: top,\n\t\tright: right, bottom: bottom,\n\t\twidth: right-left, height: bottom-top\n\t};\n}\n\nfunction createPopup(content) {\n\tvar el = document$1.createElement('DIV');\n\tel.className = 'qute-popup';\n\tvar style = el.style;\n\tstyle.visibility = 'hidden';\n\tstyle.position = 'absolute';\n\tstyle.overflow = 'hidden'; // needed by some effects (e.g. slide in)\n\n\tvar contentEl = document$1.createElement('DIV');\n\tcontentEl.className = 'qute-popup-content';\n\tcontentEl.style.position = 'relative';\n\tel.appendChild(contentEl);\n\n\tif (content.jquery) {\n\t\tcontentEl.appendChild(content[0]);\n\t} else if (typeof content === 'string') {\n\t\tcontentEl.innerHTML = content;\n\t} else if (Array.isArray(content)) {\n\t\tfor (var i=0, l=content.length; i<l; i++) {\n\t\t\tcontentEl.appendChild(content[i]);\n\t\t}\n\t} else { // assume a element\n\t\tcontentEl.appendChild(content);\n\t}\n\treturn el;\n}\n/*\n * options: closeOnClick, position, align\n */\nfunction Popup(content) {\n\tthis.el = createPopup(content);\n\tthis.pos = 'bottom';\n\tthis.align = 'start';\n\tthis.closeOnClickOpt = true;\n\tthis.effectName = null;\n}\nPopup.prototype = {\n\tupdate: function(anchor) {\n\t\tif (anchor.jquery) { anchor = anchor[0]; }\n\t\tvar crect = getVisibleClientRect(anchor, this.ofs);\n\t\tvar rect = anchor.getBoundingClientRect();\n\t\t// if anchor is not hidden by the overflow then hide the popup\n\t\tif (rect.top >= crect.bottom || rect.bottom <= crect.top\n\t\t\t|| rect.left >= crect.right || rect.right <= crect.left) {\n\t\t\tthis.el.style.visibility = 'hidden';\n\t\t\treturn;\n\t\t}\n\n\t\tvar style = this.el.style;\n\t\t// first check for special modifier 'fill' (before getting the boundingclient rect since setting the height/width will modify the rect)\n\t\tvar align = this.align;\n\t\tif (align === 'fill') {\n\t\t\tif (this.pos ===  'bottom' || this.pos === 'top') {\n\t\t\t\tstyle.width = anchor.offsetWidth+'px';\n\t\t\t} else {\n\t\t\t\tstyle.height = anchor.offsetHeight+'px';\n\t\t\t}\n\t\t\talign = 'start';\n\t\t} else {\n\t\t\tstyle.width && (style.width = '');\n\t\t\tstyle.height && (style.height = '');\n\t\t}\n\n\n\t\tvar erect = this.el.getBoundingClientRect(); // we only need width and height\n\t\tvar out = {};\n\n\t\tvar posFn = POS_FNS[this.pos];\n\t\tif (!posFn) { throw new Error('Invalid position argument: '+this.pos+'. Expecting: top|bottom|left|right'); }\n\t\tposFn(erect, rect, crect, out);\n\n\t\tvar ALIGN_FNS = out.top == null ? VALIGN_FNS : HALIGN_FNS;\n\t\tvar alignFn = ALIGN_FNS[align];\n\t\tif (!alignFn) { throw new Error('Invalid vert align argument: '+align+'. Expecting: '+Object.keys(ALIGN_FNS).join('|')); }\n\t\talignFn(erect, rect, crect, out);\n\n\t\t//var className = out.position+' '+out.align;\n\t\t//if (this.className) className = this.className + ' ' + className;\n\t\t//this.el.className = this.c\n\n\n\t\tstyle.left = (out.left + window.pageXOffset)+'px';\n\t\tstyle.top = (out.top + window.pageYOffset)+'px';\n\t\tstyle.visibility = 'visible';\n\n\t\treturn this;\n\t},\n\topen: function(anchor) {\n\t\t// compute overflowing parents and register scroll listeners\n\t\tif (this.el.parentNode) { // already opened\n\t\t\treturn;\n\t\t}\n\t\tvar updating = false, self = this;\n\t\tvar updateFn = function() {\n\t\t\tif (!updating) {\n\t\t\t\twindow.requestAnimationFrame(function() {\n\t\t\t\t\tself.update(anchor);\n\t\t\t\t\tupdating = false;\n\t\t\t\t});\n\t\t\t\tupdating = true;\n\t\t\t}\n\t\t};\n\t\tvar ofs = [],\n\t\t\tbody = document$1.body,\n\t\t\tparent = anchor.parentNode;\n\t\twhile (parent && parent !== body) {\n\t\t\tif (parent.scrollHeight > parent.clientHeight || parent.scrollWidth > parent.clientWidth) {\n\t\t\t\tofs.push(parent);\n\t\t\t\tparent.addEventListener('scroll', updateFn);\n\t\t\t}\n\t\t\tparent = parent.parentNode;\n\t\t}\n\t\twindow.addEventListener('scroll', updateFn);\n\t\twindow.addEventListener('resize', updateFn);\n\t\t// TODO add resize listener\n\n\t\tthis.ofs = ofs;\n\t\t// add close on click listener\n\t\tvar closeOnClick;\n\t\tif (this.closeOnClickOpt) {\n\t\t\tcloseOnClick = function(e) {\n\t\t\t\tif (!self.el.contains(e.target)) {\n\t\t\t\t\tself.close();\n\t\t\t\t}\n\t\t\t};\n\n\t\t\twindow.setTimeout(function() {\n\t\t\t\tdocument$1.addEventListener('click', closeOnClick);\n\t\t\t}, 0);\n\t\t}\n\n\n\t\tthis.cleanup = function() {\n\t\t\tif (closeOnClick) {\n\t\t\t\tdocument$1.removeEventListener('click', closeOnClick);\n\t\t\t}\n\t\t\twindow.removeEventListener('resize', updateFn);\n\t\t\twindow.removeEventListener('scroll', updateFn);\n\t\t\tfor (var i=0,l=ofs.length; i<l; i++) {\n\t\t\t\tofs[i].removeEventListener('scroll', updateFn);\n\t\t\t}\n\t\t};\n\n\t\tthis.onOpen && this.onOpen(this);\n\t\t// mount the popup\n\t\tdocument$1.body.appendChild(this.el);\n\t\t// show it\n\t\tthis.update(anchor);\n\t\tthis.el.classList.add('qute-show');\n\t},\n\tclose: function() {\n\t\tthis.onClose && this.onClose(this);\n\t\tthis.cleanup();\n\t\tvar el = this.el;\n\t\tel.classList.remove('qute-show');\n\t\tif (this.effectName) {\n\t\t\tvar fn = function() {\n\t\t\t\tel.style.visibility = 'hidden';\n\t\t\t\tel.parentNode && el.parentNode.removeChild(el);\n\t\t\t\tel.removeEventListener('transitionend', fn);\n\t\t\t};\n\t\t\tel.addEventListener('transitionend', fn);\n\t\t} else {\n\t\t\tel.style.visibility = 'hidden';\n\t\t\tel.parentNode.removeChild(el);\n\t\t}\n\t},\n\tposition: function(position, align) {\n\t\tif (align === undefined) {\n\t\t\tposition = position.trim();\n\t\t\tvar i = position.indexOf(' ');\n\t\t\tif (i > -1) {\n\t\t\t\talign = position.substring(i+1).trim();\n\t\t\t\tposition = position.substring(0, i);\n\t\t\t}\n\t\t}\n\t\tthis.pos = position;\n\t\tif (align) { this.align = align; }\n\t\treturn this;\n\t},\n\tcloseOnClick: function(closeOnClick) {\n\t\tthis.closeOnClickOpt = closeOnClick;\n\t\treturn this;\n\t},\n\teffect: function(effect) {\n\t\tthis.effectName = effect;\n\t\tthis.el.className = effect ? 'qute-popup qute-effect-'+effect : 'qute-popup';\n\t\treturn this;\n\t}\n};\n\nvar css = \"\\n.qute-popup.qute-effect-fade .qute-popup-content {\\n\\topacity: 0;\\n\\t-webkit-transition: opacity 0.3s;\\n\\t-moz-transition: opacity 0.3s;\\n\\t-ms-transition: opacity 0.3s;\\n\\ttransition: opacity 0.3s;\\n}\\n.qute-popup.qute-effect-fade.qute-show .qute-popup-content {\\n\\topacity: 1;\\n}\\n\\n\\n.qute-popup.qute-effect-slide .qute-popup-content {\\n\\t-webkit-transform: translateY(-20%);\\n\\t-moz-transform: translateY(-20%);\\n\\t-ms-transform: translateY(-20%);\\n\\ttransform: translateY(-20%);\\n\\topacity: 0;\\n\\t-webkit-transition: opacity 0.3s, transform 0.3s;\\n\\t-moz-transition: opacity 0.3s, transform 0.3s;\\n\\t-ms-transition: opacity 0.3s, transform 0.3s;\\n\\ttransition: opacity 0.3s, transform 0.3s;\\n}\\n.qute-popup.qute-effect-slide.qute-show .qute-popup-content {\\n\\t-webkit-transform: translateY(0);\\n\\t-moz-transform: translateY(0);\\n\\t-ms-transform: translateY(0);\\n\\ttransform: translateY(0);\\n\\topacity: 1;\\n}\\n\";\n\nQute.css(css);\n\n/*\nAttributes:\n\n- animation: optional: is set can be one of fade or slidde\n- position is a string in the form of \"position algin\" where\n\tposition is one of: top, bottom, left, right\n\tand align is one of: start, end, center, fill, top, bottom, left, right\n\n\tleft and right align are only valid for vertical positions.\n\ttop and bottom align are ony valid for horizontal positions\n\n- auto-close: boolean - toggle close on click. Defaults to true\n\nThe defaults are: animation: null, position: \"bottom start\", auto-close: true\n*/\nvar index = Qute('popup', {\n\tinit: function init() {\n\t\treturn {\n\t\t\tposition: 'bottom start',\n\t\t\tanimation: null,\n\t\t\tautoClose: true\n\t\t}\n\t},\n\trender: function() {\n\t\treturn document.createComment('[popup]');\n\t},\n\tcreated: function() {\n\t\tvar slots = this.$slots;\n\t\tif (!slots || !slots.default) { throw new Error('<popup> requires a content!'); }\n\t\tthis.popup = new Popup(slots.default).effect(this.animation).position(this.position).closeOnClick(this.autoClose);\n\t\tvar self = this;\n\t\tthis.popup.onOpen = function() {\n\t\t\tself.emit(\"open\", self.popup.el);\n\t\t};\n\t\tthis.popup.onClose = function() {\n\t\t\tself.emit(\"close\", self.popup.el);\n\t\t};\n\t},\n\topen: function(target) {\n\t\tthis.popup.open(target);\n\t},\n\tclose: function() {\n\t\tthis.popup.close();\n\t}\n}).channel(function(msg, data) {\n\tif (msg === 'open') {\n\t\tthis.open(data);\n\t} else if (msg === 'close') {\n\t\tthis.close();\n\t}\n}).watch('position', function(value) {\n\tthis.popup.position(value);\n\treturn false;\n}).watch('animation', function(value) {\n\tthis.popup.effect(value);\n\treturn false;\n}).watch('autoClose', function(value) {\n\tthis.popup.closeOnClick(!!value);\n\treturn false;\n});\n\nexport default index;\n//# sourceMappingURL=index.esm.js.map\n","import { document } from '@qutejs/window';\nimport Qute from '@qutejs/runtime';\n\nvar css = \".spinner {\\n  margin: 0 auto;\\n  text-align: center;\\n}\\n\\n.spinner > div {\\n  width: 18px;\\n  height: 18px;\\n  background-color: #333;\\n\\n  border-radius: 100%;\\n  display: inline-block;\\n  -webkit-animation: sk-bouncedelay 1.4s infinite ease-in-out both;\\n  animation: sk-bouncedelay 1.4s infinite ease-in-out both;\\n}\\n\\n.spinner .bounce1 {\\n  -webkit-animation-delay: -0.32s;\\n  animation-delay: -0.32s;\\n}\\n\\n.spinner .bounce2 {\\n  -webkit-animation-delay: -0.16s;\\n  animation-delay: -0.16s;\\n}\\n\\n@-webkit-keyframes sk-bouncedelay {\\n  0%, 80%, 100% { -webkit-transform: scale(0) }\\n  40% { -webkit-transform: scale(1.0) }\\n}\\n\\n@keyframes sk-bouncedelay {\\n  0%, 80%, 100% {\\n    -webkit-transform: scale(0);\\n    transform: scale(0);\\n  } 40% {\\n    -webkit-transform: scale(1.0);\\n    transform: scale(1.0);\\n  }\\n}\";\n\nQute.css(css);\n\n/*\nQute.register(\"loader-ellipsis\", function($){return $.h(\"div\",{\"class\":\"spinner\"},[$.t(\" \"),$.h(\"div\",{\"class\":\"bounce1\"},null),$.t(\" \"),$.h(\"div\",{\"class\":\"bounce2\"},null),$.t(\" \"),$.h(\"div\",{\"class\":\"bounce3\"},null),$.t(\" \")]);}, true);\n\n\n\n\n\n\n*/\n\nfunction updateStyle(div, color, size) {\n\tvar style = div.style;\n\tif (color) { style.backgroundColor = color; }\n\tif (size) {\n\t\tstyle.width = size;\n\t\tstyle.height = size;\n\t}\n}\n\nvar ellipsis = Qute('spinner', function(r, xattrs) {\n\tvar color = xattrs && xattrs.color;\n\tvar size = xattrs && xattrs.size;\n\n\tvar loader = document.createElement('DIV');\n\tloader.className = 'spinner';\n\n\tvar div = document.createElement('DIV');\n\tupdateStyle(div, color, size);\n\tdiv.className = 'bounce1';\n\tloader.appendChild(div);\n\n\tdiv = document.createElement('DIV');\n\tupdateStyle(div, color, size);\n\tdiv.className = 'bounce2';\n\tloader.appendChild(div);\n\n\tdiv = document.createElement('DIV');\n    updateStyle(div, color, size);\n\tdiv.className = 'bounce3';\n\tloader.appendChild(div);\n\n\treturn loader;\n});\n\nexport default ellipsis;\n//# sourceMappingURL=index.esm.js.map\n"],"names":["window","DOMException","reason","this","message","prototype","Error","checkIfValidClassListEntry","O","V","wsIndex","search","wsRE","DOMTokenList","hasOwnProp","Object","hasOwnProperty","defineProperty","allowTokenListConstruction","skipPropChange","TypeError","toString","toLocaleString","value","add","arguments$1","arguments","a","v","argLen","length","val","ele","proto","i","Len","resStr","className","remove","is","whenPropChanges","evt","event","prop","propertyName","target","srcElement","protoObjProto","strval","tokens","trim","split","resTokenList","oldLen","cI","cLen","sub","innerI","classList","Element","enumerable","get","call","detachEvent","protoObj","toks","configurable","set","newVal","writeable","attachEvent","polyfillClassList","DOMTokenListProto","testClass","document","createElement","item","n","toggle","oldValue","replace","oldToken","newToken","contains","forEach","f","tArg","entries","that","next","done","values","keys","assign","varArgs","to","index","nextSource","nextKey","writable","String","startsWith","rawPos","pos","substring","CustomEvent","params","bubbles","cancelable","detail","createEvent","initCustomEvent","capitalizeFirst","toUpperCase","kebabToCamel","indexOf","out","s","ERR","resolve","apply","stopEvent","e","preventDefault","stopPropagation","chainFnAfter","fn","prevFn","arg","closestVM","el","__qute__","parentNode","filterKeys","obj","filter","incl","key","matches","matchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector","webkitMatchesSelector","ownerDocument","querySelectorAll","closest","parentElement","nodeType","Array","slice","UpdateQueue","maxNestedLoops","queue","after","push","op","self","setTimeout","run","runAfter","runAfterCb","cnt","max","shift","l","Context","data","$topics","lifecycle","post","topic","msg","listeners","postAsync","subscribe","listenerFn","subscribeOnce","onceSubscription","unsubscribe","splice","freeze","VMS","XTAGS","getTag","tag","registerTag","templateFn","isCompiled","$compiled","$tag","getVMOrTag","addClassMap","cl","createListener","vm","createListeners","$listeners","SetAttr","model","valFn","changedKey","getAttribute","removeAttribute","setAttribute","SetInnerHTML","innerHTML","SetDisplay","display","style","__qute_display","SetToggle","attrs","SetClass","elt","isArray","bindClass","SetStyle","bindStyle","SetProp","$set","SetDOMAttrs","$attrs","SetFuncAttrs","vmAttrs","SetFuncAttr","SetVMAttrs","parentVM","parentAttrs","Emitter","emit","$el","dispatchEvent","undefined","emitAsync","timeout","appendChildren","parent","children","appendChild","applyListeners","doNotWrap","addEventListener","extractSlots","namedSlots","nestedCnt","hasContent","child","nodeName","slot","slotChildren","node","firstChild","nextSibling","nodeValue","default","RenderingProto","x","expr","text","createTextNode","up","t","g","isFn","xattrs","XTag","h","charCodeAt","hh","content","type","converter","Qute","converters","r","_v","slots","__VM__","$ctx","$create","oldVm","functx","$bindings","bindings","slotName","defaultChildren","$slots","frag","createDocumentFragment","createComment","w","isExpr","changeCb","noCache","childrenFn","marker","cache","cview","viewFrag","propKey","initialUpdate","viewXTag","$disconnect","removeChild","previousSibling","Rendering","insertBefore","$connect","$update","_if","_else","start","end","state","ieFrag","newState","listFn","iterationFn","list","$createListFragment","forFrag","newList","k","ll","ups","eval","xattr","isc","vms","$push","ctx","$parent","ListFragment","rendering","updateChildren","first","$up","clear","getInsertion","createItem","hasNext","insert","from","count","childR","__qute_ctx__","move","dstNode","append","AP","ListProto","listRendering","lfs","lf","$data","bind","$updateNow","ops","$redraw","$insert","$remove","$move","toJSON","List","ar","unshift","pop","deleteCount","argsl","len","sort","cmp","reverse","cb","thisArg","map","find","findIndex","reduce","initialValue","reduceRight","elem","lastIndexOf","isEnumerable","defProp","old","watcher","$watch","update","listProp","ViewModel","init","render","camelKey","def","BaseVm","ViewModelImpl","VMType","VMProto","create","constructor","dst","src","getOwnPropertyDescriptor","assignPropDefs","$super","template","watch","on","selector","$init","thisObj","$on","channel","listenFn","$channel","listen","channelName","setup","setupFn","cleanup","$clean","$root","$st","$r","connected","disconnected","$load","parentRendering","created","mount","elOrId","getElementById","body","unmount","wrapper","removeEventListener","name","toHTML","outerHTML","link","renderFn","QUTE_STYLE","css","doc","id","textContent","head","xtagName","register","snapshotRegistry","restoreRegistry","snapshot","vmOrTemplate","objectAssign","source","off","History","checkUrl","location","history","routeStripper","rootStripper","trailingSlash","pathStripper","atRoot","pathname","root","getHash","match","href","getFragment","fragment","forcePushState","_hasPushState","_wantsHashChange","decodeURI","options","started","hashChange","_wantsPushState","pushState","loc","hash","replaceState","title","silent","loadUrl","stop","navigate","trigger","url","_updateHash","onChange","callback","hasPushState","VARS_RX","absPath","path","VARS_RX$1","TextMatcher","segment","ANY","PathBinding","pattern","isModifier","m","exec","vars","prefix","nextIndex","rx","mod","matcher","RegExp","param","$vars","compilePath","PathMapping","Router","navigo","routes","redirects","QuteRouter","quteCtx","install","b","localeCompare","binding","handlerFromString","createRedirect","visited","detectCycles","p1","handler","settings","loadCb","route","QuteRouterProto","toggleScroll","enable","document$1","overflow","height","Modal","effect","closeOnEsc","closeOnClick","disableScroll","container","modal","tabIndex","contentEl","overlay","jquery","createModal","activeElement","expandVars","router","open","addListener","handled","lastChild","close","action","firstFocusable","lastFocusable","focusable","keyCode","toFocus","focus","shiftKey","getElementsByClassName","transitionEnd","acquireFocus","ready","nextCleanup","modal_id","animation","toBottom","erect","rect","crect","top","bottom","toTop","toRight","left","right","width","toLeft","POS_FNS","VALIGN_FNS","center","HALIGN_FNS","Popup","visibility","position","createPopup","align","closeOnClickOpt","effectName","anchor","overflowingParents","innerWidth","innerHeight","prect","getBoundingClientRect","getVisibleClientRect","ofs","offsetWidth","offsetHeight","posFn","ALIGN_FNS","alignFn","join","pageXOffset","pageYOffset","updating","updateFn","requestAnimationFrame","scrollHeight","clientHeight","scrollWidth","clientWidth","onOpen","onClose","autoClose","popup","updateStyle","div","color","size","backgroundColor","loader"],"mappings":"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"}