{"version":3,"file":"qute-dev-0.9.0.min.js","sources":["../../core/commons/lib/index.esm.js","../../core/runtime/lib/index.esm.js","../../core/compiler/lib/index.esm.js","../../core/dev/src/loader.js","../../core/dev/src/error-dev.js","../../core/dev/src/index.js"],"sourcesContent":["var CAMEL_TO_KEBAB_RX = /([\\$A-Za-z0-9])([A-Z])/g;\n\nfunction camelToKebab(value) {\n\treturn value.replace(CAMEL_TO_KEBAB_RX, '$1-$2').toLowerCase();\n}\n\nfunction capitalizeFirst(value) {\n\treturn value[0].toUpperCase()+value.substring(1);\n}\n\nfunction kebabToCamel(value) {\n\tvar i = value.indexOf('-');\n\tif (i == -1) { return value; }\n\tvar out = value.substring(0, i);\n\tvar s = i+1;\n\ti = value.indexOf('-', s);\n\twhile (i > -1) {\n\t\tout += capitalizeFirst(value.substring(s, i));\n\t\ts = i+1;\n\t\ti = value.indexOf('-', s);\n\t}\n\tif (s < value.length) {\n\t\tout += capitalizeFirst(value.substring(s));\n\t}\n\treturn out;\n}\n\nexport { camelToKebab, capitalizeFirst, kebabToCamel };\n//# sourceMappingURL=index.esm.js.map\n","import window, { document } from '@qute/window';\nimport { kebabToCamel } from '@qute/commons';\n\nfunction ERR() {\n\tERR.resolve.apply(null, arguments);\n}\n\nERR.resolve = function() {\n\tthrow new Error('Qute Error: '+Array.prototype.slice.call(arguments));\n};\n\nfunction stopEvent(e) {\n\te.preventDefault();\n\te.stopPropagation();\n}\n\nfunction chainFnAfter(fn, prevFn) {\n\treturn prevFn ? function(arg) {\n\t\tprevFn(arg);\n\t\treturn fn(arg);\n\t} : fn;\n}\n\nfunction closestVM(el) {\n\twhile (el && !el.__qute__) {\n\t\tel = el.parentNode;\n\t}\n\treturn el && el.__qute__;\n}\n\n// filter is a an array whoes first item is true or false. See compiler x-attrs encoding\nfunction filterKeys(obj, filter) {\n\tvar keys = Object.keys(obj);\n\tif (filter) {\n\t\tvar incl = filter[0]; // true: include, false: exclude\n\t\treturn keys.filter(function(key) {\n\t\t\treturn (filter.indexOf(key, 1) > -1) === incl;\n\t\t});\n\t} else {\n\t\treturn keys;\n\t}\n}\n\nvar UpdateQueue = {\n\tmaxNestedLoops: 50,\n\tqueue: [],\n\tafter: null, // routines to run after the queue is processed\n\tpush: function(op) {\n\t\tif (!this.queue.length) { // schedule\n\t\t\tvar self = this;\n\t\t\twindow.setTimeout(function() {\n\t\t\t\tself.run();\n\t\t\t}, 0);\n\t\t}\n\t\tthis.queue.push(op);\n\t},\n\t// Add a callback to be invoked after the current queue run. If the queue is empty then the callback is immediately run\n\t// As queue tasks may push tasks into the queue, pushing a regular task in the queue after an update does not guarantee\n\t// the task will be run at the end.\n\t// This is usefull to test (to make assertion after all the uopdates where done)\n\t// Usually this method is called after an update\n\trunAfter: function(runAfterCb) {\n\t\tif (!this.queue.length) {\n\t\t\trunAfterCb();\n\t\t} else {\n\t\t\tif (!this.after) { this.after = [runAfterCb]; }\n\t\t\telse { this.after.push(runAfterCb); }\n\t\t}\n\t},\n\trun: function() {\n\t\tvar queue = this.queue;\n\t\tvar cnt = queue.length;\n\t\tvar max = cnt+this.maxNestedLoops; // allowed iteration to avoid infintite loops\n\t\twhile (queue.length > 0) {\n\t\t\tqueue[0]();\n\t\t\t// remove from queue after execution\n\t\t\tqueue.shift();\n\t\t\tif (++cnt > max) { ERR(30); }\n\t\t}\n\n\t\t// run the 'after' routines if any\n\t\tif (this.after) {\n\t\t\tvar after = this.after;\n\t\t\tfor (var i=0,l=after.length; i<l; i++) {\n\t\t\t\tafter[i]();\n\t\t\t}\n\t\t\tthis.after = null; // clear the after array\n\t\t}\n\t}\n\n};\n\nfunction Context(data) {\n\tif (data) { Object.assign(this, data); }\n\tthis.$topics = {lifecycle:[]}; // lifecycle is a bultin topic\n}\n\nContext.prototype = {\n\tpost: function(topic, msg, data) {\n\t\tvar listeners = this.$topics[topic];\n\t\tif (!listeners) { ERR(38, topic); }\n\t\tfor (var i=0,l=listeners.length;i<l;i++) {\n\t\t\tif (listeners[i](msg, data) === false) {\n\t\t\t\tbreak; // stop if one of the listeners returns false\n\t\t\t}\n\t\t}\n\t},\n\tpostAsync: function(topic, msg, data) {\n\t\tvar self = this;\n\t\twindow.setTimeout(function() { self.post(topic, msg, data); }, 0);\n\t},\n\tsubscribe: function(topic, listenerFn) {\n\t\tvar listeners = this.$topics[topic];\n\t\tif (!listeners) {\n\t\t\tthis.$topics[topic] = listeners = [];\n\t\t}\n\t\tlisteners.push(listenerFn);\n\t\treturn this;\n\t},\n\tsubscribeOnce: function(topic, event, listenerFn) {\n\t\tvar self = this;\n\t\tvar onceSubscription = function(msg, data) {\n\t\t\tif (msg === event) {\n\t\t\t\tlistenerFn(msg, data);\n\t\t\t\tself.unsubscribe(topic, onceSubscription);\n\t\t\t}\n\t\t};\n\t\tthis.subscribe(topic, onceSubscription);\n\t\treturn onceSubscription;\n\t},\n\tunsubscribe: function(topic, listenerFn) {\n\t\tvar listeners = this.$topics[topic];\n\t\tif (listeners) {\n\t\t\tvar i = listeners.indexOf(listenerFn);\n\t\t\tif (i > -1) {\n\t\t\t\tlisteners.splice(i, 1);\n\t\t\t}\n\t\t}\n\t},\n\tfreeze: function() {\n\t\tObject.freeze(this);\n\t}\n};\n\nvar VMS = {};\nvar XTAGS = {};\n\nfunction getTag(tag) {\n\treturn XTAGS[tag];\n}\n\nfunction registerTag(tag, templateFn, isCompiled) {\n\tXTAGS[tag] = templateFn;\n\ttemplateFn.$compiled = !!isCompiled;\n\ttemplateFn.$tag = tag;\n\treturn templateFn;\n}\n\nfunction getVM(tag) {\n\treturn VMS[tag];\n}\n\nfunction registerVM(tag, vm) {\n\tVMS[tag] = vm;\n}\n\nfunction getVMOrTag(tag) {\n\treturn VMS[tag] || XTAGS[tag];\n}\n\nfunction snapshotRegistry() {\n\treturn {VMS: Object.assign({}, VMS), XTAGS: Object.assign({}, XTAGS)};\n}\n\nfunction restoreRegistry(snapshot) {\n\tVMS = snapshot.VMS;\n\tXTAGS = snapshot.XTAGS;\n}\n\nfunction addClassMap(cl, value) {\n\tvar keys = Object.keys(value);\n\tfor (var i=0,l=keys.length; i<l; i++) {\n\t\tvar key = keys[i];\n\t\tvar val = value[key];\n\t\tif (val) { cl.add(key); } else { cl.remove(key); }\n\t}\n}\n\nfunction bindClass(elt, value) {\n\tif (!value) { return; }\n\tvar cl = elt.classList;\n\tif (Array.isArray(value)) {\n\t\tfor (var i=0,l=value.length; i<l; i++) {\n\t\t\tvar val = value[i];\n\t\t\tif (val) {\n\t\t\t\tif (typeof val === 'string') {\n\t\t\t\t\tcl.add(val);\n\t\t\t\t} else { // an object?\n\t\t\t\t\taddClassMap(cl, val);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} else { // an object\n\t\taddClassMap(cl, value);\n\t}\n}\n\nfunction bindStyle(elt, value) {\n\tif (!value) { return; }\n\tvar style = elt.style;\n\tif (Array.isArray(value)) {\n\t\tfor (var i=0,l=value.length; i<l; i++) {\n\t\t\tObject.assign(style, value[i]);\n\t\t}\n\t} else { // an object\n\t\tObject.assign(style, value);\n\t}\n\n}\n\n// the listeners injected from a vm to a nested functional view\n// must run in parent vm, context not in fucntional view context!\n// This is why we need to use the vm from the closure scope when the listener was created\nfunction createListener(vm, fn) {\n\treturn function(e) {\n\t\tif (fn.call(vm, e) === false) {\n\t\t\tstopEvent(e);\n\t\t}\n\t};\n}\n\nfunction createListeners(vm, $listeners) {\n\tif ($listeners) {\n\t\tfor (var key in $listeners) {\n\t\t\t$listeners[key] = createListener(vm, $listeners[key]);\n\t\t}\n\t}\n\treturn $listeners;\n}\n\nfunction SetText(el, model, expr) {\n\treturn function() {\n\t\tvar val = expr(model);\n\t\tif (val !== el.nodeValue) {\n\t\t\tel.nodeValue = val;\n\t\t}\n\t}\n}\n\nfunction SetAttr(el, model, key, valFn) {\n\treturn function(changedKey) {\n\t\t//if (!changedKey || changedKey === key) {\n\t\t\tvar val = valFn(model);\n\t\t\tif (el.getAttribute(key) !== val) {\n\t\t\t\tif (val == null) {\n\t\t\t\t\tel.removeAttribute(key);\n\t\t\t\t} else {\n\t\t\t\t\tel.setAttribute(key, val);\n\t\t\t\t}\n\t\t\t}\n\t\t//}\n\t}\n}\n\n/*\nexport function SetBindings(el, model, bindFn) {\n\treturn function(changedKey) {\n\t\tvar bindings = bindFn(model);\n\t\tfor (var key in bindings) {\n\t\t\tvar val = bindings[key];\n\t\t\tif (el.getAttribute(key) !== val) {\n\t\t\t\tel.setAttribute(key, val);\n\t\t\t}\n\t\t}\n\t}\n}\n*/\nfunction SetInnerHTML(el, model, valFn) {\n\treturn function() {\n\t\tvar val = valFn(model);\n\t\tif (el.innerHTML !== val) {\n\t\t\tel.innerHTML = val || '';\n\t\t}\n\t}\n}\n\nfunction SetDisplay(el, model, valFn) {\n\treturn function() {\n\t\tvar val = valFn(model);\n\t\tvar display = el.style.display;\n\t\t// backup the current diaply when toggliong OFF to be able to restore if needed\n\t\tif (val) {\n\t\t\tif (display === 'none') {\n\t\t\t\tel.style.display = el.__qute_display || ''; // remove 'none'\n\t\t\t}\n\t\t} else if (display !== 'none') {\n\t\t\tif (el.__qute_display == null) { el.__qute_display = display; }\n\t\t\tel.style.display = 'none';\n\t\t}\n\t}\n}\n\n\nfunction SetToggle(el, model, valFn) {\n\t// valFn returns a map of attr keys to values\n\treturn function() {\n\t\tvar attrs = valFn(model);\n\t\tvar keys = Object.keys(attrs);\n\t\tfor (var i=0,l=keys.length;i<l;i++) {\n\t\t\tvar key = keys[i];\n\t\t\tif (attrs[key]) {\n\t\t\t\tel.setAttribute(key, key);\n\t\t\t} else {\n\t\t\t\tel.removeAttribute(key);\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunction SetClass(el, model, valFn) {\n\treturn function() {\n\t\t//TODO only if modified\n\t\tbindClass(el, valFn(model));\n\t}\n}\n\nfunction SetStyle(el, model, valFn) {\n\treturn function() {\n\t\t//TODO only if modified\n\t\tbindStyle(el, valFn(model));\n\t}\n}\n\nfunction SetProp(vm, model, key, valFn) {\n\treturn function(changedKey) {\n\t\t//if (!changedKey || changedKey === key) {\n\t\t\tvm.$set(key, valFn(model));\n\t\t//}\n\t}\n}\n\nfunction SetDOMAttrs(el, model, filter) {\n\treturn function() {\n\t\tvar $attrs = model.$attrs;\n\t\tif ($attrs) {\n\t\t\tvar keys = filterKeys($attrs, filter);\n\t\t\tfor (var i=0,l=keys.length; i<l; i++) {\n\t\t\t\tvar key = keys[i];\n\t\t\t\tel.setAttribute(key, $attrs[key]);\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunction SetFuncAttrs($attrs, vm, filter) { // vm is the parent vm (i.e. current model)\n\treturn function() {\n\t\tvar vmAttrs = vm.$attrs;\n\t\tif (vmAttrs) {\n\t\t\tvar keys = filterKeys(vmAttrs, filter);\n\t\t\tfor (var i=0,l=keys.length; i<l; i++) {\n\t\t\t\tvar key = keys[i];\n\t\t\t\t$attrs[key] = vmAttrs[key];\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunction SetFuncAttr($attrs, vm, key, val) { // vm is the parent vm (i.e. current model)\n\treturn function() {\n\t\t$attrs[key] = val(vm);\n\t}\n}\n// TODO set $attrs on VMs\nfunction SetVMAttrs(vm, parentVM, filter) {\n\treturn function() {\n\t\tvar parentAttrs = parentVM.$attrs;\n\t\tif (parentAttrs) {\n\t\t\tvar keys = filterKeys(parentAttrs, filter);\n\t\t\tfor (var i=0,l=keys.length; i<l; i++) {\n\t\t\t\tvar key = keys[i];\n\t\t\t\tvm.$set(key, parentAttrs[key]);\n\t\t\t}\n\t\t}\n\t}\n}\n\n// emitter prototype\nvar Emitter = {\n\temit: function(event, data) {\n\t\tif (!this.$el) { ERR(35); }\n\t\tthis.$el.dispatchEvent(new window.CustomEvent(event, {bubbles: true, detail: data === undefined ? this : data }));\n\n\t},\n\temitAsync: function(event, data, timeout) {\n\t\tvar self = this;\n\t\twindow.setTimeout(function() { self.emit(event, data); }, timeout || 0);\n\t}\n};\n\nfunction ViewRenderingContext(model, marker, isExpr, changeCb, noCache, xattrs, childrenFn) {\n\n\tvar cache = noCache ? null : {};\n\tvar r = null; // the view rendering context\n\tvar cview = null; // current element\n\treturn function(propKey, initialUpdate) {\n\t\tvar el, viewXTag = isExpr(model);\n\t\tif (viewXTag !== cview) {\n\t\t\tvar parent = marker.parentNode;\n\t\t\tif (r) {\n\t\t\t\tr.$disconnect();\n\t\t\t\tparent.removeChild(marker.previousSibling);\n\t\t\t}\n\t\t\tif (viewXTag) {\n\t\t\t\tr = cache && cache[viewXTag];\n\t\t\t\tif (!r) {\n\t\t\t\t\tr = new Rendering(model);\n\t\t\t\t\tif (cache) { cache[viewXTag] = r; }\n\t\t\t\t}\n\t\t\t\tel = r.r(viewXTag, xattrs, childrenFn(r));\n\t\t\t\tparent.insertBefore(el, marker);\n\t\t\t\tr.$connect();\n\t\t\t} else {\n\t\t\t\tr = null;\n\t\t\t}\n\n\t\t\tif (changeCb && !initialUpdate) { // avoid calling changeCb the first time the if is rendered\n\t\t\t\tchangeCb.call(model, el && el.__qute__);\n\t\t\t}\n\t\t\tcview = viewXTag;\n\t\t} else if (r) {\n\t\t\t// only update children\n\t\t\tr.$update();\n\t\t}\n\t}\n}\n\nfunction IfRenderingContext(model, start, end, expr, changeCb, _if, _else) {\n\tvar r = null; // the IF / ELSE rendering context\n\tvar state = undefined; // the current IF / ELSE value\n\treturn function(propKey, initialUpdate) {\n\t\tvar newState = !!expr(model);\n\t\tif (newState !== state) {\n\t\t\tr && r.$disconnect();\n\t\t\tvar parent = start.parentNode;\n\t\t\t// remove current if branch\n\t\t\twhile (start.nextSibling && start.nextSibling !== end) {\n\t\t\t\tparent.removeChild(start.nextSibling);\n\t\t\t}\n\t\t\tr = new Rendering(model); // create the IF / ELSE rendering context\n\t\t\tstate = newState;\n\t\t\tvar children = state ? _if(r) : (_else ? _else(r) : []); //_else may not be defined\n\t\t\tfor (var i=0,l=children.length; i<l; i++) {\n\t\t\t\tparent.insertBefore(children[i], end);\n\t\t\t}\n\t\t\tr.$connect();\n\t\t\tif (changeCb && !initialUpdate) { // avoid calling changeCb the first time the if is rendered\n\t\t\t\tchangeCb.call(model, state);\n\t\t\t}\n\t\t} else if (r) {\n\t\t\t// only update children\n\t\t\tr.$update();\n\t\t}\n\t}\n}\n\nfunction ForRenderingContext(model, start, end, listFn, iterationFn) {\n\tvar r = null; // the for rendering context\n\tvar list = null; // the current list\n\treturn function(propKey) {\n\t\tvar newList = listFn(model);\n\t\tif (newList !== list) {\n\t\t\tr && r.$disconnect();\n\t\t\tvar parent = start.parentNode;\n\t\t\t// remove current for content\n\t\t\twhile (start.nextSibling && start.nextSibling !== end) {\n\t\t\t\tparent.removeChild(start.nextSibling);\n\t\t\t}\n\t\t\tr = new Rendering(model); // create the FOR rendering context\n\t\t\tlist = newList;\n\t\t\t// render content\n\t\t\tif (list) {\n\t\t\t\tif (!Array.isArray(list)) {\n\t\t\t\t\t//if (list instanceof List) ERR(25);\n\t\t\t\t\tif (list.$createListFragment) { ERR(25); }\n\t\t\t\t\tlist = Object.keys(list);\n\t\t\t\t}\n\t\t\t\tif (list.length > 0) {\n\t\t\t\t\tvar l = list.length-1;\n\t\t\t\t\tfor (var i=0; i<l; i++) {\n\t\t\t\t\t\tvar children = iterationFn(list[i], i, true);\n\t\t\t\t\t\tif (children) {\n\t\t\t\t\t\t\tfor (var k=0,ll=children.length; k<ll; k++) {\n\t\t\t\t\t\t\t\tparent.insertBefore(children[k], end);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tvar children = iterationFn(list[i], i, false);\n\t\t\t\t\tif (children) {\n\t\t\t\t\t\tfor (var i=0,l=children.length; i<l; i++) {\n\t\t\t\t\t\t\tparent.insertBefore(children[i], end);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tr.$connect();\n\t\t} else if (r) {\n\t\t\t// just update children\n\t\t\tr.$update();\n\t\t}\n\t}\n}\n\nfunction isVM(obj) {\n\treturn obj && obj.prototype && obj.prototype.__VM__;\n}\n\nfunction appendChildren(parent, children) {\n\tfor (var i=0, l=children.length; i<l; i++) { parent.appendChild(children[i]); }\n}\n\nfunction applyListeners(el, vm, listeners, doNotWrap) {\n\tfor (var key in listeners) {\n\t\tvar fn = listeners[key];\n\t\tif (key === 'create') {\n\t\t\tfn.call(el, vm);\n\t\t} else {\n\t\t\tel.addEventListener(key, doNotWrap ? fn : createListener(vm, fn));\n\t\t}\n\t}\n}\n\nfunction extractSlots(children) {\n\tif (children && children.length) {\n\t\tvar namedSlots = {}, nestedCnt = 0, hasContent = false;\n\t\tfor (var i=0,l=children.length; i<l; i++) {\n\t\t\tvar child = children[i];\n\t\t\tvar nodeType = child.nodeType;\n\t\t\tswitch (nodeType) {\n\t\t\t\tcase 1:\n\t\t\t\t\tif (child.nodeName === 'NESTED') { // select only 'nested' elements\n\t\t\t\t\t\tvar slot = child.getAttribute('name') || 'default';\n\t\t\t\t\t\tvar slotChildren = [];\n\t\t\t\t\t\tvar node = child.firstChild;\n\t\t\t\t\t\twhile (node) {\n\t\t\t\t\t\t\tslotChildren.push(node);\n\t\t\t\t\t\t\tnode = node.nextSibling;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tnamedSlots[slot] = slotChildren;\n\t\t\t\t\t\tnestedCnt++;\n\t\t\t\t\t} else {\n\t\t\t\t\t\thasContent = true;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 3:\n\t\t\t\t\tif (child.nodeValue.trim()) { hasContent = true; }\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (nestedCnt) {\n\t\t\treturn namedSlots;\n\t\t} else if (hasContent) { // default slot\n\t\t\tnamedSlots.default = children;\n\t\t\treturn namedSlots;\n\t\t}\n\t}\n\treturn null;\n}\n\n// ==============================================\n\n\nvar RenderingProto = {\n\tx: function(expr) { // expression {{ ... }}\n\t\tvar text = expr(this.vm);\n\t\tvar el = document.createTextNode(text);\n\t\tthis.up(SetText(el, this.vm, expr));\n\t\treturn el;\n\t},\n\tt: function(value) { // text\n\t\treturn document.createTextNode(value);\n\t},\n\tg: function(isFn, xattrs, children) { // dynamic tag using 'is'\n\t\tvar tag = isFn(this.vm);\n\t\tvar XTag = getVMOrTag(tag);\n\t\treturn XTag ? this.v(XTag, xattrs, children) : this.h(tag, xattrs, children);\n\t},\n\th: function(tag, xattrs, children) { // dom node\n\t\tvar el = document.createElement(tag);\n\t\tif (xattrs) {\n\t\t\tvar vm = this.vm;\n\t\t\tfor (var key in xattrs) {\n\t\t\t\tvar up = null;\n\t\t\t\tvar val = xattrs[key];\n\t\t\t\tif (key.charCodeAt(0) === 36) { // $ - extended attribute\n\t\t\t\t\tif (key === '$on') {\n\t\t\t\t\t\tapplyListeners(el, vm, val);\n\t\t\t\t\t} else if (key === '$class') {\n\t\t\t\t\t\tup = SetClass(el, vm, val);\n\t\t\t\t\t} else if (key === '$style') {\n\t\t\t\t\t\tup = SetStyle(el, vm, val);\n\t\t\t\t\t} else if (key === '$show') {\n\t\t\t\t\t\tup = SetDisplay(el, vm, val);\n\t\t\t\t\t} else if (key === '$toggle') {\n\t\t\t\t\t\tup = SetToggle(el, vm, val);\n\t\t\t\t\t} else if (key === '$html') {\n\t\t\t\t\t\tup = SetInnerHTML(el, vm, val);\n\t\t\t\t\t} else if (key === '$attrs') {\n\t\t\t\t\t\tup = SetDOMAttrs(el, vm, val);\n\t\t\t\t\t} else if (key === '$listeners') {\n\t\t\t\t\t\t//TODO filter like for $attrs\n\t\t\t\t\t\t//TODO value must be a function ... and not use directly vm.$listeners\n\t\t\t\t\t\tapplyListeners(el, vm, vm.$listeners, true); // do not wrap listeners fns (already wrapped by the parent context)\n\t\t\t\t\t\t//TODO\n\t\t\t\t\t} else if (key === '$channel') {\n\t\t\t\t\t\tERR(28, tag);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tERR(26, key);\n\t\t\t\t\t}\n\t\t\t\t} else if (typeof val === 'function') { // a dynamic binding\n\t\t\t\t\tup = SetAttr(el, vm, key, val);\n\t\t\t\t} else {\n\t\t\t\t\tel.setAttribute(key, val);\n\t\t\t\t}\n\t\t\t\tif (up) {\n\t\t\t\t\tthis.up(up)(); // push then execute\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (children) { appendChildren(el, children); }\n\t\treturn el;\n\t},\n\t// element with static children (innerHTML is set from the subtree)\n\thh:function(tag, xattrs, content, type) {\n\t\tvar el = this.h(tag, xattrs);\n\t\tif (type) { // convert can be a function to convert the content before injecting in the dom\n\t\t\tvar converter = Context.Qute.converters[type];\n\t\t\tif (!converter) {\n\t\t\t\tERR(27, type);\n\t\t\t}\n\t\t\tcontent = converter(content, this);\n\t\t}\n\t\tel.innerHTML = content;\n\t\treturn el;\n\t},\n\tr: function(tag, xattrs, children) {\n\t\tvar XTag = getVMOrTag(tag);\n\t\tif (!XTag) { ERR(23, tag); }\n\t\treturn this._v(XTag, xattrs, extractSlots(children));\n\t},\n\tv: function(XTag, xattrs, children) { // xtag is specified as a func reference. TODO No more used\n\t\treturn this._v(XTag, xattrs, extractSlots(children));\n\t},\n\t// vm component\n\t_v: function(XTag, xattrs, slots) { // a vm component (viewmodel)\n\t\tif (isVM(XTag)) {\n\t\t\tvar vm = new XTag(this.vm.$ctx);\n\t\t\treturn vm.$create(this, xattrs, slots);\n\t\t} else if (XTag.$compiled) { // a compiled template\n\t\t\tvar oldVm = this.vm;\n\t\t\tthis.vm = this.functx(this.vm, xattrs, slots);\n\t\t\tvar el = XTag(this, xattrs, slots); // pass xattrs and slots too?\n\t\t\tthis.vm.$el = el;\n\t\t\t// apply root bindings if any (x-class, x-style or x-show)\n\t\t\tif (this.vm.$bindings) {\n\t\t\t\tvar bindings = this.vm.$bindings;\n\t\t\t\tfor (var i=0,l=bindings.length; i<l; i+=2) {\n\t\t\t\t\tvar up = bindings[i](el, oldVm, bindings[i+1]);\n\t\t\t\t\tthis.up(up)();\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (this.vm.$listeners) { applyListeners(el, this.vm, this.vm.$listeners, true); }\n\t\t\tthis.vm = oldVm;\n\t\t\treturn el;\n\t\t} else { // a hand written function\n\t\t\treturn XTag(this, xattrs, slots);\n\t\t}\n\t},\n\ts: function(slotName, defaultChildren) {\n\t\tvar vm = this.vm;\n\t\tvar slots = vm.$slots;\n\t\tvar children = slots && slots[slotName || 'default'] || defaultChildren;\n\t\tif (children) {\n\t\t\tvar frag = document.createDocumentFragment();\n\t\t\tappendChildren(frag, children);\n\t\t\treturn frag;\n\t\t}\n\t\treturn document.createComment('[slot/]'); // placeholder\n\t},\n\tw: function(isExpr, changeCb, noCache, xattrs, childrenFn) { // dynamic view\n\t\tvar marker = document.createComment('[view/]');\n\t\tvar frag = document.createDocumentFragment();\n\t\tfrag.appendChild(marker);\n\t\tvar viewFrag = ViewRenderingContext(this.vm, marker, isExpr, changeCb, noCache, xattrs, childrenFn);\n\t\tmarker.__qute__ = viewFrag;\n\t\tviewFrag(null, true);\n\t\tthis.up(viewFrag);\n\t\treturn frag;\n\t},\n\ti: function(expr, changeCb, _if, _else) { // if / else\n\t\tvar start = document.createComment('[if]');\n\t\tvar end = document.createComment('[/if]');\n\t\tvar frag = document.createDocumentFragment();\n\t\tfrag.appendChild(start);\n\t\tfrag.appendChild(end);\n\t\tvar ieFrag = IfRenderingContext(this.vm, start, end, expr, changeCb, _if, _else);\n\t\tstart.__qute__ = ieFrag;\n\t\tieFrag(null, true);\n\t\tthis.up(ieFrag);\n\t\treturn frag;\n\t},\n\t// dynamic lists - which is tracking changes and update itself\n\tl: function(listFn, iterationFn) {\n\t\tvar list = listFn(this.vm);\n\t\t//if (!list instanceof List)) ERR(24);\n\t\tif (!list.$createListFragment) { ERR(24); }\n\t\treturn list.$createListFragment(this, iterationFn);\n\t},\n\t// static array variant of lists - this cannot be updated it is rendered once at creation\n\ta: function(listFn, iterationFn) {\n\t\tvar start = document.createComment('[for]');\n\t\tvar end = document.createComment('[/for]');\n\t\tvar frag = document.createDocumentFragment();\n\t\tfrag.appendChild(start);\n\t\tfrag.appendChild(end);\n\t\tvar forFrag = ForRenderingContext(this.vm, start, end, listFn, iterationFn);\n\t\tstart.__qute__ = forFrag;\n\t\tforFrag(null);\n\t\tthis.up(forFrag);\n\t\treturn frag;\n\t},\n\tup: function(fn) { // register a live update function\n\t\tthis.ups.push(fn);\n//\t\tthis.ups[this.ups.length-1].push(fn);\n\t\treturn fn;\n\t},\n\t//======\n\t// eval the value of an xattr given the key - if a fucntion invoke the function within the current context otherwise return the value as is\n\teval: function(xattr) {\n\t\treturn typeof xattr === 'function' ? xattr(this.vm) : xattr;\n\t},\n\n\t// connect all nested  VMs\n\t$connect: function() {\n\t\tif (!this.isc) {\n\t\t\tvar vms = this.vms;\n\t\t\tfor (var i=0,l=vms.length; i<l; i++) { vms[i].$connect(); }\n\t\t\tthis.isc = true;\n\t\t}\n\t\treturn this;\n\t},\n\t// disconnect all nested VMs\n\t$disconnect: function() {\n\t\tif (this.isc) {\n\t\t\tvar vms = this.vms;\n\t\t\tfor (var i=0,l=vms.length; i<l; i++) { vms[i].$disconnect(); }\n\t\t\tthis.isc = false;\n\t\t}\n\t\treturn this;\n\t},\n\t$push: function(r) { // push a sub-renderings\n\t\tthis.vms.push(r);\n\t\tif (this.isc) { r.$connect(); }\n\t},\n\t// refresh the DOM - call all nested update functions\n\t$update: function() {\n\t\tvar model = this.vm, ups = this.ups;\n\t\tfor (var i=0,l=ups.length;i<l;i++) { ups[i](model); }\n\t\treturn this;\n\t},\n\tfunctx: function(vm, xattrs, slots) { // functional context\n\t\tvar $attrs = {};\n\t\tvar ctx = {\n\t\t\t$parent: vm,\n\t\t\t$attrs: $attrs,\n\t\t\t$listeners: null,\n\t\t\t$slots: slots,\n\t\t\t$el: null,\n\t\t\t$bindings: null,\n\t\t\temit: Emitter.emit,\n\t\t\temitAsync: Emitter.emitAsync\n\t\t};\n\t\tvar bindings = null;\n\n\t\tif (xattrs) {\n\t\t\tfor (var key in xattrs) { // class, style and show, $attrs, $listeners are ignored\n\t\t\t\tvar val = xattrs[key];\n\t\t\t\tif (key.charCodeAt(0) !== 36 || key === '$html') { // $ - extended attribute -> ignore all extended attrs but $html\n\t\t\t\t\tif (typeof val === 'function') {\n\t\t\t\t\t\tthis.up(SetFuncAttr($attrs, vm, key, val))();\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$attrs[key] = val;\n\t\t\t\t\t}\n\t\t\t\t\t//setFnContextAttr($attrs, vm, key, val);\n\t\t\t\t} else if (key === '$attrs') {\n\t\t\t\t\tif (vm.$attrs) {\n\t\t\t\t\t\t// inject attributes in functional tags\n\t\t\t\t\t\t// we need to create an update function to reinject attrs when model changes\n\t\t\t\t\t\t// otherwise we loose the reactivity on func tags 'x-attrs' attribute\n\t\t\t\t\t\tthis.up(SetFuncAttrs($attrs, vm, val))();\n\t\t\t\t\t}\n\t\t\t\t} else if (key === '$on') {\n\t\t\t\t\tctx.$listeners = createListeners(vm, val);\n\t\t\t\t} else if (key === '$class') {\n\t\t\t\t\tif (!bindings) { bindings = []; }\n\t\t\t\t\tbindings.push(SetClass, val);\n\t\t\t\t} else if (key === '$style') {\n\t\t\t\t\tif (!bindings) { bindings = []; }\n\t\t\t\t\tbindings.push(SetStyle, val);\n\t\t\t\t} else if (key === '$show') {\n\t\t\t\t\tif (!bindings) { bindings = []; }\n\t\t\t\t\tbindings.push(SetDisplay, val);\n\t\t\t\t} else if (key === '$toggle') {\n\t\t\t\t\tif (!bindings) { bindings = []; }\n\t\t\t\t\tbindings.push(SetToggle, val);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tctx.$bindings = bindings;\n\t\treturn ctx;\n\t}\n\n};\n\nfunction Rendering(vm) {\n\tthis.vm = vm; // defaults to current vm -> changed by functional views\n\tthis.ups = [];\n\t// vms are usually ViewModels but can be any object providing $connect and $disconnect methods\n\t// if you enrich the vms api you mustr check list.js since it register a ListFragment instance as a vm\n\tthis.vms = [];\n\tthis.isc = false; // is connected?\n}\nRendering.prototype = RenderingProto;\n\nfunction ListFragment(rendering, listFn) {\n\tthis.start = document.createComment('[list]');\n\tthis.end = document.createComment('[/list]');\n\tthis.r = rendering;\n\tthis.listFn = listFn;\n\tthis.length = 0;\n\n\tthis.updateChildren = function(model) {\n\t\tvar first = this.start.nextSibling;\n\t\tif (!first || first === this.end || !first.$up) { return; }\n\t\tvar n = first, end = this.end;\n\t\twhile (n && n !== end) {\n\t\t\tif (n.$up) {\n\t\t\t\tvar ups = n.$up;\n\t\t\t\tfor (var i=0,l=ups.length;i<l;i++) {\n\t\t\t\t\tups[i](model);\n\t\t\t\t}\n\t\t\t}\n\t\t\tn = n.nextSibling;\n\t\t}\n\t};\n\n\tthis.clear = function() {\n\t\tvar n = this.start;\n\t\tvar end = this.end;\n\t\tvar parent = n.parentNode;\n\t\twhile (n.nextSibling && n.nextSibling !== end) {\n\t\t\tparent.removeChild(n.nextSibling);\n\t\t}\n\t\tif (!n.nextSibling) { ERR(10); }\n\t\tthis.length = 0;\n\t};\n\n\tthis.get = function(index) {\n\t\tif (index < 0 || index > this.length) {\n\t\t\treturn null;\n\t\t}\n\t\tvar l = this.length, n = null;\n\t\tif (index < l/2) { // from start\n\t\t\tn = this.start.nextSibling;\n\t\t\twhile (index-- > 0) { n = n.nextSibling; }\n\t\t} else { // from end\n\t\t\tindex = l - index - 1;\n\t\t\tn = this.end.previousSibling;\n\t\t\twhile (index-- > 0) { n = n.previousSibling; }\n\t\t}\n\t\treturn n;\n\t};\n\n\tthis.getInsertion = function(index) {\n\t\tif (index < 0 || index > this.length) { ERR(11, index, length); }\n\t\tif (index === 0) {\n\t\t\treturn this.start.nextSibling;\n\t\t}\n\t\tif (index === this.length) {\n\t\t\treturn this.end;\n\t\t}\n\t\treturn this.get(index);\n\t};\n\n\tthis.createItem = function(r, item, index, hasNext) {\n\t\treturn listFn(r, item, index, hasNext);\n\t};\n\n\tthis.insert = function(data, from, count) {\n\t\tif (!from) { from = 0; } // if undefined null or 0\n\t\tif (!count) { count = data.length - from; } // if undefined null or 0\n\t\tif (count < 1) { return; }\n\t\tvar l = from+count;\n\t\tvar listFn = this.listFn;\n\t\tvar r = this.r;\n\t\tvar node = this.getInsertion(from);\n\t\tif (!node) { ERR(12, index, this.length); }\n\t\t//TODO redraw if list fragment is broken insted of throwing an error?\n\t\tvar childR, vm = r.vm, parent = node.parentNode;\n\t\tvar ll = l-1;\n\t\tfor (var i=from; i<ll; i++) {\n\t\t\t// we need to wrapp each child in a rendering ctx to be able to disconnect when items are removed\n\t\t\tchildR = new Rendering(vm);\n\t\t\tvar child = this.createItem(childR, data[i], i, true);\n\t\t\tif (child) {\n\t\t\t\tparent.insertBefore(child, node);\n\t\t\t\tr.$push(childR);\n\t\t\t\tchild.__qute_ctx__ = childR;\n\t\t\t}\n\t\t}\n\t\tchildR = new Rendering(vm);\n\t\tvar child = this.createItem(childR, data[ll], ll, l<data.length);\n\t\tif (child) {\n\t\t\tparent.insertBefore(child, node);\n\t\t\tr.$push(childR);\n\t\t\tchild.__qute_ctx__ = childR;\n\t\t}\n\t\tthis.length = data.length;\n\t};\n\n\tthis.remove = function(from, count) {\n\t\tif (from + count > this.length) {\n\t\t\t// TODO enable only if debug mode\n\t\t\t//throw new Error('Removed range exceed the list length: '+from+'#'+count+'. Length is '+this.length);\n\t\t\treturn;\n\t\t}\n\t\tvar node = this.get(from);\n\t\tif (!node) { ERR(13, from, this.length); }\n\t\tvar i=0, parent = this.start.parentNode;\n\t\tnode = node.previousSibling; // cannot be null\n\t\twhile (i++<count) {\n\t\t\tvar child = node.nextSibling;\n\t\t\tchild.__qute_ctx__ && child.__qute_ctx__.$disconnect();\n\t\t\tparent.removeChild(child);\n\t\t}\n\t\tthis.length -= count;\n\t};\n\n\tthis.move = function(from, to) {\n\t\t// TODO this can be optimized (we can search for the 2 nodes in the same time: get2(i1, i2))\n\t\tvar node = this.get(from);\n\t\tif (!node) { ERR(14, from, this.length); }\n\t\tvar dstNode = this.get(to);\n\t\tif (!dstNode) { ERR(15, to, this.length); }\n\t\tdstNode = dstNode.nextSibling;\n\t\tif (dstNode) {\n\t\t\tdstNode.parentNode.insertBefore(node, dstNode);\n\t\t} else {\n\t\t\tdstNode.parentNode.append(node);\n\t\t}\n\t};\n}\n\n\n\nvar AP = Array.prototype;\nvar ListProto = {\n\t$createListFragment: function(rendering, listFn) {\n\t\tvar listRendering = new Rendering(rendering.vm);\n\t\tif (!this.lfs) { this.lfs = []; }\n\t\tvar lf = new ListFragment(listRendering, listFn);\n\t\tvar frag = document.createDocumentFragment();\n\t\tfrag.appendChild(lf.start);\n\t\tfrag.appendChild(lf.end);\n\t\tlf.insert(this.$data); // initialize\n\t\trendering.up(lf.updateChildren.bind(lf)); // register children updates\n\t\tthis.lfs.push(lf);\n\t\trendering.$push(listRendering);\n\t\treturn frag;\n\t},\n\t/*\n\t$destroy: function() { //TODO not used\n\t\tthis.lfs = null;\n\t},\n\t*/\n\t$updateNow: function() {\n\t\tif (this.lfs) {\n\t\t\tvar ops = this.ops;\n\t\t\tvar data = this.$data;\n\t\t\tvar lfs = this.lfs;\n\t\t\tvar l = lfs.length;\n\t\t\twhile (ops.length) {\n\t\t\t\tvar op = ops.shift();\n\t\t\t\tfor (var i=0,l=lfs.length; i<l; i++) {\n\t\t\t\t\top(lfs[i], data);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\t$update: function(op) {\n\t\tif (this.lfs) {\n\t\t\tif (this.ops.push(op) === 1) { // if queue is empty start an update task\n\t\t\t\tvar self = this;\n\t\t\t\tUpdateQueue.push(function() {\n\t\t\t\t\tself.$updateNow();\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t},\n\t$redraw: function() {\n\t\tthis.$update(function(lf, data) {\n\t\t\tlf.clear();\n\t\t\tlf.insert(data);\n\t\t});\n\t},\n\t$insert: function(from, count) {\n\t\tthis.$update(function(lf, data) {\n\t\t\tlf.insert(data, from, count);\n\t\t});\n\t},\n\t$remove: function(from, count) {\n\t\tthis.$update(function(lf, data) {\n\t\t\tlf.remove(from, count);\n\t\t});\n\t},\n\t$move: function(from, to) {\n\t\tthis.$update(function(lf, data) {\n\t\t\tlf.move(from, to);\n\t\t});\n\t},\n\n\ttoJSON: function() {\n\t\treturn this.$data;\n\t},\n\tdata: function() {\n\t\treturn this.$data;\n\t},\n\tnewList: function() {\n\t\treturn new List(this.$data);\n\t},\n\n\tclear: function() {\n\t\tthis.replace([]);\n\t},\n\treplace: function (ar) {\n\t\tthis.$data = ar;\n\t\tthis.$redraw();\n\t},\n\n\tmove: function(from, to) {\n\t\tthis.$data.splice(to, 0, this.$data.splice(from, 1)[0]);\n\t\tthis.$move(from, to);\n\t},\n\n\tremove: function(item) {\n\t\tvar i = this.$data.indexOf(item);\n\t\tif (i > -1) {\n\t\t\treturn this.splice(i, 1);\n\t\t}\n\t},\n\n\tpush: function() {\n\t\tvar from = this.$data.length;\n\t\tvar r = AP.push.apply(this.$data, arguments);\n\t\tthis.$insert(from, arguments.length);\n\t\treturn r;\n\t},\n\tunshift: function() {\n\t\tvar from = this.$data.length;\n\t\tvar r = AP.unshift.apply(this.$data, arguments);\n\t\tthis.$insert(0, arguments.length);\n\t\treturn r;\n\t},\n\tpop: function() {\n\t\tvar r = AP.pop.apply(this.$data, arguments);\n\t\tthis.$remove(this.$data.length, 1);\n\t\treturn r;\n\t},\n\tshift: function() {\n\t\tvar r = AP.shift.apply(this.$data, arguments);\n\t\tthis.$remove(0, 1);\n\t\treturn r;\n\t},\n\tsplice: function(start, deleteCount) {\n\t\tvar argsl = arguments.length;\n\t\tvar len = this.$data.length;\n\t\tvar r = AP.splice.apply(this.$data, arguments);\n\t\tif (argsl === 1) {\n\t\t\tthis.$remove(start, len-start);\n\t\t} else if (argsl === 2) {\n\t\t\tthis.$remove(start, deleteCount);\n\t\t} else { // some inserted items\n\t\t\tif (deleteCount) { this.$remove(start, deleteCount); }\n\t\t\tthis.$insert(start, argsl-2);\n\t\t}\n\t\treturn r;\n\t},\n\tsort: function(cmp) {\n\t\tthis.$data.sort(cmp);\n\t\tthis.$redraw();\n\t\treturn this.$data;\n\t},\n\treverse: function() {\n\t\tthis.$data.reverse();\n\t\tthis.$redraw();\n\t\treturn this.$data;\n\t},\n\tget: function(i) {\n\t\treturn this.$data[i];\n\t},\n\tslice: function() {\n\t\treturn AP.slice.apply(this.$data, arguments);\n\t},\n\tforEach: function(cb, thisArg) {\n\t\tthis.$data.forEach(cb, thisArg);\n\t},\n\tmap: function(cb, thisArg) {\n\t\treturn this.$data.map(cb, thisArg);\n\t},\n\tfilter: function(cb, thisArg) {\n\t\treturn this.$data.filter(cb, thisArg);\n\t},\n\tfind: function(cb, thisArg) {\n\t\treturn this.$data.find(cb, thisArg);\n\t},\n\tfindIndex: function(cb, thisArg) {\n\t\treturn this.$data.findIndex(cb, thisArg);\n\t},\n\treduce: function(cb, initialValue) {\n\t\treturn this.$data.reduce(cb, initialValue);\n\t},\n\treduceRight: function(cb, initialValue) {\n\t\treturn this.$data.reduceRight(cb, initialValue);\n\t},\n\tindexOf: function(elem, from) {\n\t\treturn this.$data.indexOf(elem, from || 0);\n\t},\n\tlastIndexOf: function(elem, from) {\n\t\treturn this.$data.lastIndexOf(elem, from || this.$data.length-1);\n\t},\n\t//TODO add some, every, ...\n};\nObject.defineProperty(ListProto, 'length', {get:function() {return this.$data.length}});\n\nfunction List(data) {\n\tthis.ops = []; // update operations queue\n\tthis.lfs = null; // the list fragment\n\tthis.$data = data || []; // the backed data\n}\nList.prototype = ListProto;\n\nfunction isEnumerable(key) {\n\treturn key.charCodeAt(0) !== 95; // keys starting with _ are not enumerable\n}\n\nfunction defProp(key) {\n\treturn {\n\t\tget: function() {\n\t\t\treturn this.$data[key];\n\t\t},\n\t\tset: function(value) {\n\t\t\tvar old = this.$data[key];\n\t\t\tif (old !== value) {\n\t\t\t\tthis.$data[key] = value;\n\t\t\t\tvar watcher = this.$el && this.$watch && this.$watch[key]; // if not connected whatchers are not enabled\n\t\t\t\t// avoid updating if watcher return false\n\t\t\t\tif (watcher && watcher.call(this, value, old) === false) { return; }\n\t\t\t\tthis.update(key);\n\t\t\t}\n\t\t},\n\t\tenumerable: isEnumerable(key) // keys starting with _ are not enumerable\n\t}\n}\n\nfunction listProp(key) {\n\treturn {\n\t\tget: function() {\n\t\t\treturn this.$data[key];\n\t\t},\n\t\tset: function(value) {\n\t\t\tvar old = this.$data[key];\n\t\t\tif (old !== value) {\n\t\t\t\tif (!value) { // remove list content\n\t\t\t\t\tthis.$data[key].clear();\n\t\t\t\t} else if (Array.isArray(value)) {\n\t\t\t\t\tthis.$data[key].replace(value);\n\t\t\t\t} else if (value instanceof List) {\n\t\t\t\t\t//TODO should we copy the data?\n\t\t\t\t\tif (old) { old.$disconnect(); }\n\t\t\t\t\tthis.$data[key] = value;\n\t\t\t\t} else {\n\t\t\t\t\tERR(31, value);\n\t\t\t\t}\n\t\t\t\tvar watcher = this.$watch && this.$watch[key];\n\t\t\t\t// avoid updating if watcher return false\n\t\t\t\tif (watcher && watcher.call(this, value, old) === false) { return; }\n\t\t\t\tthis.update(key);\n\t\t\t}\n\t\t},\n\t\tenumerable: isEnumerable(key) // keys starting with _ are not enumerable\n\t}\n}\n\nfunction ViewModel(ctx, attrs) {\n\tvar prop = {};\n\t// the attributes set on vm tag which are not declared as props\n\tprop.value = {};\n\tObject.defineProperty(this, '$attrs', prop);\n\t// the app context if any\n\tprop.value = ctx instanceof Context ? ctx : new Context(ctx);\n\tObject.defineProperty(this, '$ctx', prop);\n\t// the listeners registered on the vm tag\n\tprop.value = null;\n\tprop.writable = true;\n\t// the associated rendering context\n\tObject.defineProperty(this, '$r', prop);\n\t// listeners injected through tag attributes (e.g. @click)\n\tObject.defineProperty(this, '$listeners', prop);\n\t// the slots injected by the caller\n\tObject.defineProperty(this, '$slots', prop);\n\t// the view root element\n\tObject.defineProperty(this, '$el', prop);\n\t// chained cleanup functions if any was registered\n\tObject.defineProperty(this, '$clean', prop);\n\t// States: 0 - initial, 1 - connected, 2 - updating\n\tprop.value = 0;\n\tObject.defineProperty(this, '$st', prop); // state: 0 - default, 1 updating , 2 frozen\n\n\tvar data = this.init(ctx) || {};\n\tprop.value = data;\n\tObject.defineProperty(this, '$data', prop);\n\tif (data) {\n\t\tfor (var key in data) {\n\t\t\tObject.defineProperty(this, key, data[key] instanceof List ? listProp(key) : defProp(key));\n\t\t}\n\t}\n\n\tif (!this.render) { ERR(32); }\n\n\t// initialize data model from attributes if any - this will not trigger an update\n\tif (attrs) {\n\t\tvar $data = this.$data;\n\t\tvar $attrs = this.$attrs;\n\t\tObject.keys(attrs).forEach(function(key) {\n\t\t\tvar value = attrs[key];\n\t\t\tif (key in $data) { // a declared property\n\t\t\t\t$data[key] = value;\n\t\t\t} else {\n\t\t\t\tvar camelKey = kebabToCamel(key);\n\t\t\t\tif (camelKey !== key && camelKey in $data) {\n\t\t\t\t\t$data[camelKey] = value;\n\t\t\t\t} else if ($attrs[key] !== value) {\n\t\t\t\t\t// attributes are not camelized\n\t\t\t\t\t$attrs[key] = value;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n}\n\nViewModel.prototype = {\n\t__VM__:true,\n\ttoString: function() {\n\t\treturn 'ViewModel <'+this.$tag+'/>';\n\t},\n\t// set an attribute value (can be either a free property (i.e $attrs[key]) or managed property (i.e. $data[key]))\n\t$set: function(key, value) {\n\t\tif (key in this.$data) { // a declared property\n\t\t\tthis[key] = value;\n\t\t} else {\n\t\t\tvar camelKey = kebabToCamel(key);\n\t\t\tif (camelKey !== key && camelKey in this.$data) {\n\t\t\t\tthis[camelKey] = value;\n\t\t\t} else if (this.$attrs[key] !== value) {\n\t\t\t\t// attributes are not camelized\n\t\t\t\tthis.$attrs[key] = value;\n\t\t\t\tthis.update();\n\t\t\t}\n\t\t}\n\t},\n\t// subscribe to the given channel name - for use on root VMs\n\tlisten: function(channelName) {\n\t\tif (!this.$channel) { ERR(39, this.$tag); }\n\t\t// add an init function\n\t\tthis.$init = chainFnAfter(function(thisObj) {\n\t\t\tthisObj.subscribe(channelName, thisObj.$channel);\n\t\t}, this.$init);\n\t\treturn this;\n\t},\n\t//TODO use setup in listen and $on\n\tsetup: function(setupFn) {\n\t\tthis.$init = chainFnAfter(setupFn, this.$init);\n\t\treturn this;\n\t},\n\tcleanup: function(fn) { // register a cleanup function when component is disconnected\n\t\tthis.$clean = chainFnAfter(fn, this.$clean);\n\t\treturn this;\n\t},\n\t$parent: function() {\n\t\tif (!this.$el) { ERR(35); }\n\t\treturn closestVM(this.$el.parentNode);\n\t},\n\t$root: function() {\n\t\tvar parent = this.$parent();\n\t\treturn parent ? parent.$root() : this;\n\t},\n\t$connect: function() {\n\t\tif (this.$st & 1) { return; } // ignore\n\t\tthis.$st |= 1; // set connected flag\n\t\t// $init may be defined by the prototype to do automatic setup when connected\n\t\t// (e.g. automatic installed listeners defined though VM definitioan 'on' property)\n\t\tif (this.$init) {\n\t\t\tthis.$init(this);\n\t\t}\n\t\tif (this.$listeners) {\n\t\t\tvar listeners = this.$listeners;\n\t\t\tfor (var key in listeners) {\n\t\t\t\tthis.$on(key, listeners[key]);\n\t\t\t}\n\t\t}\n\t\t// connect children vms\n\t\tthis.$r.$connect();\n\t\t// call the connected callback\n\t\tthis.connected && this.connected();\n\t\treturn this;\n\t},\n\t$disconnect: function() {\n\t\tif (!(this.$st & 1)) { return; } // ignore\n\t\tthis.$st ^= 1; // clear connected flag\n\t\tif (this.$clean) {\n\t\t\tthis.$clean();\n\t\t\tthis.$clean = null;\n\t\t}\n\t\tthis.$r.$disconnect(); // disconnect children vms\n\t\tthis.disconnected && this.disconnected();\n\t},\n\t// initialize a vm from tag raw data\n\t$load: function(rendering, xattrs, slots) {\n\t\tvar bindings = null;\n\t\tvar parentVM = rendering.vm;\n\t\tthis.$slots = slots;\n\t\tif (xattrs) {\n\t\t\tfor (var key in xattrs) {\n\t\t\t\tvar val = xattrs[key];\n\t\t\t\tif (key.charCodeAt(0) === 36) { // $ - extended attribute\n\t\t\t\t\tif (key === '$on') {\n\t\t\t\t\t\t//TODO we should make a copy of val since it is modified by createListeners!!!\n\t\t\t\t\t\tthis.$listeners = createListeners(parentVM, val); // use parent vm when creating listeners\n\t\t\t\t\t} else if (key === '$attrs') { // we must not delete keys from xattrs since it can break when vm is loaded by a dynamic component\n\t\t\t\t\t\t//TODO DO WE NEED to add an update fn? x-attrs are static\n\t\t\t\t\t\trendering.up(SetVMAttrs(this, parentVM, val))();\n\t\t\t\t\t} else if (key === '$class') {\n\t\t\t\t\t\tif (!bindings) { bindings = []; }\n\t\t\t\t\t\tbindings.push(SetClass, val);\n\t\t\t\t\t} else if (key === '$style') {\n\t\t\t\t\t\tif (!bindings) { bindings = []; }\n\t\t\t\t\t\tbindings.push(SetStyle, val);\n\t\t\t\t\t} else if (key === '$show') {\n\t\t\t\t\t\tif (!bindings) { bindings = []; }\n\t\t\t\t\t\tbindings.push(SetDisplay, val);\n\t\t\t\t\t} else if (key === '$toggle') {\n\t\t\t\t\t\tif (!bindings) { bindings = []; }\n\t\t\t\t\t\tbindings.push(SetToggle, val);\n\t\t\t\t\t} else if (key === '$channel') {\n\t\t\t\t\t\tthis.listen(val);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tERR(26, key);\n\t\t\t\t\t}\n\t\t\t\t} else if (typeof val === 'function') { // a dynamic binding\n\t\t\t\t\trendering.up(SetProp(this, parentVM, key, val))();\n\t\t\t\t} else { // static binding\n\t\t\t\t\tthis.$set(key, val);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn bindings;\n\t},\n\t$create: function(parentRendering, xattrs, slots) {\n\t\t// load definition\n\t\tvar bindings = parentRendering && this.$load(parentRendering, xattrs, slots);\n\t\tvar rendering = new Rendering(this);\n\t\t// must never return null - for non rendering components like popups we return a comment\n\t\tvar el = this.render(rendering) || document.createComment('<'+this.$tag+'/>');\n\t\tthis.$r = rendering;\n\t\tel.__qute__ = this;\n\t\tthis.$el = el;\n\t\tif (bindings) { for (var i=0,l=bindings.length; i<l; i+=2) {\n\t\t\tvar binding = bindings[i];\n\t\t\tvar up = bindings[i](el, parentRendering.vm, bindings[i+1]);\n\t\t\tparentRendering.up(up)();\n\t\t} }\n\t\tthis.created && this.created(el);\n\t\t// this can trigger a connect if tree is already connected (for example when inserting a comp in a connected list)\n\t\tparentRendering && parentRendering.$push(this);\n\t\treturn el;\n\t},\n\n\t// manual mount (only roots must be moutned this way)\n\tmount: function(elOrId, insertBefore) {\n\t\tif (this.$el) { ERR(33); } //TODO should check if connected and if not root\n\t\tvar target;\n\t\tif (elOrId) {\n\t\t\ttarget = typeof elOrId === 'string' ? document.getElementById(elOrId) : elOrId;\n\t\t} else {\n\t\t\ttarget = document.body;\n\t\t}\n\t\tvar el = this.$create();\n\t\tif (insertBefore) {\n\t\t\ttarget.parentNode.insertBefore(el, target);\n\t\t} else {\n\t\t\ttarget.appendChild(el);\n\t\t}\n\t\tthis.$connect();\n\t\t// announce the tree was attached to the DOM\n\t\treturn this;\n\t},\n\t// only manually mounted vms can be unmounted\n\tunmount: function() {\n\t\t// a child vm?\n\t\t//if (this.$p) ERR();\n\t\tif (!this.$el) { ERR(34); } // TODO check if root and mounted\n\t\tthis.$disconnect();\n\t\tthis.$el.parentNode.removeChild(this.$el);\n\t},\n\t$update: function(key) {\n\t\tif (this.$el) { // only if connected\n\t\t\tthis.$r.$update();\n\t\t}\n\t},\n\tupdate: function(key) {\n\t\tif (this.$st === 1) { // only if connected and not already scheduled to update\n\t\t\tthis.$st |= 2; // set updating flag\n\t\t\tvar self = this;\n\t\t\tUpdateQueue.push(function() {\n\t\t\t\tself.$update(key);\n\t\t\t\tself.$st ^= 2; // remove updating flag\n\t\t\t});\n\t\t}\n\t},\n\t$on: function(type/*, selector, cb*/) {\n\t\tif (!this.$el) { ERR(34); }\n\t\t//if (!this.$clean) this.$clean = [];\n\t\tvar selector, cb;\n\t\tif (arguments.length === 3) {\n\t\t\tselector = arguments[1];\n\t\t\tcb = arguments[2];\n\t\t\tif (!cb) {\n\t\t\t\tcb = selector;\n\t\t\t\tselector = null;\n\t\t\t\tif (!cb) { throw new Error('on function requires a callback argument'); }\n\t\t\t}\n\t\t} else if (arguments.length === 2) {\n\t\t\tcb = arguments[1];\n\t\t} else {\n\t\t\tthrow new Error('on function takes 2 or 3 arguments: eventType[, seelctor], callback');\n\t\t}\n\t\tvar self = this;\n\t\tvar wrapper = function(e) {\n\t\t\tif (!selector || e.target.matches(selector)) {\n\t\t\t\tif (cb.call(self, e) === false) {\n\t\t\t\t\tstopEvent(e);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\tthis.$el.addEventListener(type, wrapper);\n\t\tthis.cleanup(function() {\n\t\t\tself.$el.removeEventListener(type, wrapper);\n\t\t});\n\t\t//this.$clean.push(type, wrapper);\n\t},\n\temit: Emitter.emit,\n\temitAsync: Emitter.emitAsync,\n\t// -------- ctx event bus -------------\n\tpost: function(topic, msg, data) {\n\t\tthis.$ctx.post(topic, msg, data);\n\t},\n\tpostAsync: function(topic, msg, data) {\n\t\tthis.$ctx.postAsync(topic, msg, data);\n\t},\n\t// subscribe and register cleanup to remove subscription at disconnect\n\tsubscribe: function(name, listenerFn) {\n\t\tvar ctx = this.$ctx;\n\t\tctx.subscribe(name, listenerFn.bind(this));\n\t\tthis.cleanup(function() {\n\t\t\tctx.unsubscribe(name, listenerFn);\n\t\t});\n\t\treturn this;\n\t},\n\tsubscribeOnce: function(topic, event, listenerFn) {\n\t\tvar ctx = this.$ctx;\n\t\tvar onceSubscription = ctx.subscribeOnce(topic, event, listenerFn.bind(this));\n\t\tthis.cleanup(function() {\n\t\t\tctx.unsubscribe(topic, onceSubscription);\n\t\t});\n\t\treturn this;\n\t},\n\ttoHTML: function() {\n\t\treturn this.$el && this.$el.outerHTML;\n\t},\n\t// ---------------------------------------------\n\tinit: function() {} // do nothing\n};\n\n/**\n * We cannot use Object.assign since getter are lost. So we copy the prop def itself\n */\nfunction assignPropDefs(dst, src) {\n\tvar keys = Object.keys(src);\n    for(var i=0,l=keys.length; i<l; i++) {\n      var key = keys[i];\n      Object.defineProperty(dst, key, Object.getOwnPropertyDescriptor(src, key));\n    }\n    return dst;\n}\n\nfunction Qute(tag, def, BaseVm) {\n\tif (!tag) { ERR(5); }\n\n\tfunction ViewModelImpl(ctx, attrs) {\n\t\tViewModel.call(this, ctx, attrs);\n\t}\n\n\tvar VMType, VMProto;\n\tif (typeof def === 'function') {\n\t\tif (def.prototype instanceof ViewModel)\t{\n\t\t\t// VM is defined as a class\n\t\t\tVMType = def;\n\t\t\tVMProto = VMType.prototype;\n\t\t} else {\n\t\t\t// a rendering function - we simply register the rendering fucntion for the given tag\n\t\t\treturn registerTag(tag, def);\n\t\t}\n\t} else { // VM definition object\n\t\tif (!BaseVm) { BaseVm = ViewModel; }\n\t\tVMProto = Object.create(BaseVm.prototype, {\n\t\t\tconstructor: {value:ViewModelImpl},\n\t\t});\n\t\tif (def) { assignPropDefs(VMProto, def); } // this is preserving getters\n\t\tVMProto.$super = BaseVm.prototype; // to be able to override methods and call the super method if needed\n\t\tViewModelImpl.prototype = VMProto;\n\n\t\tVMType = ViewModelImpl;\n\t}\n\n\t// add the rendering method of the tag if no one was provided\n\tif (!VMProto.render) {\n\t\tVMProto.render = Qute.template(tag);\n\t\tif (!VMProto.render) {\n\t\t\tERR(36, tag);\n\t\t}\n\t}\n\t// add the tag meta property\n\tVMProto.$tag = tag;\n\n\tregisterVM(tag, VMType);\n\n\tVMType.watch = function(prop, fn) {\n\t\tif (!VMProto.$watch) { Object.defineProperty(VMProto, '$watch', {value:{}}); }\n\t\tVMProto.$watch[prop] = fn;\n\t\treturn VMType;\n\t};\n\tVMType.on = function(key, selector, cb) {\n\t\tVMProto.$init = chainFnAfter(function(thisObj) {\n\t\t\tthisObj.$on(key, selector, cb);\n\t\t}, VMProto.$init);\n\t\treturn VMType;\n\t};\n\tVMType.channel = function(listenFn) {\n\t\tVMProto.$channel = listenFn;\n\t\treturn this;\n\t};\n\n\treturn VMType;\n}\n\nQute.List = List;\nQute.ViewModel = ViewModel;\n\n// link a viewmodel to a template. Usefull for classes where defining prototype methods is not part of the class syntax\nQute.link = function(VMType, renderFn) {\n\tVMType.prototype.render = renderFn;\n};\n\n\nvar QUTE_STYLE=null;\nQute.css = function(css) {\n\tvar doc = window.document;\n\tif (!QUTE_STYLE) {\n\t\tvar style = doc.getElementById('--qute-inline-styles');\n\t\tif (!style) {\n\t\t\tstyle = doc.createElement('STYLE');\n\t\t\tstyle.id = '--qute-inline-styles';\n\t\t\tstyle.type = 'text/css';\n\t\t\tstyle.textContent = \"\\n\";\n\t\t\tdoc.head.insertBefore(style, doc.head.firstChild);\n\t\t}\n\t\tQUTE_STYLE = style;\n\t}\n\tQUTE_STYLE.textContent += css;\n};\n\nQute.converters = {};\nContext.Qute = Qute; // we need this to access globals defined in Qute like converters\nQute.Context = Context;\nQute.UpdateQueue = UpdateQueue;\nQute.Rendering = Rendering;\n// render a functional template given its tag name and a model\nQute.render = function(xtagName, model) {\n\treturn getTag(xtagName)(new Rendering(model));\n};\n\nQute.register = registerTag;\nQute.template = getTag;\nQute.snapshotRegistry = snapshotRegistry;\nQute.restoreRegistry = restoreRegistry;\nQute.vm = getVM;\nQute.vmOrTemplate = getVMOrTag;\n\nQute.runAfter = function(cb) { UpdateQueue.runAfter(cb); };\nQute.closest = closestVM;\nQute.ERR = ERR;\n\nexport default Qute;\n//# sourceMappingURL=index.esm.js.map\n","function splitList(text) {\n\tif (!text) { return undefined; }\n\ttext = text.trim();\n\tif (!text) { return undefined; }\n\tvar rx = text.indexOf(',') > -1 ? /\\s*,\\s*/ : /\\s+/;\n\treturn makeSymbols(text.split(rx));\n}\n\nfunction makeSymbols(keys) {\n\treturn keys.reduce(function(acc, value) {\n\t\tacc[value] = true;\n\t\treturn acc;\n\t}, {});\n}\n\nfunction ERR(msg) {\n\tthrow new Error(msg);\n}\n\n// A regex HTML PARSER extended to support special attr names (inspired from https://johnresig.com/blog/pure-javascript-html-parser/)\n\n\nvar STAG_RX = /^<([-A-Za-z0-9_:]+)((?:\\s+[-\\w@#:]+(?:\\s*=\\s*(?:(?:\"[^\"]*\")|(?:'[^']*')|(?:\\{[^}]*\\})|[^>\\s]+))?)*)\\s*(\\/?)>/,\n    ETAG_RX = /^<\\/([-A-Za-z0-9_:]+)[^>]*>/,\n    ATTR_RX = /([-A-Za-z0-9_@#:]+)(?:\\s*=\\s*(?:(?:\"((?:\\\\.|[^\"])*)\")|(?:'((?:\\\\.|[^'])*)')|(?:\\{((?:\\\\.|[^}])*)\\})|([^>\\s]+)))?/g;\n\nvar voids = {else:true, case:true, area:true, base:true, br:true, col:true, embed:true, hr:true, img:true, input:true, link:true, meta:true, param:true, source:true, track:true, wbr:true};\n\nfunction parseHTML(html, handler) {\n    function handleStartTag(tagName, attrsDecl, isVoid) { // void elements are tags with no close tag\n        tagName = tagName.toLowerCase();\n        isVoid = isVoid || voids[tagName];\n        if (!isVoid) { stack.push(tagName); }\n        var attrs = [];\n        ATTR_RX.lastIndex = 0;\n        var m = ATTR_RX.exec(attrsDecl);\n        while (m) {\n            // preserve empty values like: \"\" or ''. If attribute with no value then the boolean true is used as the value\n            var v = m[2] != null ? m[2] : (m[3] != null ? m[3] : (m[4] != null ? m[4] : (m[5] != null ? m[5] : true)));\n            attrs.push({ name: m[1], value: v, expr: m[4] != null });\n            m = ATTR_RX.exec(attrsDecl);\n        }\n        handler.start(tagName, attrs, !!isVoid);\n    }\n\n    function handleEndTag(tagName) {\n        tagName = tagName.toLowerCase();\n        var top = stack.pop();\n        if (top !== tagName) { throw new Error('Unmatched close tag. Current Open tag is <'+top+'> but found </'+tagName+'>') }\n        handler.end(tagName);\n    }\n\n    var text = '', match = null, stack = [];\n    while (html) {\n        var i = html.indexOf('<');\n        if (i === -1) {\n            text += html;\n            html = null; // exit\n        } else if (i > 0) {\n            text += html.substring(0, i);\n            html = html.substring(i);\n        } else { // i === 0\n            var c = html.charAt(i+1);\n            if (c === '!' && html.substring(i+2, i+4) === '--') { // <!--\n                if (text && handler.text) { handler.text(text); text = ''; }\n                var k = html.indexOf('-->', i+3);\n                if (k === -1) {\n                    throw new Error('Parse error: comment not closed');\n                }\n                if (handler.comment) { handler.comment(html.substring(i+3, k)); }\n                html = html.substring(k+3);\n            } else if (c === '/' && (match = ETAG_RX.exec(html))) { // end tag\n                if (text && handler.text) { handler.text(text); text = ''; }\n                html = html.substring(i+match[0].length);\n                handleEndTag(match[1]);\n            } else if (match = STAG_RX.exec(html)) { // start tag\n                if (text && handler.text) { handler.text(text); text = ''; }\n                html = html.substring(i+match[0].length);\n                handleStartTag(match[1], match[2], match[3]);\n            } else { // not a html tag\n                // get the next <\n                var next = html.indexOf('<', i+1);\n                if (next === -1) {\n                    text += html;\n                    html = null;\n                } else {\n                    text += html.substring(i, next);\n                    html = html.substring(next);\n                }\n            }\n        }\n    }\n    if (text && handler.text) { handler.text(text); }\n    if (stack.length > 0) {\n        throw new Error(\"Unclosed tag: \"+stack[0]);\n    }\n}\n\n/**\n * Transform jsq files to js files\n * No map file is required since the transformation preserve original code lines\n */\n\n\nvar TAG_RX = /(?:^|\\n)\\s*<(?:(x-tag)|(x-style))(\\s+[^>]*)?>/;\nvar TAG_END_RX = /\\s*<\\/(?:(x-tag)|(x-style))\\s*>/;\nvar ATTR_RX$1 = /([-A-Za-z0-9_]+)(?:\\s*=\\s*(?:(?:\"((?:\\\\.|[^\"])*)\")|(?:'((?:\\\\.|[^'])*)')|([^>\\s]+)))?/g;\nvar CNT_LINES_RX = /\\n/g;\n\nfunction getTagName(match) {\n    if (match[1]) { return 'x-tag'; }\n    if (match[2]) { return 'x-style'; }\n    ERR(\"Bug?\");\n}\n\n\nfunction parseAttrs(attrsDecl) {\n    var attrs = {};\n    ATTR_RX$1.lastIndex = 0;\n    var m = ATTR_RX$1.exec(attrsDecl);\n    while (m) {\n        // preserve empty values like: \"\" or ''. If attribute with no value then the boolean true is used as the value\n        attrs[m[1]] = m[2] != null ? m[2] : (m[3] != null ? m[3] : (m[4] != null ? m[4] : true));\n        m = ATTR_RX$1.exec(attrsDecl);\n    }\n    return attrs;\n}\n\nfunction newLines(text) { // remove any characters but new lines from given text\n\tvar ar = text.match(CNT_LINES_RX);\n    return ar ? ar.join('') : '';\n}\n\nfunction parseXTags(source, handler) {\n    var m = TAG_RX.exec(source);\n    while (m) {\n    \tvar lfs = newLines(m[0]);\n        var partText = source.substring(0, m.index);\n        if (partText) {\n            handler.text(partText+lfs);\n        }\n        source = source.substring(m.index+m[0].length);\n        var stag = getTagName(m);\n        var attrs = m[3];\n        if (attrs) { attrs = attrs.trim(); }\n        m = TAG_END_RX.exec(source);\n        if (!m) { ERR((\"Invalid qute file: No closing </\" + stag + \"> found.\")); }\n\n        var etag = getTagName(m);\n        if (etag !== stag) { ERR((\"Invalid qute file: Found closing tag '\" + etag + \"'. Expecting '\" + stag + \"'\")); }\n\n        partText = source.substring(0, m.index);\n        handler.tag(stag, attrs ? parseAttrs(attrs) : null, partText);\n\n        source = source.substring(m.index+m[0].length);\n        m = TAG_RX.exec(source);\n    }\n    // scan for imports on the remaining text\n    if (source)  {\n        handler.text(source);\n    }\n}\n\n\n// ======================= transform JSQ to JS =====================\n\nfunction handleTemplate(compiler, attrs, text) {\n\tif (!attrs || !attrs.name) { ERR(\"x-tag attribute 'name' is required\"); }\n    var name = attrs.name;\n    //var fname = kebabToCamel(name);\n    var imports = attrs.import || null;\n\n    var compiledFn = compiler.compile(text, splitList(imports));\n    return 'Qute.register(\"'+name+'\", '+compiledFn+', true);\\n';\n}\n\nfunction handleStyle(compiler, attrs, text) {\n    return 'Qute.css('+JSON.stringify(text.trim())+');\\n';\n}\n\nfunction transpile(compiler, source, opts) {\n    // We do not validate source -> If the source is not including a import Qute from ... then\n    // a syntgax error will be trown by javascript (since Qute symbol will not be found)\n\n\tvar out = '';\n    parseXTags(source, {\n        tag: function(tag, attrs, text) {\n            if (text) {\n                if (tag === 'x-tag') {\n                    out += handleTemplate(compiler, attrs, text);\n                } else if (tag === 'x-style') {\n                    out += handleStyle(compiler, attrs, text);\n                } else {\n                \tERR((\"Unsupported tag: '\" + tag + \"'\"));\n                }\n                if (!(opts && opts.removeNewLines)) { out += newLines(text); }\n            }\n        },\n        text: function(text) {\n        \tif (text) { out += text; }\n        }\n    });\n\n    return out;\n}\n\n/*\n  cb is a callback which will be called when an xtag was parsed:\n  cb(xtagName, xtagFn, isCompiled)\n */\nfunction loadXTags(compiler, source, cb) {\n    parseXTags(source, {\n        tag: function(tag, attrs, text) {\n            if (tag !== 'x-tag') { ERR((\"Unsupported tag: '\" + tag + \"'\")); }\n            if (!attrs || !attrs.name) { ERR(\"x-tag attribute 'name' is required\"); }\n            var fn = compiler.compileFn(text, splitList(attrs.import));\n            cb(attrs.name, fn, !attrs.static);\n        },\n        text: function(){} // ignore\n    });\n}\n\n/*\nattrs: {key: value, $, @}\n\nh(tag, attrs[, bindings, events], children) - output dom node\nv(expr) - variable text\nt(text) - static text\nf(list, item, index, hasNext, node) - for\nx(expr, ifFragment, elseFragment) - if\nc(tag, attrs, children) - view\n*/\n\n\n\n/*\n1. Rewrite var names inside a literal object representation: we need to avoid rewriting words inside simple or double quoted strings or unquoted keys (which looks like vars)\n\nQSTR:\n'(?:\\\\.|[^'])*'\nDQSTR:\n\"(?:\\\\.|[^\"])*\"\nVAR:\n[a-zA-Z_\\$][0-9a-zA-Z_\\$]*\nKEY:\n[\\{,]\\s*[a-zA-Z_\\$][0-9a-zA-Z_\\$]*\\s*\\:\n\n((?:QSTR)|(?:DQSTR)|(?:KEY))|(VAR)\n=> p1: ignore (String or key), p2: var\n\n2. Rewrite var names in expressions (no literal obj reprentation)\nWe can do this using the same regex as above like this:\n((?:QSTR)|(?:DQSTR))|(VAR)\n=> p1: ignore (String), p2: var\n*/\nvar VAR_RX = /^[a-zA-Z_\\$][0-9a-zA-Z_\\$]*$/;\nvar EXPR_RX = /((?:'(?:\\\\.|[^'])*')|(?:\"(?:\\\\.|[^\"])*\"))|([a-zA-Z_\\$][0-9a-zA-Z_\\$\\.]*)/g;\nvar OBJ_RX = /((?:'(?:\\\\.|[^'])*')|(?:\"(?:\\\\.|[^\"])*\")|(?:[\\{,]\\s*[a-zA-Z_\\$][0-9a-zA-Z_\\$\\.]*\\s*\\:))|([a-zA-Z_\\$][0-9a-zA-Z_\\$\\.]*)/g;\n\nvar ARROW_FN_RX = /^(\\(?)\\s*((?:[a-zA-Z_$][a-zA-Z_$0-9]*)(?:\\s*,\\s*[a-zA-Z_$][a-zA-Z_$0-9]*)*)(\\)?)\\s*=>\\s*(.*)$/;\n// nested is a special tag we added for convenience in the regular html tags - it is used as a more meaningful replacement of template or div\nvar HTML_TAGS = makeSymbols(\"nested html head meta link title base body style nav header footer main aside article section h1 h2 h3 h4 h5 h6 div p pre blockquote hr ul ol li dl dt dd span a em strong b i u s del ins mark small sup sub dfn code var samp kbd q cite ruby rt rp br wbr bdo bdi table caption tr td th thead tfoot tbody colgroup col img figure figcaption map area video audio source track script noscript object param embed iframe canvas abbr address meter progress time form button input textarea select option optgroup label fieldset legend datalist menu output details summary command keygen acronym applet bgsound basefont big center dir font frame frameset noframes strike tt xmp template\".split(\" \"));\n\n\nfunction _s(val) {\n    return JSON.stringify(val);\n}\n\nfunction _key(match) {\n\tvar i = match.indexOf('.');\n\treturn i > 0 ? match.substring(0,i) : match;\n}\n// write expr (without literal objects) by rewriting vars\nfunction __x(expr, ctx) {\n    return expr.replace(EXPR_RX, function(match, p1, p2) {\n    \tif (!p2) { return match; }\n    \tif (p2 === 'this') { // replace by 'm'\n    \t\treturn 'm';\n    \t} else if (p2.startsWith('this.')) {\n    \t\treturn 'm'+p2.substring(4);\n    \t}\n    \treturn !ctx.symbols[_key(match)] ? 'm.'+p2 : match;\n    });\n}\nfunction _x(expr, ctx) {\n    return '(' + __x(expr, ctx) + ')';\n}\n// write literal object by rewriting vars\nfunction _o(expr, ctx) {\n    return '(' + expr.replace(OBJ_RX, function(match, p1, p2) {\n    \tif (!p2) { return match; }\n    \tif (p2 === 'this') { // replace by 'm'\n    \t\treturn 'm';\n    \t} else if (p2.startsWith('this.')) {\n    \t\treturn 'm'+p2.substring(4);\n    \t}\n    \treturn !ctx.symbols[_key(match)] ? 'm.'+p2 : match;\n    }) + ')';\n}\nfunction _xo(expr, ctx) {\n\tif (expr == null) { return 'null'; }\n\tvar c = expr.charAt(0);\n\treturn (c === '{' || c === '[' ? _o : _x)(expr, ctx);\n}\n// used to wrap a compiled expr in a lambda function\nfunction _v(expr) {\n\treturn 'function(m){return '+expr+'}';\n}\nfunction _r(expr) { // a sub-rendering context fn\n\treturn 'function($){return '+expr+'}';\n}\n\nfunction getArrowFn(expr, ctx) {\n\tvar m = ARROW_FN_RX.exec(expr);\n\tif (m) {\n\t\tvar open = m[1];\n\t\tvar args = m[2].trim();\n\t\tvar close = m[3];\n\t\tvar body = m[4].trim();\n\n\t\tif (!!open !== !!close) {\n\t\t\tERR('Invalid arrow function syntax: '+expr);\n\t\t}\n\t\tif (!body) {\n\t\t\tERR('Invalid arrow function syntax: '+expr);\n\t\t}\n\t\t// 123 = { and 125 = }\n\t\tvar bs = body.charCodeAt(0);\n\t\tvar be = body.charCodeAt(body.length-1);\n\t\tif (bs === 123) {\n\t\t\tif (be !== 125) {\n\t\t\t\tERR('Invalid arrow function syntax: '+expr);\n\t\t\t} // else body is in the form { ... }\n\t\t} else if (be === 125) {\n\t\t\tERR('Invalid arrow function syntax: '+expr);\n\t\t} else { // no { ... }\n\t\t\tbody = '{'+body+';}';\n\t\t}\n\t\t// push in ctx.symbols  the local vars\n\t\tvar symbols = ctx.symbols;\n\t\tvar localSymbols = Object.assign({},symbols);\n\t\targs.split(/\\s*,\\s*/).forEach(function (key) { localSymbols[key] = true; });\n\t\tctx.symbols = localSymbols;\n\t\tvar r = '(function('+args+')'+__x(body, ctx)+')($1,m)'; // call the inline fn with the m (this) and the $1 argument\n\t\tctx.symbols = symbols; // restore symbols\n\t\treturn r;\n\t\t// pop from ctx symbols the local vars\n\t}\n\treturn null;\n}\n// write a callback (e.g. they are used by events)\n// if the event is a var name => we generate a fn: function(e) { expr(e) }\n// otherwise we generate a function: function() { expr }\nfunction _cb(expr, ctx) {\n\tif (VAR_RX.test(expr)) {\n\t\t// event listeners will be called with args:\n\t\t// 1. for functions: VM.callback(event) - where this is the VM\n\t\t// 2. for vm methods: VM.callback(event) - where this is the VM\n\t\t// 3. for expressions: $1 - the event, this - the vm\n\t\t// the event cb function must always be called with the element as the 'this' object\n\t\tif (ctx.imports[expr]) { // an imported function\n\t\t\treturn \"function($1){return \"+expr+\".call(this, $1)}\";\n\t\t} else { // a vm method\n\t\t\treturn \"function($1){return this.\"+expr+\"($1)}\";\n\t\t}\n\t} else {\n\t\tvar arrowFn = getArrowFn(expr, ctx);\n\t\tif (arrowFn) {\n\t\t\t//return \"function(this,$1){\"+arrowFn+\"}\";\n\t\t\treturn \"function($1){var m=this;\"+arrowFn+\"}\";\n\t\t} else {\n\t\t\treturn \"function($1){var m=this;\"+_x(expr, ctx)+\"}\";\n\t\t}\n\t}\n}\n\nfunction _fn(name) {\n\t//TODO '$' must not be used as a for argument!!\n\tvar r = '$.'+name+'(';\n\tif (arguments.length>1) {\n\t\tr += Array.prototype.slice.call(arguments, 1).join(',');\n\t}\n\treturn r+')';\n}\nfunction _node(xattrs, ctx) {\n\treturn xattrs ? xattrs.compile(ctx) : 'null';\n}\nfunction _nodes(children, ctx) {\n\tif (!children || !children.length) { return 'null'; }\n\treturn '['+children.map(function(child) {\n\t\treturn child.compile(ctx);\n\t}).join(',')+']';\n}\n/*\nfunction _bindings(bindings, ctx) {\n\tvar out = [];\n\tfor (var key in bindings) {\n\t\tout.push(_s(key)+':'+_v(_xo(bindings[key], ctx)));\n\t}\n\treturn out.length ? '{'+out.join(',')+'}' : null;\n}\n*/\n/*\nfunction _bindings(bindings, ctx) {\n\tvar out = [];\n\tfor (var key in bindings) {\n\t\tout.push(_s(key)+':'+_xo(bindings[key], ctx));\n\t}\n\treturn out.length ? _v('{'+out.join(',')+'}') : null;\n}\n*/\nfunction _events(events, ctx) {\n\tvar out = [];\n\tfor (var key in events) {\n\t\tout.push(_s(key)+':'+_cb(events[key], ctx));\n\t}\n\treturn out.length ? '{'+out.join(',')+'}' : null;\n}\n/*\nfunction _attrs(attrs) {\n\tvar out = null;\n\tif (attrs) {\n\t\tout = [];\n\t\tfor (var key in attrs) {\n\t\t\tout.push(_s(key)+':'+_s(attrs[key]));\n\t\t}\n\t}\n\treturn out && out.length ? '{'+out.join(',')+'}' : 'null';\n}\n*/\n/*\nol impl which compile each binding as a function\nfunction _xattrs(bindings, events, ctx) {\n\tvar out = null;\n\tif (bindings) {\n\t\tout = [];\n\t\tfor (var key in bindings) {\n\t\t\t// TODO use v(..) only if not a literal to optimize literal assignment like boolean or number (do not enclose in a function)\n\t\t\tout.push(_s(key)+':'+_v(_xo(bindings[key], ctx)));\n\t\t}\n\t}\n\tif (events) {\n\t\tout || (out = []);\n\t\tvar v = _events(events, ctx);\n\t\tif (v) out.push('\"$on\":'+v);\n\t}\n\treturn out && out.length ? '{'+out.join(',')+'}' : 'null';\n}\n*/\nfunction _xattrs(attrs, bindings, xattrs, directives, events, ctx) {\n\tvar out = null;\n\tif (attrs) {\n\t\tout = [];\n\t\tfor (var key in attrs) {\n\t\t\tout.push(_s(key)+':'+_s(attrs[key]));\n\t\t}\n\t}\n\tif (bindings) {\n\t\tout || (out = []);\n\t\tfor (var key in bindings) {\n\t\t\tout.push(_s(key)+':'+_v(_xo(bindings[key], ctx)));\n\t\t}\n\t}\n\tif (xattrs) {\n\t\tout || (out = []);\n\t\tfor (var key in xattrs) {\n\t\t\tvar val;\n\t\t\tif (key === '$attrs' || key === '$listeners') {\n\t\t\t\tval = xattrs[key];\n\t\t\t} else {\n\t\t\t\tval = _v(_xo(xattrs[key], ctx));\n\t\t\t}\n\t\t\tout.push(_s(key)+':'+val);\n\t\t}\n\t}\n\tif (directives) {\n\t\tout || (out = []);\n\t\tfor (var key in directives) {\n\t\t\tout.push(_s(key)+':'+directives[key]); // directives are already encoded\n\t\t}\n\t}\n\tif (events) {\n\t\tout || (out = []);\n\t\tvar v = _events(events, ctx);\n\t\tif (v) { out.push('\"$on\":'+v); }\n\t}\n\treturn out && out.length ? '{'+out.join(',')+'}' : 'null';\n}\n\nfunction attrValue(attr) {\n\treturn attr.value === true ? attr.name : attr.value;\n}\n\nfunction RootNode() {\n\tthis.name = 'root';\n\tthis.children = [];\n\tthis.append = function(child) {\n        this.children.push(child);\n\t};\n\tthis.lastChild = function() {\n\t\treturn this.children[this.children.length-1];\n\t};\n\tthis.compile = function(ctx) {\n\t\tvar children = this.children;\n\t\tif (children.length !== 1) { ERR(\"the root node must have a single children element\"); }\n\t\treturn this.children[0].compile(ctx);\n\t};\n\t// trim the children (remove trailing and leading blank nodes)\n\tthis.trim = function() {\n\t\tvar children = this.children;\n\t\tif (children.length > 1) {\n\t\t\tvar child = children[0];\n\t\t\tif (child instanceof TextNode && child.isBlank) { children.shift(); }\n\t\t\tchild = children[children.length-1];\n\t\t\tif (child instanceof TextNode && child.isBlank) {\n\t\t\t\tchild.pop();\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t};\n}\n\nfunction DomNode(name, attrs) {\n\tthis.name = name;\n\tthis.attrs = null;\n\tthis.bindings = null;\n\tthis.xattrs = null; // directives like x-show\n\t// for future use (not yet used)\n\t// directives are custom attrs that can be  contirbuted by apps\n\t// They are treated like xattrs but are output as is (as they are encoded at read time)\n\tthis.directives = null;\n\tthis.events = null;\n\tthis.children = [];\n\n\tthis.attr = function(name, value) {\n\t\tif (!this.attrs) { this.attrs = {}; }\n\t\tthis.attrs[name] = value;\n\t};\n\tthis.bind = function(name, value) {\n\t\tvar bindings = this.bindings || (this.bindings = {});\n\t\tbindings[name] = value.trim();\n\t};\n\tthis.xattr = function(name, value) {\n\t\tif (!this.xattrs) { this.xattrs = {}; }\n\t\tthis.xattrs[name] = value.trim();\n\t};\n\tthis.directive = function(name, value) {\n\t\tif (!this.directives) { this.directives = {}; }\n\t\tthis.directives[name] = value;\n\t};\n\tthis.on = function(name, value) {\n\t\tvar events = this.events || (this.events = {});\n\t\tevents[name] = value.trim();\n\t};\n\n\tthis.append = function(node) {\n\t\tthis.children.push(node);\n\t};\n\n\tthis.compile = function(ctx) {\n\t\tif (this.name === 'tag') {\n\t\t\tvar attrs = this.attrs;\n\t\t\tif (!attrs || !attrs.is) { ERR(\"<tag> requires an 'is' attribute\"); }\n\t\t\tvar isAttr = attrs.is;\n\t\t\tdelete attrs.is;\n\t\t\treturn _fn('g', _v(_x(isAttr, ctx)), // g from tag\n\t\t\t\t//_attrs(this.attrs),\n\t\t\t\t_xattrs(this.attrs, this.bindings, this.xattrs, this.directives, this.events, ctx),\n\t\t\t\t_nodes(this.children, ctx));\n\t\t}\n\t\tif (this.name === 'view') {\n\t\t\tvar attrs = this.attrs;\n\t\t\tif (!attrs || !attrs.is) { ERR(\"<view> requires an 'is' attribute\"); }\n\n\t\t\tvar isExpr = _v(_x(attrs.is, ctx));\n\t\t\tdelete attrs.is;\n\t\t\tvar noCache = 'false';\n\t\t\tif ('x-nocache' in attrs) {\n\t\t\t\tdelete attrs['x-nocache'];\n\t\t\t\tnoCache = 'true';\n\t\t\t}\n\t\t\tvar onChange = 'null';\n\t\t\tif ('x-change' in attrs) {\n\t\t\t\tonChange = _cb(attrs['x-change'], ctx);\n\t\t\t\tdelete attrs['x-change'];\n\t\t\t}\n\n\t\t\treturn _fn('w', // w from view ?\n\t\t\t\tisExpr,\n\t\t\t\tonChange,\n\t\t\t\tnoCache,\n\t\t\t\t_xattrs(this.attrs, this.bindings, this.xattrs, this.directives, this.events, ctx), //xattrs\n\t\t\t\t_r(_nodes(this.children, ctx)) // childrenFn\n\t\t\t);\n\t\t}\n\t\tvar fname, tag;\n\t\t//if (ctx.isXTag(this.name))\n\t\tif (this.name in HTML_TAGS) { // a dom element\n\t\t\tfname = 'h'; // h from html\n\t\t\ttag = _s(this.name);\n\t\t} else { // a component\n\t\t\tvar tag = ctx.resolve(this.name);\n\t\t\tif (tag) { // resolved compile time\n\t\t\t\tfname = 'v'; // v from view model\n\t\t\t} else { // should resolve at runtime\n\t\t\t\tfname = 'r'; // r from runtime\n\t\t\t\ttag = _s(this.name);\n\t\t\t}\n\t\t}\n\t\tif (this.name==='pre') {\n\t\t\tctx = ctx.push();\n\t\t\tctx.pre = true;\n\t\t}\n\t\treturn _fn(fname, tag,\n\t\t\t//_attrs(this.attrs),\n\t\t\t_xattrs(this.attrs, this.bindings, this.xattrs, this.directives, this.events, ctx),\n\t\t\t_nodes(this.children, ctx));\n\t};\n\n\tthis.xcontent = function(type, attr) {\n\t\tif (attr.value === true) {\n\t\t\treturn new StaticNode(this, type);\n\t\t} else {\n\t\t\t//TODO: use type ...\n    \t\tthis.xattr('$html', attr.value);\n    \t}\n    \treturn this;\n\t};\n\n\tfunction parseXAttrs(val) {\n\t\tif (val === true) { return 'null'; }\n\t\tvar first = true;\n\t\tif (val.charCodeAt(0) === 33) { // a ! -> exclude rule\n\t\t\tval = val.substring(1);\n\t\t\tfirst = false;\n\t\t}\n\t\tvar ar;\n\t\tval = val.trim();\n\t\tif (val.indexOf(',') > -1) {\n\t\t\tar = val.split(/\\s*,\\s*/);\n\t\t} else {\n\t\t\tar = val.split(/\\s+/);\n\t\t}\n\t\tar.unshift(first); // insert the filter type (true for inclusion, false for exclusion) as the first item\n\t\treturn _s(ar);\n\t}\n\n\tthis.parseAttrs = function(attrs) {\n\t\tvar r = this;\n\t\tfor (var i=0,l=attrs.length; i<l; i++) {\n\t    \tvar attr = attrs[i];\n\t    \tvar name = attr.name;\n\t        var c = name[0];\n\t        if (c === ':') {\n\t        \tthis.bind(name.substring(1), attr.value);\n\t        } else if (c === '@') {\n\t        \tthis.on(name.substring(1), attr.value);\n\t        } else if ('x-for' === name) {\n\t        \tr = new ListNode(attr.value, this);\n\t        } else if ('x-attrs' === name) {\n\t        \tthis.xattr('$attrs', parseXAttrs(attr.value));\n\t        } else if ('x-listeners' === name) {\n\t        \tthis.xattr('$listeners', parseXAttrs(attr.value));\n\t        } else if ('x-channel' === name) {\n\t        \tthis.attr('$channel', attr.value); // use a regular attr since valkue is always a string literal\n\t\t\t} else if ('x-show' === name) {\n\t\t\t\tthis.xattr('$show', attr.value);\n\t\t\t} else if ('x-class' === name) {\n\t\t\t\tthis.xattr('$class', attr.value);\n\t\t\t} else if ('x-style' === name) {\n\t\t\t\tthis.xattr('$style', attr.value);\n\t\t\t} else if ('x-toggle' === name) {\n\t\t\t\tthis.xattr('$toggle', attr.value);\n\t\t\t} else if ('x-html' === name) {\n\t\t\t\tif (attr.value === true) {\n\t\t\t\t\tr = new StaticNode(this, null);\n\t\t\t\t} else {\n    \t\t\t\tthis.xattr('$html', attr.value);\n    \t\t\t}\n\t\t\t} else if ('x-markdown' === name) {\n\t\t\t\tr = new StaticNode(this, 'markdown');\n\t        } else if (name.startsWith('x-content-')) {\n\t        \tvar ctype = name.substring('x-content-'.length);\n\t        \tr = new StaticNode(this, ctype !== 'html' ? ctype : null);\n\t        } else if (attr.expr) {\n\t        \t// an expression: support { ... } as an alternative for :name\n\t    \t\tthis.bind(name, attr.value);\n\t    \t} else if (name.startsWith('x-bind:')) {\n\t    \t\tthis.bind(name.substring(7), attr.value);\n\t    \t} else if (name.startsWith('x-on:')) {\n\t    \t\tthis.on(name.substring(5), attr.value);\n\t        } else {\n\t        \tthis.attr(name, attrValue(attr));\n\t        }\n\t\t}\n\t\treturn r;\n\t};\n\n\treturn this.parseAttrs(attrs);\n}\n// a DomNode that has static children (set with innerHTML from the template content)\nfunction StaticNode(node, type) {\n\tthis.node = node;\n\tthis.compile = function(ctx) {\n\t\treturn _fn('hh', _s(this.node.name),\n\t\t\t//_attrs(this.node.attrs),\n\t\t\t_xattrs(this.node.attrs, this.node.bindings, this.node.xattrs, this.node.directives, this.node.events, ctx),\n\t\t\t_s(this.html.join('')),\n\t\t\t_s(type)\n\t\t);\n\t};\n\n\t// compile logic\n\tthis.tag = node.name;\n\tthis.stack = [];\n\tthis.html = [];\n\tthis.start = function(tagName, attrs, isVoid) {\n\t\tvar html = this.html;\n\t\thtml.push('<', tagName);\n\t\tfor (var i=0,l=attrs.length; i<l; i++) {\n\t\t\tvar attr = attrs[i];\n\t\t\thtml.push(' ', attr.name);\n\t\t\tif (attr.value !== true) {\n\t\t\t\thtml.push('=\"', attr.value, '\"');\n\t\t\t}\n\t\t}\n\t\thtml.push(isVoid?'/>':'>');\n\t\tif (!isVoid) { this.stack.push(tagName); }\n\t};\n\tthis.end = function(tagName) {\n\t\tvar tag = this.stack.pop();\n\t\tif (tag) { // subtree traversed\n\t\t\tif (tag !== tagName) { ERR((\"Closing tag '\" + tagName + \"' doesn't match the start tag '\" + tag + \"'\")); }\n\t\t\tthis.html.push('</', tagName, '>');\n\t\t} else {\n\t\t\treturn true; // finished\n\t\t}\n\t};\n\tthis.text = function(text) {\n\t\tthis.html.push(text);\n\t};\n}\n\nfunction TextNode(value) {\n\tthis.value = value;\n\tthis.isBlank = value.trim().length===0;\n\tthis.compile = function(ctx) {\n\t\tvar value = this.isBlank && !ctx.pre ? this.value.trim()+' ' : this.value;\n\t\treturn _fn('t', _s(value));\n\t};\n\tthis.append = function(text) {\n\t\tthis.value += text;\n\t\tif (this.isBlank) { this.isBlank = this.value.trim().length===0; }\n\t};\n}\n\nfunction ExprNode() {\n\tthis.parts = [];\n\tthis.text = function(text) {\n\t\tthis.parts.push(false, text);\n\t};\n\tthis.expr = function(expr) {\n\t\tthis.parts.push(true, expr);\n\t};\n\tthis.compile = function(ctx) {\n\t\tvar parts = this.parts;\n\t\tvar out = [];\n\t\tfor (var i=0,l=parts.length; i<l; i+=2) {\n\t\t\tif (parts[i]) { out.push(_x(parts[i+1], ctx)); }\n\t\t\telse { out.push(_s(parts[i+1])); }\n\t\t}\n\t\treturn _fn('x', _v(out.join('+')));\n\t};\n}\n\nvar FOR_RX = /^\\s*(.+)\\s+in\\s+(.+)\\s*$/;\nfunction parseForExpr(listNode, expr) {\n\tvar m = FOR_RX.exec(expr);\n\tif (!m) { ERR(\"Invalid for expression\"); }\n\tlistNode.list = m[2].trim();\n\tvar item = m[1].trim();\n\tif (item.indexOf(',') > -1) {\n\t\tvar args = item.split(/\\s*,\\s*/);\n\t\tlistNode.item = args[0];\n\t\tlistNode.index = args[1];\n\t\tif (args.length > 2) { listNode.hasNext = args[2]; }\n\t} else {\n\t\tlistNode.item = item;\n\t}\n}\nfunction ListNode(expr, node) {\n\tthis.node = node;\n\tthis.list = null;\n\tthis.item = null;\n\t//TODO can we just not include them in args list? instead of using _?\n\tthis.index = '_';\n\tthis.hasNext = '__';\n\n\t// parse expr\n\tparseForExpr(this, expr);\n\n\tthis.append = function(node) {\n\t\tthis.node.append(node);\n\t};\n\n\tthis.compile = function(ctx) {\n\t\t// we wrap children in a inline fucntion def so that item, index and has_next are resolved inside the children nodes\n\t\t// also, _x function must not rewrite item, index and has_next variable ...\n\t\t// 1. compile children and avoid rewriting iteration vars\n\t\tvar forCtx = ctx.push();\n\t\tvar forSymbols = forCtx.symbols;\n\t\tforSymbols[this.item] = true;\n\t\tforSymbols[this.index] = true;\n\t\tforSymbols[this.hasNext] = true;\n\t\tvar children = _node(this.node, forCtx);\n\t\t// 2. wrap children\n\t\tvar childrenFn = 'function($,'+this.item+','+this.index+','+this.hasNext+'){return '+children+'}';\n\t\treturn _fn('l', _v(_x(this.list, ctx)), childrenFn);\n\t};\n\n}\n\nfunction ForNode(tag, attrs) {\n\tthis.list = null;\n\tthis.item = null;\n\tthis.index = '_';\n\tthis.hasNext = '__';\n\n\tthis.children = [];\n\tthis.append = function(child) {\n        this.children.push(child);\n\t};\n\tthis.lastChild = function() {\n\t\treturn this.children[this.children.length-1];\n\t};\n\tthis.compile = function(ctx) {\n\t\t// we wrap children in a inline fucntion def so that item, index and has_next are resolved inside the children nodes\n\t\t// also, _x function must not rewrite item, index and has_next variable ...\n\t\t// 1. compile children and avoid rewriting iteration vars\n\t\tvar forCtx = ctx.push();\n\t\tvar forSymbols = forCtx.symbols;\n\t\tforSymbols[this.item] = true;\n\t\tforSymbols[this.index] = true;\n\t\tforSymbols[this.hasNext] = true;\n\t\tvar children = _nodes(this.children, forCtx);\n\t\t// 2. wrap children\n\t\tvar childrenFn = 'function('+this.item+','+this.index+','+this.hasNext+'){return '+children+'}';\n\t\treturn _fn('a', _v(_x(this.list, ctx)), childrenFn);\n\t};\n\n\tif (attrs.length !== 1) { ERR(\"For directive take exatcly one attribute\"); }\n\tparseForExpr(this, attrs[0].value);\n}\n\nfunction IfNode(tag, attrs) {\n\tthis.children = [];\n\tthis._else = null;\n\tthis.change = null; // onchange event handler if any\n\tthis.expr = null;\n\n\t// we don't check the attr name - any name may be used (not only 'value')\n\tvar valueAttr = attrs[0];\n\tif (attrs.length === 2) {\n\t\tvar changeAttr = attrs[1];\n\t\tif (valueAttr.name === 'x-change') {\n\t\t\tchangeAttr = valueAttr;\n\t\t\tvalueAttr = attrs[1];\n\t\t} else if (changeAttr.name !== 'x-change') {\n\t\t\tERR((\"Invalid if attribute '\" + (changeAttr.name) + \"'. You may want to use x-change?\"));\n\t\t}\n\t\tthis.change = changeAttr.value;\n\t} else if (attrs.length !== 1) {\n\t\tERR(\"if has only one required attribute: value='expr' and an optional one: x-change='onChangeHandler'\");\n\t}\n\tthis.expr = attrValue(valueAttr);\n\n\tthis.append = function(node) {\n\t\tif (node instanceof ElseNode) {\n\t\t\tthis._else = [];\n\t\t} else if (this._else) {\n\t\t\tthis._else.push(node);\n\t\t} else {\n\t\t\tthis.children.push(node);\n\t\t}\n\t};\n\n\tthis.compile = function(ctx) {\n\t\tvar change = this.change ? _cb(this.change, ctx) : 'null';\n\t\tif (this._else) {\n\t\t\treturn _fn('i', _v(_x(this.expr, ctx)), change, _r(_nodes(this.children, ctx)), _r(_nodes(this._else, ctx)));\n\t\t} else {\n\t\t\treturn _fn('i', _v(_x(this.expr, ctx)), change, _r(_nodes(this.children, ctx)));\n\t\t}\n\t};\n}\n\nfunction ElseNode() {\n}\n\n\n//TODO\nfunction SlotNode(tagName, attrs) {\n\tthis.name = tagName;\n\tthis.children = [];\n\tthis.append = function(child) {\n        this.children.push(child);\n\t};\n\t//TODO is this needed?\n\tthis.lastChild = function() {\n\t\treturn this.children[this.children.length-1];\n\t};\n\tthis.process = function(processor) {\n\t\treturn processor.processSlot(this);\n\t};\n\tthis.compile = function(ctx) {\n\t\t// we push the 'm' (current model) because the slot renderer (i.e. r.s)\n\t\t// needs the current model to fetch the slot value\n\t\treturn _fn('s', _s(this.slotName), _nodes(this.children, ctx));\n\t};\n\tif (attrs.length > 1) { ERR(\"slot node take zero or one 'name' parameter\"); }\n\tthis.slotName = attrs.length ? attrValue(attrs[0]) : null;\n}\n\n\nvar MUSTACHE_RX = /\\{\\{([^\\}]+)\\}\\}/g;\n//var BLANK_RX = /^\\s*$/;\n\nvar NODES = {\n\t'if':  IfNode,\n\t'else':  ElseNode,\n\t'for':  ForNode,\n\t'slot': SlotNode\n};\n\nvar SYMBOLS = {\n\t\"true\": true, \"false\": true, \"undefined\": true, \"null\":true, \"$1\": true,\n\t\"this\":true, \"JSON\": true, \"Object\":true, \"console\":true, \"window\": true, \"$\": true\n};\n\n\n\nfunction Compiler() {\n\tfunction Context(symbols, imports, resolve, pre) {\n\t\tthis.pre = pre; // if pre then do not compact spaces in TextNodes\n\t\tthis.resolve = resolve;\n\t\tthis.symbols = symbols;\n\t\tthis.imports = imports;\n\t\tthis.push = function() {\n\t\t\treturn new Context(Object.assign({}, this.symbols), this.imports, this.resolve, this.pre);\n\t\t};\n\t}\n\t// collector is used only when static html should be collected sue to an x-html attribute\n\t// See StaticNode\n\tthis.collector = null;\n\tthis.top = null;\n\tthis.stack = [];\n\tthis.lastText = null; // used to merge adjacent text nodes\n\n\tthis.resolve = function(tag) {\n\t\treturn null;// the default is to resolve at runtime\n\t};\n\n\tthis.pushText = function(text) {\n\t\tif (this.lastText) { this.lastText.append(text); }\n\t\telse {\n\t\t\tvar node = new TextNode(text);\n\t\t\tthis.push(node, true);\n\t\t\tthis.lastText = node;\n\t\t}\n\t};\n\n\tthis.push = function(node, isVoid) {\n\t\tthis.lastText = null;\n\t\tthis.top.append(node);\n\t\tif (!isVoid) {\n\t\t\tthis.stack.push(this.top);\n\t\t\tthis.top = node;\n\t\t}\n\t};\n\n\tthis.pop = function() {\n\t\tthis.lastText = null;\n        var top = this.top;\n        this.top = this.stack.pop();\n        return top;\n\t};\n\n\n\tthis.text = function(text) {\n\t\tif (this.collector) {\n\t\t\tthis.collector.text(text);\n\t\t\treturn;\n\t\t}\n\t    var i = text.indexOf('{{'), s = 0;\n\t    if (i > -1) {\n\t        MUSTACHE_RX.lastIndex = i;\n\t        var match = MUSTACHE_RX.exec(text);\n\t        if (match) {\n\t           \tvar node = new ExprNode();\n\t            do {\n\t                var index = match.index;\n\t                if (index > s) {\n\t                    node.text(text.substring(s, index));\n\t                }\n\t                node.expr(match[1]);\n\t                s = MUSTACHE_RX.lastIndex;\n\t                match = MUSTACHE_RX.exec(text);\n\t            } while (match);\n\t            if (s < text.length) {\n\t                node.text(text.substring(s));\n\t            }\n\t            this.push(node, true);\n\t            return;\n\t        }\n\t    }\n\t    this.pushText(text);\n\t};\n\n\tthis.start = function(tagName, attrs, isVoid) {\n\t\tif (this.collector) {\n\t\t\tthis.collector.start(tagName, attrs, isVoid);\n\t\t} else {\n\t\t\tvar NodeType = NODES[tagName];\n\t\t\tvar node;\n\t\t\tif (NodeType) {\n\t\t\t\tnode = new NodeType(tagName, attrs, isVoid);\n\t\t\t} else {\n\t\t\t\tnode = new DomNode(tagName, attrs, isVoid);\n\t\t\t\tif (node instanceof StaticNode) {\n\t\t\t\t\t// allow <div x-conent-{random} />\n\t\t\t\t\t//if (isVoid) ERR(\"Static node (x-html) must have some content\");\n\t\t\t\t\tthis.collector = node;\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.push(node, isVoid);\n\t\t}\n\t};\n\n\tthis.end = function(tagName) {\n\t\tif (this.collector) {\n\t\t\tif (!this.collector.end(tagName)) {\n\t\t\t\treturn\n\t\t\t}\n\t\t\t// subtree traversed - remove collector\n\t\t\tthis.collector = null;\n\t\t}\n\t\tthis.pop();\n\t};\n\n\tthis.parse = function(text) {\n\t\tthis.top = new RootNode();\n\t\tparseHTML(text.trim(), {\n\t\t\tstart: this.start.bind(this),\n\t\t\tend: this.end.bind(this),\n\t\t\ttext: this.text.bind(this)\n\t\t});\n\t\t// \"trim\" the root node (blank text mnodes mayt appear because of comments)\n\t\treturn this.top.trim();\n\t};\n\n    this.compile = function(text, imports, pre) { // r is the Renderer\n    \tvar ctx = new Context(Object.assign(imports || {}, SYMBOLS), imports || {}, this.resolve, pre);\n    \tvar r = this.parse(text).compile(ctx);\n    \t//console.log(\"COMPILED:\",r);\n        return 'function($){return '+r+';}';\n    };\n\n\tthis.compileFn = function(text, imports, pre) {\n\t\tvar ctx = new Context(Object.assign(imports || {}, SYMBOLS), imports || {}, this.resolve, pre);\n    \tvar r = this.parse(text).compile(ctx);\n    \t//console.log(\"COMPILED:\",r);\n\t\treturn new Function('$', 'return '+r+';');\n\t};\n\n\tthis.transpile = function(source, opts) {\n\t\treturn transpile(this, source, opts);\n\t};\n\n\tthis.loadXTags = function(source, cb) {\n\t\treturn loadXTags(this, source, cb);\n\t};\n\n}\n\nexport default Compiler;\n//# sourceMappingURL=index.esm.js.map\n","import window, {document} from '@qute/window';\nimport Qute from '@qute/runtime';\nimport Compiler from '@qute/compiler';\nimport {capitalizeFirst, kebabToCamel} from '@qute/commons';\n\nvar IMPORT_RX = /^\\s*import\\s+(\\S+)\\s+from\\s+(?:(\\\"[^\"]+\\\")|(\\'[^']+\\')|([^\"'][^;\\s]*));?$/mg;\nvar EXPORT_RX = /^\\s*export\\s+default\\s+/m;\n\n\nexport default function Loader() {\n\tthis.createScript = function(code, name) {\n\t\tvar deps = {};\n\t\tcode = code.replace(IMPORT_RX, function(m, p1, p2, p3, p4) {\n\t\t\tvar path = p2 || p3 || p4;\n\n\t\t\tif (path) {\n\t\t\t\tif (path[0] === '.' && path[1] === '/') {\n\t\t\t\t\t//TODO resolve file path\n\t\t\t\t\tdeps[p1] = path;\n\t\t\t\t} else if (p1 !== 'Qute') {\n\t\t\t\t\tconsole.warning('Imports are ignored in dev version!')\n\t\t\t\t\tthrow new Error('Only relative paths are supported for import statements: '+m.trim());\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn m.replace('import ', '//import ');\n\t\t});\n\t\tvar hasExport = false;\n\t\tcode = code.replace(EXPORT_RX, function(m) {\n\t\t\thasExport = true;\n\t\t\treturn \"var __DEFAULT_EXPORT__ = \";\n\t\t});\n\t\tcode = new Compiler().transpile(code);\n\t\t// apply buble if needed\n\t\tif (window.buble && window.buble.transform) {\n\t\t\tcode = window.buble.transform(code).code;\n\t\t}\n\t\tif (hasExport) code += '\\nreturn __DEFAULT_EXPORT__;\\n';\n\t\t// for now script deps are expected to be declared above the script - otherwise compiling will fail\n\t\tvar comp = (new Function(code))();\n\n\t\tvar script = new Script();\n\t\tscript.name = comp ? name || capitalizeFirst(kebabToCamel(comp.prototype.$tag)) : null;\n\t\tscript.code = code;\n\t\tscript.deps = deps;\n\t\tscript.comp = comp;\n\n\t\treturn script;\n\t}\n\n\tthis.loadScript = function(scriptEl, wnd) {\n\t\treturn this.createScript(scriptEl.textContent, scriptEl.getAttribute('name')).load(wnd);\n\t}\n\n\tthis.load = function(wnd) {\n\t\tvar scripts = (wnd ? wnd.document : document).querySelectorAll('script[type=\"text/jsq\"]');\n\t\tfor (var i=0,l=scripts.length; i<l; i++) {\n\t\t\tthis.loadScript(scripts[i], wnd);\n\t\t}\n\t}\n\n}\n\nfunction Script() {\n\tthis.name = null;\n\tthis.code = null;\n\tthis.comp = null;\n\tthis.deps = null;\n\n\tthis.load = function(wnd) {\n\t\tif (!wnd) wnd = window;\n\t\tif (this.name) window[this.name] = this.comp;\n\t\treturn this;\n\t}\n\n/*\n\tthis.resolve = function(path) {\n\t\tif (!this.file) return null;\n\t\tvar parts = this.file.split('/').pop();\n\t\tpath.split('/').forEach(function(part) {\n\t\t\tif (part === '..') {\n\t\t\t\tparts.pop();\n\t\t\t} else if (part !== '.') {\n\t\t\t\tparts.push(part);\n\t\t\t}\n\t\t});\n\t\treturn parts.join('/');\n\t}\n*/\n\n}\n\n\n","import Qute from '@qute/runtime';\n\nvar PRINT_RX = /%s/g;\nfunction print(text) {\n\tvar i = 1, args = arguments;\n\treturn text.replace(PRINT_RX, function(match, p1) {\n\t\treturn args[i++];\n\t});\n}\n\nQute.ERR.resolve = function (code) {\n\tvar text = errors[code];\n\tif (!text) text = \"Qute Error: \"+code;\n\telse {\n\t\tvar args = Array.prototype.slice.call(arguments);\n\t\targs[0] = text;\n\t\ttext = print.apply(null, args);\n\t}\n\tthrow new Error(text);\n}\n\nvar errors = {\n\n\n\t// ------------------------------------------------------\n\t// index.js\n\t/*\n\t1: \"Unsupported tag: '%s'\",\n\t2: \"template 'name' is required\",\n\t*/\n\t// runtime.js\n\t5: \"Usage: Qute(tag[, viewModelDefinition])\",\n\t// list.js\n\t10: \"Broken list fragment. Ignoring updates\",\n\t11: \"Invalid index: '%s'. Length is %s\",\n\t12: \"Invalid insertion index: '%s'. Length is %s'\",\n\t13: \"Remove anchor is invalid: '%s'. Length is %s\",\n\t14: \"Invalid move from index: '%s'. Length is %s\",\n\t15: \"Invalid move to index: '%s'. Length is %s\",\n\t// rendering.js\n\t20: \"Invalid dynamic component. Should be a ViewModel constructor or a xtag name\",\n\t// no more used\n\t//21: \"Found a 'nested' element without a 'name' attribute\",\n\t23: \"Could not resolve ViewModel at runtime for tag: '%s'\",\n\t24: \"dynamic for directive accepts only List instances and not regular arrays\",\n\t25: \"List properties cannot be used with the static for directive\",\n\t26: \"Bug? Unknown xattr name: %s\",\n\t27: \"Unknown converter: %s\",\n\t28: \"x-channel cannot be used on regular DOM elements: %s\",\n\t// update.js\n\t30: \"Possible infinite loop detected\",\n\t// vm.js\n\t31: \"Incompatible assign for list property: %s\",\n\t32: \"No render function defined for the ViewModel!\",\n\t33: \"VM is already mounted!\",\n\t34: \"VM is not mounted!\",\n\t35: \"View not connected\",\n\t36: \"No template found for tag '%s'\",\n\t37: \"Failed to install plugin %s. Plugins must provide an install(ctx) method.\",\n\t38: 'Posting message to unknown topic %s',\n\t39: \"x-channel used on a VM not defining channels: %s\",\n\t//36: \"Cannot unmount a child view\",\n\t// compiler.js\n\t/*\n\t50: \"<tag> requires an 'is' attribute\",\n\t51: \"Invalid for expression\",\n\t52: \"For directive take exatcly one attribute\",\n\t53: \"if has only one required attribute: value='expr' and an optional one: @change='onChangeHandler'\",\n\t54: \"slot node take zero or one 'name' parameter\",\n\t55: \"the root node must have a single children element\",\n\t56: \"Invalid if attribute '%s'\",\n\t57: \"Closing tag '%s' doesn't match the start tag '%s'\",\n\t58: \"Static node (x-html) must have some content\",\n\t*/\n\t// rollup-plugin.js\n\t/*\n\t60: \"Tag not supported: '%s'\",\n\t61: \"The <template> tag requires a name attribute\",\n\t62: \"Unresolved tag: '%s'. Please import the implementation in camel case! Ex: \\nimport '%s' from 'some-module'\",\n\t*/\n\t// xtags-parser.js\n\t/*\n\t70: \"Bug?\",\n\t72: \"Invalid qute file: No closing </'%s'> found.\",\n\t73: \"Invalid qute file: Found closing tag '%s'. Expecting '%s'\",\n\t*/\n\t// binding.js\n\t//80: \"Invalid x-radio expression: '%s'. Must be a tag name with a class. Ex: li.active\"\n};\n\nexport default ERR;\n","import {document} from '@qute/window';\nimport Loader from './loader.js'\nimport ERR from './error-dev.js';\nimport Qute from '@qute/runtime';\nimport Compiler from '@qute/compiler';\n\n\nQute.Compiler = Compiler;\nQute.compile = function(text, symbols) {\n\treturn new Compiler().compileFn(text, symbols);\n}\n\nQute.css('x-tag { display:none; }\\n');\n\nfunction loadXTag(text) {\n\tnew Compiler().loadXTags(text, function(xtagName, xtagFn, isCompiled) {\n\t\tQute.register(xtagName, xtagFn, isCompiled);\n\t});\n}\n// load templates\nQute.load = function(textOrId) {\n\tif (!textOrId) {\n\t\tvar xtags = document.getElementsByTagName('x-tag');\n\t    for (var i=0,l=xtags.length; i<l; i++) {\n\t    \tloadXTag(xtags[i].innerHTML);\n\t    }\n\t} else {\n\t\tloadXTag(textOrId[0] === '#' ? document.getElementById(textOrId.substring(1)).textContent : textOrId);\n\t}\n}\n\nQute.Loader = Loader;\nQute.loadScripts = function() {\n\tnew Loader().load();\n}\nexport default Qute;\n"],"names":["capitalizeFirst","value","toUpperCase","substring","kebabToCamel","i","indexOf","out","s","length","ERR","resolve","apply","arguments","stopEvent","e","preventDefault","stopPropagation","chainFnAfter","fn","prevFn","arg","closestVM","el","__qute__","parentNode","filterKeys","obj","filter","keys","Object","incl","key","Error","Array","prototype","slice","call","UpdateQueue","maxNestedLoops","queue","after","push","op","this","self","window","setTimeout","run","runAfter","runAfterCb","cnt","max","shift","l","Context","data","assign","$topics","lifecycle","post","topic","msg","listeners","postAsync","subscribe","listenerFn","subscribeOnce","event","onceSubscription","unsubscribe","splice","freeze","VMS","XTAGS","getTag","tag","registerTag","templateFn","isCompiled","$compiled","$tag","getVMOrTag","addClassMap","cl","add","remove","createListener","vm","createListeners","$listeners","SetAttr","model","valFn","changedKey","val","getAttribute","removeAttribute","setAttribute","SetInnerHTML","innerHTML","SetDisplay","display","style","__qute_display","SetToggle","attrs","SetClass","elt","classList","isArray","bindClass","SetStyle","bindStyle","SetProp","$set","SetDOMAttrs","$attrs","SetFuncAttrs","vmAttrs","SetFuncAttr","SetVMAttrs","parentVM","parentAttrs","Emitter","emit","$el","dispatchEvent","CustomEvent","bubbles","detail","undefined","emitAsync","timeout","appendChildren","parent","children","appendChild","applyListeners","doNotWrap","addEventListener","extractSlots","namedSlots","nestedCnt","hasContent","child","nodeType","nodeName","slot","slotChildren","node","firstChild","nextSibling","nodeValue","trim","default","RenderingProto","x","expr","text","document","createTextNode","up","SetText","t","g","isFn","xattrs","XTag","v","h","createElement","charCodeAt","hh","content","type","converter","Qute","converters","r","_v","slots","__VM__","isVM","$ctx","$create","oldVm","functx","$bindings","bindings","slotName","defaultChildren","$slots","frag","createDocumentFragment","createComment","w","isExpr","changeCb","noCache","childrenFn","marker","viewFrag","cache","cview","propKey","initialUpdate","viewXTag","$disconnect","removeChild","previousSibling","Rendering","insertBefore","$connect","$update","ViewRenderingContext","_if","_else","start","end","ieFrag","state","newState","IfRenderingContext","listFn","iterationFn","list","$createListFragment","a","forFrag","newList","k","ll","ForRenderingContext","ups","eval","xattr","isc","vms","$push","ctx","$parent","ListFragment","rendering","updateChildren","first","$up","n","clear","get","index","getInsertion","createItem","item","hasNext","insert","from","count","childR","__qute_ctx__","move","to","dstNode","append","AP","ListProto","listRendering","lfs","lf","$data","bind","$updateNow","ops","$redraw","$insert","$remove","$move","toJSON","List","replace","ar","unshift","pop","deleteCount","argsl","len","sort","cmp","reverse","forEach","cb","thisArg","map","find","findIndex","reduce","initialValue","reduceRight","elem","lastIndexOf","isEnumerable","defProp","set","old","watcher","$watch","update","enumerable","listProp","ViewModel","prop","defineProperty","writable","init","render","camelKey","def","BaseVm","ViewModelImpl","VMType","VMProto","create","constructor","dst","src","getOwnPropertyDescriptor","assignPropDefs","$super","template","registerVM","watch","on","selector","$init","thisObj","$on","channel","listenFn","$channel","toString","listen","channelName","setup","setupFn","cleanup","$clean","$root","$st","$r","connected","disconnected","$load","parentRendering","created","mount","elOrId","target","getElementById","body","unmount","wrapper","matches","removeEventListener","name","toHTML","outerHTML","link","renderFn","QUTE_STYLE","splitList","rx","makeSymbols","split","acc","css","doc","id","textContent","head","xtagName","register","snapshotRegistry","restoreRegistry","snapshot","vmOrTemplate","closest","STAG_RX","ETAG_RX","ATTR_RX","voids","else","case","area","base","br","col","embed","hr","img","input","meta","param","source","track","wbr","TAG_RX","TAG_END_RX","ATTR_RX$1","CNT_LINES_RX","getTagName","match","parseAttrs","attrsDecl","lastIndex","m","exec","newLines","join","parseXTags","handler","partText","stag","etag","transpile","compiler","opts","imports","import","compile","handleTemplate","JSON","stringify","handleStyle","removeNewLines","VAR_RX","EXPR_RX","OBJ_RX","ARROW_FN_RX","HTML_TAGS","_s","_key","__x","p1","p2","startsWith","symbols","_x","_xo","c","charAt","_r","_cb","test","arrowFn","open","args","close","bs","be","localSymbols","getArrowFn","_fn","_nodes","_xattrs","directives","events","_events","attrValue","attr","RootNode","lastChild","TextNode","isBlank","DomNode","parseXAttrs","directive","is","isAttr","onChange","fname","pre","xcontent","StaticNode","ListNode","ctype","html","stack","tagName","isVoid","ExprNode","parts","FOR_RX","parseForExpr","listNode","forCtx","forSymbols","_node","ElseNode","MUSTACHE_RX","NODES","if","change","valueAttr","changeAttr","for","process","processor","processSlot","SYMBOLS","true","false","null","$1","console","$","Compiler","collector","top","lastText","pushText","NodeType","parse","handleStartTag","toLowerCase","handleEndTag","comment","next","parseHTML","compileFn","Function","loadXTags","static","IMPORT_RX","EXPORT_RX","Loader","createScript","code","deps","p3","p4","path","warning","hasExport","buble","transform","comp","script","Script","loadScript","scriptEl","wnd","load","scripts","querySelectorAll","PRINT_RX","errors","5","10","11","12","13","14","15","20","23","24","25","26","27","28","30","31","32","33","34","35","36","37","38","39","loadXTag","xtagFn","textOrId","xtags","getElementsByTagName","loadScripts"],"mappings":"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"}