var QuteRouter=function(t,i){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t;var r="default"in i?i.default:i,s=Object.assign?Object.assign:function(t,n){for(var e in n)t[e]=n[e];return t};function a(t,n,e){t.attachEvent?(t["e"+n+e]=e,t[n+e]=function(){t["e"+n+e](r.event)},t.attachEvent("on"+n,t[n+e])):t.addEventListener(n,e,!1)}function n(t,n,e){t.detachEvent?(t.detachEvent("on"+n,t[n+e]),t[n+e]=null):t.removeEventListener(n,e,!1)}var e=function(){this.listeners=[];var t=this,n=this.checkUrl;this.checkUrl=function(){n.apply(t,arguments)},void 0!==r&&(this.location=r.location,this.history=r.history)},o=/^[#\/]|\s+$/g,h=/^\/+|\/+$/g,u=/\/$/,c=/#.*$/;s(e.prototype,{atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root},getHash:function(t){var n=(t||this).location.href.match(/#(.*)$/);return n?n[1]:""},getFragment:function(t,n){if(null==t)if(this._hasPushState||!this._wantsHashChange||n){t=decodeURI(this.location.pathname+this.location.search);var e=this.root.replace(u,"");t.indexOf(e)||(t=t.slice(e.length))}else t=this.getHash();return t.replace(o,"")},start:function(t){this.started=!0,this.options=s({root:"/"},t),this.location=this.options.location||this.location,this.history=this.options.history||this.history,this.root=this.options.root,this._wantsHashChange=!1!==this.options.hashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var n=this.getFragment();this.root=("/"+this.root+"/").replace(h,"/"),this._hasPushState?a(r,"popstate",this.checkUrl):a(r,"hashchange",this.checkUrl),this.fragment=n;var e=this.location;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot())return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+"#"+this.fragment),!0;this._hasPushState&&this.atRoot()&&e.hash&&(this.fragment=this.getHash().replace(o,""),this.history.replaceState({},i.document.title,this.root+this.fragment))}if(!this.options.silent)return this.loadUrl()},stop:function(){n(r,"popstate",this.checkUrl),n(r,"hashchange",this.checkUrl),this.started=!1},checkUrl:function(){if(this.getFragment()===this.fragment)return!1;this.loadUrl()},loadUrl:function(t){t=this.fragment=this.getFragment(t);for(var n=this.listeners,e=0,i=n.length;e<i;e++)n[e](t)},navigate:function(t,n){if(!this.started)return!1;n&&!0!==n||(n={trigger:!!n});var e=this.root+(t=this.getFragment(t||""));if(t=t.replace(c,""),this.fragment!==t){if(""===(this.fragment=t)&&"/"!==e&&(e=e.slice(0,-1)),this._hasPushState)this.history[n.replace?"replaceState":"pushState"]({},i.document.title,e);else{if(!this._wantsHashChange)return this.location.assign(e);this._updateHash(this.location,t,n.replace)}return n.trigger?this.loadUrl(t):void 0}},_updateHash:function(t,n,e){if(e){var i=t.href.replace(/(javascript:|#).*$/,"");t.replace(i+"#"+n)}else t.hash="#"+n}}),e.prototype.update=function(){this.navigate.apply(this,arguments)},e.prototype.onChange=function(t){this.listeners.push(t)},e.prototype.hasPushState=function(){if(!this.started)throw new Error("only available after LocationBar.start()");return this._hasPushState};var f=/\$\{([a-zA-Z_$][a-zA-Z_0-9$]*)\}/g;function l(t){return 47!==t.charCodeAt(0)?"/"+t:t}var g=/<([^>:]*)(?:\:([^>]*))?>/;function p(e){return function(t,n){return t===e}}function d(){return!0}function v(t,n){function u(t,n){if(t.length===n+1||47===t.charCodeAt(n+1))switch(t.charCodeAt(n)){case 63:return 1;case 42:return 2;case 43:return 3}return 0}this.pattern=l(t),this.match=function(t){if("/*"===t)return d;if(-1===t.indexOf("<"))return p(t);var n=g.exec(t);if(!n)return p(t);for(var e="",i=[];n;){var r=0<n.index?t.substring(0,n.index).replace(/\.\(\)\$\^\[\]\?\*\+/g,"\\$1"):null,s=n.index+n[0].length,a=n[2]||"[^/]+",o=(t.charCodeAt(s),u(t,s));if(o){if(!r||47!==r.charCodeAt(r.length-1))throw new Error("Modifier +, * and ? can be used only on named path segments: "+t);r=r.substring(0,r.length-1),s++,1===o?a="((?:/"+a+")?)":2===o?a="((?:/"+a+")*)":3===o&&(a="((?:/"+a+")+)")}else a="("+a+")";i.push({name:n[1].trim(),mod:o}),e+=r?r+a:a,t=t.substring(s),n=g.exec(t)}t.length&&(e+=t.replace(/\.\(\)\$\^\[\]\?\*\+/g,"\\$1"));var h=function(o,h){return function(t,n){var e=o.exec(t);if(e){for(var i=1,r=e.length;i<r;i++){var s=h[i-1];if(s){var a=e[i];a&&(s.mod&&47===a.charCodeAt(0)&&(a=a.substring(1)),n[s.name]=a)}}return!0}return!1}}(new RegExp(e),i);return h.$vars=i.length,h}(this.pattern),this.vars=this.match.$vars||0,this.value=n}function m(t){this.bindings=[],t&&this.map(t)}function w(t){this.navigo=new e,this.routes=new m,this.redirects={},t&&this.map(t)}function y(t,n){w.call(this,t),this.ctx=null,n&&this.install(n)}d.$vars=1e5,m.prototype={add:function(t,n){this.bindings.push(new v(t,n))},map:function(n){if(n){var e=this;Object.keys(n).forEach(function(t){e.add(t,n[t])}),this.sort()}},sort:function(){this.bindings.sort(function(t,n){var e=t.vars-n.vars;return e||n.pattern.localeCompare(t.pattern)})},get:function(t){t=l(t);for(var n={},e=this.bindings,i=0,r=e.length;i<r;i++){var s=e[i];if(s.match(t,n))return[s.value,n]}return null}},w.prototype={handlerFromString:function(t){return null},createRedirect:function(t,e){e=l(e),this.redirects[t]=e,function(t,n){var e={};e[n]=!0;for(var i=t[n];i;){if(e[i])throw new Error("Found a redirection cycle: ["+n+"] -> ["+i+"]");e[i]=!0,i=t[i]}}(this.redirects);var i=this;return function(t,n){i.navigate(function(t,i){return t.replace(f,function(t,n){var e=i[n];return void 0===e?t:String(e)})}(e,n),!0)}},map:function(n){if(n){var e=this;Object.keys(n).forEach(function(t){e.add(t,n[t])})}return this},add:function(t,n){t=l(t);var e=null;return"string"==typeof n&&((e=this.handlerFromString(t,n))||(e=this.createRedirect(t,n))),e||(e=n),this.routes.add(t,e),this},start:function(t){if(!this.routes.bindings.length)throw new Error("No routes set!");this.routes.sort();var e=this;this.navigo.onChange(function(t){var n=e.routes.get(t);if(!n)throw new Error('No route found for "'+t+'"');n[0](t,n[1])});var n=function(){e.navigo.start(t),r.removeEventListener("load",n)};return r.addEventListener("load",n),this},stop:function(){this.navigo.stop()},navigate:function(t,n){t=l(t),this.navigo.hasPushState()||(t="#"+t),this.navigo.navigate(t,n?{replace:!0}:void 0)},route:function(t,n){this.navigate(t,n)},onChange:function(n){this.navigo.onChange(function(t){n(l(t))})},path:function(){return l(this.navigo.getFragment())}};var b=Object.create(w.prototype);return b.handlerFromString=function(t,n){if("post:"!==n.substring(0,5))return null;if(!this.ctx)throw new Error('Using "post:" protocol without a Qute context!');var e=n.substring(5),i=e.indexOf("/");if(-1===i)throw new Error('Invalid message post target. Expecting "post:channel/message-name" but got '+n);var r=e.substring(i+1),s=e.substring(0,i),a=this.ctx;return function(t,n){a.postAsync(expandVars(s,n),expandVars(r,n),n)}},b.install=function(e){if(this.ctx)throw new Error("Qute Router already installed!");return e.$ctx&&(e=e.$ctx),(this.ctx=e).router=this,e.subscribe("route",function(t,n){e.router.navigate(t,n)}),this},y.prototype=b,t.Router=y}(Qute,window);
//# sourceMappingURL=qute-router-0.9.0.min.js.map
