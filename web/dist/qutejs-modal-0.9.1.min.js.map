{"version":3,"file":"qutejs-modal-0.9.1.min.js","sources":["../../components/modal/src/modal.js","../../components/modal/src/index.jsq"],"sourcesContent":["import {document} from '@qutejs/window';\n\n/*\n@see https://tympanus.net/codrops/2013/06/25/nifty-modal-window-effects/ for modal effects\n@see https://davidwalsh.name/css-vertical-center for vertical centering using translate\n*/\n\nfunction toggleScroll(enable) {\n\tvar body = document.body;\n\tif (enable) {\n        Object.assign(body.style, {overflow: 'initial', height: 'initial'})\n\t} else {\n        Object.assign(body.style, {overflow: 'hidden', height: '100vh'})\n\t}\n}\n\nfunction getFocusableElements(root) {\n\treturn (root || document).querySelectorAll('button, a[href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])');\n}\n\nfunction trapFocus() {\n\tvar focusable = getFocusableElements(modal);\n\tvar firstFocusable, lastFocusable;\n\tif (focusable.length) {\n\t\tfirstFocusable = focusable[0];\n\t\tlastFocusable = focusable[focusable.length-1];\n\t}\n\n}\n\nfunction createModal(id, content, effect) {\n\tvar container = document.createElement('DIV');\n\tcontainer.id = id;\n\tvar modal = document.createElement('DIV');\n\tmodal.className = effect ? 'md-modal md-effect-'+effect : 'md-modal';\n\tmodal.tabIndex = -1;\n\tvar contentEl = document.createElement('DIV');\n\tcontentEl.className = 'md-content';\n\tmodal.appendChild(contentEl);\n\tvar overlay = document.createElement('DIV');\n\toverlay.className = 'md-overlay';\n\tcontainer.appendChild(modal);\n\tcontainer.appendChild(overlay);\n\n\tif (content.jquery) {\n\t\tcontentEl.appendChild(content[0]);\n\t} else if (typeof content === 'string') {\n\t\tcontentEl.innerHTML = content;\n\t} else if (Array.isArray(content)) {\n\t\tfor (var i=0, l=content.length; i<l; i++) {\n\t\t\tcontentEl.appendChild(content[i]);\n\t\t}\n\t} else { // assume a element\n\t\tcontentEl.appendChild(content);\n\t}\n\n\treturn container;\n}\n\n\nexport default function Modal(name, content, settings) {\n\tthis.id = '--qute-modal-'+name;\n\tthis.settings = {\n\t\teffect: null,\n\t\tcloseOnEsc: true,\n\t\tcloseOnClick: true,\n\t\tdisableScroll: true\n\t}\n\tif (settings) {\n\t\tObject.assign(this.settings, settings);\n\t}\n\tthis.el = createModal(this.id, content, settings.effect);\n\tthis.activeElement = null;\n\tthis.cleanup = null;\n}\nModal.prototype = {\n\topen: function() {\n\t\tvar modal = this.el.firstChild;\n\t\tvar cl = modal.classList;\n\t\tif (cl.contains('md-show')) return; // already visible\n\n\t\tvar self = this;\n\t\tvar settings = this.settings;\n\t\tsettings.open && settings.open(this);\n\n\t\tcl.add('md-show');\n\t\t// 0. save focus status\n\t\tthis.activeElement = document.activeElement; // save the active element before opening\n\t\t// 1. disable scroll\n\t\tif (settings.disableScroll) toggleScroll(false);\n\t\t// 2. add click listener to handle close and other actions\n\t\tthis.addListener(this.el, 'click', function(e) {\n\t\t\tvar handled = false, target = e.target;\n\t\t\tif ((target === self.el.lastChild && settings.closeOnClick) || target.classList.contains('md-close')) {\n\t\t\t\t// click on overlay or .md-close\n\t\t\t\tself.close();\n\t\t\t\thandled = true;\n\t\t\t} else if (settings.action) {\n\t\t\t\tvar action = target.getAttribute('data-md-action');\n\t\t\t\tif (action === 'close') {\n\t\t\t\t\tself.close();\n\t\t\t\t\thandled = true;\n\t\t\t\t} else if (action) {\n\t\t\t\t\tsettings.action(action, target);\n\t\t\t\t\thandled = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (handled) {\n\t\t\t\te.preventDefault();\n\t\t\t\te.stopPropagation();\n\t\t\t}\n\t\t});\n\t\t//3. add keydown listener to trap focus inside the modal and to handle close on escape\n\t\tvar focusable = getFocusableElements(modal);\n\t\tvar firstFocusable, lastFocusable;\n\t\tif (focusable.length) {\n\t\t\tfirstFocusable = focusable[0];\n\t\t\tlastFocusable = focusable[focusable.length-1];\n\t\t}\n\t\tthis.addListener(modal, 'keydown', function(e) {\n\t\t\tif (e.keyCode === 27) {\n\t\t\t\tself.settings.closeOnEsc && self.close();\n\t\t\t} else if (firstFocusable && e.keyCode === 9) {\n\t\t\t\tvar toFocus, focus = document.activeElement;\n\t\t\t\tif (e.shiftKey) {\n\t\t\t\t\tif (firstFocusable === focus) {\n\t\t\t\t\t\ttoFocus = lastFocusable;\n\t\t\t\t\t}\n\t\t\t\t} else if (lastFocusable === focus) {\n\t\t\t\t\ttoFocus = firstFocusable;\n\t\t\t\t}\n\t\t\t\tif (toFocus) {\n\t\t\t\t\ttoFocus.focus();\n\t\t\t\t\te.preventDefault();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t// acquire focus - set focus on .md-focus marked element otherwise on the modal itself\n\t\tvar toFocus = modal.getElementsByClassName('md-focus')[0] || modal;\n\t\tfunction acquireFocus() {\n\t\t\ttoFocus.focus();\n\t\t\tsettings.ready && settings.ready(this);\n\t\t}\n\t\tif (settings.effect) {\n\t\t\tvar transitionEnd = function() {\n\t\t\t\tacquireFocus();\n\t\t\t\tmodal.firstChild.removeEventListener('transitionend', transitionEnd);\n\t\t\t}\n\t\t\tmodal.firstChild.addEventListener('transitionend', transitionEnd);\n\t\t} else {\n\t\t\tacquireFocus();\n\t\t}\n\t},\n\tclose: function() {\n\t\tthis.el.firstChild.classList.remove('md-show');\n\t\tthis.settings.close && this.settings.close(this);\n\t\tif (this.settings.disableScroll) toggleScroll(true);\n\t\tif (this.activeElement) this.activeElement.focus();\n\t\tthis.activeElement = null;\n\t\tif (this.cleanup) {\n\t\t\tthis.cleanup();\n\t\t\tthis.cleanup = null;\n\t\t}\n\t},\n\taddListener: function(el, name, fn) {\n\t\tel.addEventListener(name, fn);\n\t\tvar nextCleanup = this.cleanup;\n\t\tthis.cleanup = function() {\n\t\t\tel.removeEventListener(name, fn);\n\t\t\tnextCleanup && nextCleanup();\n\t\t}\n\t},\n\t// dinamically change the effect\n\teffect: function(effect) {\n\t\tthis.settings.effect = effect;\n\t\tif (this.el) {\n\t\t\tthis.el.firstChild.className = effect ? 'md-modal md-effect-'+effect : 'md-modal';\n\t\t}\n\t}\n\n}\n","\nimport Qute from '@qutejs/runtime';\nimport Modal from './modal.js';\nimport css from './modal.css';\n\nQute.css(css);\n\nvar modal_id = 0;\n\n/**\n */\nexport default Qute(\"modal\", {\n\tinit: function() {\n\t\treturn {\n\t\t\tanimation: null,\n\t\t\tcloseOnEsc: true,\n\t\t\tcloseOnClick: true,\n\t\t\tdisableScroll: true\n\t\t };\n\t},\n\trender: function() {\n\t\treturn document.createComment('[modal]');\n\t},\n\tcreated: function() {\n\t\tvar slots = this.$slots;\n\t\tif (!slots || !slots.default) throw new Error('<modal> requires a content!');\n\n\t\tvar self = this;\n\t\tthis.modal = new Modal('qute-modal-'+(modal_id++), slots.default, {\n\t\t\teffect: this.animation,\n\t\t\tcloseOnEsc:this.closeOnEsc,\n\t\t\tcloseOnClick: this.closeOnClick,\n\t\t\tdisableScroll: this.disableScroll,\n\t\t\topen: function(modal) {\n\t\t\t\tself.emit(\"open\", self.modal.el);\n\t\t\t},\n\t\t\tclose: function(modal) {\n\t\t\t\tself.emit(\"close\", self.modal.el);\n\t\t\t},\n\t\t\tready: function(modal) {\n\t\t\t\tself.emit(\"ready\", self.modal.el);\n\t\t\t},\n\t\t\taction: function(action, target) {\n\t\t\t\tself.emit(\"action\", {modal: self.modal.el, name: action, target: target});\n\t\t\t}\n\t\t});\n\t},\n\tconnected: function() {\n\t\tdocument.body.appendChild(this.modal.el);\n\t},\n\tdisconnected: function() {\n\t\tdocument.body.removeChild(this.modal.el);\n\t},\n\topen: function() {\n\t\tthis.modal.open();\n\t},\n\tclose: function() {\n\t\tthis.modal.close();\n\t}\n}).channel(function(msg) {\n\tif (msg === 'open') {\n\t\tthis.open();\n\t} else if (msg === 'close') {\n\t\tthis.close();\n\t}\n}).watch('animation', function(value) {\n\tthis.modal.effect(value);\n\treturn false;\n}).watch('closeOnEsc', function(value) {\n\tthis.modal.settings.closeOnEsc = !!value;\n\treturn false;\n}).watch('closeOnClick', function(value) {\n\tthis.modal.settings.closeOnClick = !!value;\n\treturn false;\n}).watch('disableScroll', function(value) {\n\tthis.modal.settings.disableScroll = !!value;\n\treturn false;\n});\n\n"],"names":["toggleScroll","enable","body","document","Object","assign","style","overflow","height","Modal","name","content","settings","this","id","effect","closeOnEsc","closeOnClick","disableScroll","el","container","createElement","modal","className","tabIndex","contentEl","appendChild","overlay","jquery","innerHTML","Array","isArray","i","l","length","createModal","activeElement","cleanup","prototype","open","firstChild","cl","classList","contains","self","add","addListener","e","handled","target","lastChild","close","action","getAttribute","preventDefault","stopPropagation","firstFocusable","lastFocusable","focusable","querySelectorAll","keyCode","toFocus","focus","shiftKey","getElementsByClassName","transitionEnd","acquireFocus","removeEventListener","addEventListener","ready","remove","fn","nextCleanup","Qute","css","modal_id","init","animation","render","createComment","created","slots","$slots","default","Error","emit","connected","disconnected","removeChild","channel","msg","watch","value"],"mappings":"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"}