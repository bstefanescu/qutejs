{"version":3,"file":"qute-router-0.9.0.min.js","sources":["../../plugins/router/src/location-bar.js","../../plugins/router/src/utils.js","../../plugins/router/src/path-mapping.js","../../plugins/router/src/router.js","../../plugins/router/src/index.js"],"sourcesContent":["import window, {document} from '@qute/window';\n\n/*\n* Extracted from Backbone.js History 1.1.0\n*/\n\n//helper functions\nvar objectAssign = Object.assign ? Object.assign : function extend(obj, source) {\n  for (var prop in source) {\n    obj[prop] = source[prop];\n  }\n  return obj;\n}\nfunction on(obj, type, fn) {\n  if (obj.attachEvent) {\n    obj['e'+type+fn] = fn;\n    obj[type+fn] = function(){ obj['e'+type+fn]( window.event ); };\n    obj.attachEvent( 'on'+type, obj[type+fn] );\n  } else {\n    obj.addEventListener( type, fn, false );\n  }\n}\nfunction off(obj, type, fn) {\n  if (obj.detachEvent) {\n    obj.detachEvent('on'+type, obj[type+fn]);\n    obj[type+fn] = null;\n  } else {\n    obj.removeEventListener(type, fn, false);\n  }\n}\n\n// handlers were removed - we simply use listeners without regex matching\n//\n// Backbone.History\n// ----------------\n\n// Handles cross-browser history management, based on either\n// [pushState](http://diveintohtml5.info/history.html) and real URLs, or\n// [onhashchange](https://developer.mozilla.org/en-US/docs/DOM/window.onhashchange)\n// and URL fragments.\nvar History = function() {\n  this.listeners = [];\n\n  var self = this;\n  var checkUrl = this.checkUrl;\n  this.checkUrl = function () {\n    checkUrl.apply(self, arguments);\n  };\n\n  // Ensure that `History` can be used outside of the browser.\n  if (typeof window !== 'undefined') {\n    this.location = window.location;\n    this.history = window.history;\n  }\n};\n\n// Cached regex for stripping a leading hash/slash and trailing space.\nvar routeStripper = /^[#\\/]|\\s+$/g;\n\n// Cached regex for stripping leading and trailing slashes.\nvar rootStripper = /^\\/+|\\/+$/g;\n\n// Cached regex for removing a trailing slash.\nvar trailingSlash = /\\/$/;\n\n// Cached regex for stripping urls of hash.\nvar pathStripper = /#.*$/;\n\n// MODIFICATION OF ORIGINAL BACKBONE.HISTORY\n// Has the history handling already been started?\n// History.started = false;\n\n// Set up all inheritable **Backbone.History** properties and methods.\nobjectAssign(History.prototype, {\n\n  // Are we at the app root?\n  atRoot: function() {\n    return this.location.pathname.replace(/[^\\/]$/, '$&/') === this.root;\n  },\n\n  // Gets the true hash value. Cannot use location.hash directly due to bug\n  // in Firefox where location.hash will always be decoded.\n  getHash: function(window) {\n    var match = (window || this).location.href.match(/#(.*)$/);\n    return match ? match[1] : '';\n  },\n\n  // Get the cross-browser normalized URL fragment, either from the URL,\n  // the hash, or the override.\n  getFragment: function(fragment, forcePushState) {\n    if (fragment == null) {\n      if (this._hasPushState || !this._wantsHashChange || forcePushState) {\n        fragment = decodeURI(this.location.pathname + this.location.search);\n        var root = this.root.replace(trailingSlash, '');\n        if (!fragment.indexOf(root)) fragment = fragment.slice(root.length);\n      } else {\n        fragment = this.getHash();\n      }\n    }\n    return fragment.replace(routeStripper, '');\n  },\n\n  // Start the hash change handling, returning `true` if the current URL matches\n  // an existing route, and `false` otherwise.\n  start: function(options) {\n    // MODIFICATION OF ORIGINAL BACKBONE.HISTORY\n    // if (History.started) throw new Error(\"LocationBar has already been started\");\n    // History.started = true;\n    this.started = true;\n\n    // Figure out the initial configuration.\n    // Is pushState desired ... is it available?\n    this.options          = objectAssign({root: '/'}, options);\n    this.location         = this.options.location || this.location;\n    this.history          = this.options.history || this.history;\n    this.root             = this.options.root;\n    this._wantsHashChange = this.options.hashChange !== false;\n    this._wantsPushState  = !!this.options.pushState;\n    this._hasPushState    = !!(this.options.pushState && this.history && this.history.pushState);\n    var fragment          = this.getFragment();\n\n    // Normalize root to always include a leading and trailing slash.\n    this.root = ('/' + this.root + '/').replace(rootStripper, '/');\n\n    // Depending on whether we're using pushState or hashes, and whether\n    // 'onhashchange' is supported, determine how we check the URL state.\n    if (this._hasPushState) {\n      on(window, 'popstate', this.checkUrl);\n    } else {\n      on(window, 'hashchange', this.checkUrl);\n    }\n\n    // Determine if we need to change the base url, for a pushState link\n    // opened by a non-pushState browser.\n    this.fragment = fragment;\n    var loc = this.location;\n\n    // Transition from hashChange to pushState or vice versa if both are\n    // requested.\n    if (this._wantsHashChange && this._wantsPushState) {\n\n      // If we've started off with a route from a `pushState`-enabled\n      // browser, but we're currently in a browser that doesn't support it...\n      if (!this._hasPushState && !this.atRoot()) {\n        this.fragment = this.getFragment(null, true);\n        this.location.replace(this.root + '#' + this.fragment);\n        // Return immediately as browser will do redirect to new url\n        return true;\n\n      // Or if we've started out with a hash-based route, but we're currently\n      // in a browser where it could be `pushState`-based instead...\n      } else if (this._hasPushState && this.atRoot() && loc.hash) {\n        this.fragment = this.getHash().replace(routeStripper, '');\n        this.history.replaceState({}, document.title, this.root + this.fragment);\n      }\n\n    }\n\n    if (!this.options.silent) return this.loadUrl();\n  },\n\n  // Disable Backbone.history, perhaps temporarily. Not useful in a real app,\n  // but possibly useful for unit testing Routers.\n  stop: function() {\n    off(window, 'popstate', this.checkUrl);\n    off(window, 'hashchange', this.checkUrl);\n    this.started = false;\n  },\n\n\n  // Checks the current URL to see if it has changed, and if it has,\n  // calls `loadUrl`.\n  checkUrl: function() {\n    var current = this.getFragment();\n    if (current === this.fragment) return false;\n    this.loadUrl();\n  },\n\n  // Attempt to load the current URL fragment. If a route succeeds with a\n  // match, returns `true`. If no defined routes matches the fragment,\n  // returns `false`.\n  loadUrl: function(fragment) {\n    fragment = this.fragment = this.getFragment(fragment);\n    var listeners = this.listeners;\n    for (var i=0,l=listeners.length; i<l; i++) {\n      listeners[i](fragment);\n    }\n  },\n\n  // Save a fragment into the hash history, or replace the URL state if the\n  // 'replace' option is passed. You are responsible for properly URL-encoding\n  // the fragment in advance.\n  //\n  // The options object can contain `trigger: true` if you wish to have the\n  // route callback be fired (not usually desirable), or `replace: true`, if\n  // you wish to modify the current URL without adding an entry to the history.\n  navigate: function(fragment, options) {\n    if (!this.started) return false;\n    if (!options || options === true) options = {trigger: !!options};\n\n    var url = this.root + (fragment = this.getFragment(fragment || ''));\n\n    // Strip the hash for matching.\n    fragment = fragment.replace(pathStripper, '');\n\n    if (this.fragment === fragment) return;\n    this.fragment = fragment;\n\n    // Don't include a trailing slash on the root.\n    if (fragment === '' && url !== '/') url = url.slice(0, -1);\n\n    // If pushState is available, we use it to set the fragment as a real URL.\n    if (this._hasPushState) {\n      this.history[options.replace ? 'replaceState' : 'pushState']({}, document.title, url);\n\n    // If hash changes haven't been explicitly disabled, update the hash\n    // fragment to store history.\n    } else if (this._wantsHashChange) {\n      this._updateHash(this.location, fragment, options.replace);\n    // If you've told us that you explicitly don't want fallback hashchange-\n    // based history, then `navigate` becomes a page refresh.\n    } else {\n      return this.location.assign(url);\n    }\n    if (options.trigger) return this.loadUrl(fragment);\n  },\n\n  // Update the hash location, either replacing the current entry, or adding\n  // a new one to the browser history.\n  _updateHash: function(location, fragment, replace) {\n    if (replace) {\n      var href = location.href.replace(/(javascript:|#).*$/, '');\n      location.replace(href + '#' + fragment);\n    } else {\n      // Some browsers require that `hash` contains a leading #.\n      location.hash = '#' + fragment;\n    }\n  }\n\n});\n\n\n\n// add some features to History\n\n// a more intuitive alias for navigate\nHistory.prototype.update = function () {\n  this.navigate.apply(this, arguments);\n};\n\n// a generic callback for any changes\nHistory.prototype.onChange = function (callback) {\n  this.listeners.push(callback);\n};\n\n// checks if the browser has pushstate support\nHistory.prototype.hasPushState = function () {\n  // MODIFICATION OF ORIGINAL BACKBONE.HISTORY\n  if (!this.started) {\n    throw new Error(\"only available after LocationBar.start()\");\n  }\n  return this._hasPushState;\n};\n\nexport default History;\n\n","\nvar VARS_RX = /\\$\\{([a-zA-Z_$][a-zA-Z_0-9$]*)\\}/g;\n\nfunction expandVars(text, vars) {\n\treturn text.replace(VARS_RX, function(m, p1) {\n\t\tvar val = vars[p1];\n\t\treturn val === undefined ? m : String(val);\n\t})\n}\n\nfunction absPath(path) {\n\treturn path.charCodeAt(0) !== 47 ? '/'+path : path;\n}\n\nexport { absPath, expandVars };\n","import {absPath} from \"./utils.js\";\n\n\nvar VARS_RX = /<([^>:]*)(?:\\:([^>]*))?>/;\n\nfunction RxMatcher(rx, vars) {\n\treturn function(segment, params) {\n\t\tvar m = rx.exec(segment);\n\t\tif (m) {\n\t\t\tfor (var i=1, l=m.length; i<l; i++) {\n\t\t\t\tvar v = vars[i-1];\n\t\t\t\tif (v) {\n\t\t\t\t\tvar param = m[i];\n\t\t\t\t\tif (param) {\n\t\t\t\t\t\tif (v.mod) { // remove leading / if any\n\t\t\t\t\t\t\tif (param.charCodeAt(0) === 47) {\n\t\t\t\t\t\t\t\tparam = param.substring(1);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tparams[v.name] = param;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n}\n\nfunction TextMatcher(text) {\n\treturn function(segment, params) {\n\t\treturn segment === text;\n\t}\n}\n\nfunction ANY() { return true; }\nANY.$vars = 100000; // should be the last when sorting\n\nfunction PathBinding(pattern, value) {\n\n\tfunction isModifier(path, index) {\n\t\tif (path.length === index+1 || path.charCodeAt(index+1) === 47) { // next is / or end of path\n\t\t\tswitch (path.charCodeAt(index)) {\n\t\t\t\tcase 63: return 1; // ?\n\t\t\t\tcase 42: return 2; // *\n\t\t\t\tcase 43: return 3; // +\n\t\t\t}\n\t\t}\n\t\treturn 0;\n\t}\n\n\tfunction compilePath(path) {\n\t\tif (path === '/*') return ANY;\n\t\tvar i = path.indexOf('<');\n\t\tif (i === -1) return TextMatcher(path);\n\n\t\tvar m = VARS_RX.exec(path);\n\n\t\tif (!m) return TextMatcher(path);\n\n\t\tvar out = '', vars = [];\n\t\twhile (m) {\n\t\t\tvar prefix = m.index > 0 ? path.substring(0, m.index).replace(/\\.\\(\\)\\$\\^\\[\\]\\?\\*\\+/g, '\\\\$1') : null;\n\t\t\tvar nextIndex = m.index+m[0].length, rx = m[2] || '[^/]+';\n\t\t\tvar nextCh = path.charCodeAt(nextIndex);\n\t\t\tvar mod = isModifier(path, nextIndex);\n\t\t\t// if next chars are +/, */, ?/ or +, *, ?\n\t\t\tif (mod) { // ?+* modifier is present\n\t\t\t\tif (prefix && prefix.charCodeAt(prefix.length-1) === 47) {\n\t\t\t\t\t// remove trailing / since it will be included in the rx\n\t\t\t\t\tprefix = prefix.substring(0, prefix.length-1);\n\t\t\t\t} else {\n\t\t\t\t\tthrow new Error('Modifier +, * and ? can be used only on named path segments: '+path);\n\t\t\t\t}\n\t\t\t\t// remove modifier char from path\n\t\t\t\tnextIndex++;\n\t\t\t\tif (mod === 1) {\n\t\t\t\t\trx = '((?:/'+rx+')?)';\n\t\t\t\t} else if (mod === 2) {\n\t\t\t\t\trx = '((?:/'+rx+')*)';\n\t\t\t\t} else if (mod === 3) {\n\t\t\t\t\trx = '((?:/'+rx+')+)';\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\trx = '('+rx+')';\n\t\t\t}\n\t\t\tvars.push({name: m[1].trim(), mod: mod});\n\t\t\tout += prefix ? prefix+rx : rx;\n\t\t\tpath = path.substring(nextIndex);\n\t\t\tm = VARS_RX.exec(path);\n\t\t}\n\t\tif (path.length) {\n\t\t\tout += path.replace(/\\.\\(\\)\\$\\^\\[\\]\\?\\*\\+/g, '\\\\$1');\n\t\t}\n\t\tvar matcher = RxMatcher(new RegExp(out), vars);\n\t\tmatcher.$vars = vars.length;\n\t\treturn matcher;\n\t}\n\n\tthis.pattern = absPath(pattern);\n\tthis.match = compilePath(this.pattern);\n\tthis.vars = this.match.$vars || 0; // how many vars in pattern\n\tthis.value = value;\n}\n\nfunction PathMapping(bindings) {\n\tthis.bindings = [];\n\tbindings && this.map(bindings);\n}\n\nPathMapping.prototype = {\n\tadd: function(path, value) {\n\t\tthis.bindings.push(new PathBinding(path, value));\n\t},\n\tmap: function(bindings) {\n\t\tif (bindings) {\n\t\t\tvar self = this;\n\t\t\tObject.keys(bindings).forEach(function(key) {\n\t\t\t\tself.add(key, bindings[key]);\n\t\t\t});\n\t\t\t// sort bindings\n\t\t\tthis.sort();\n\t\t}\n\t},\n\tsort: function() {\n\t\tthis.bindings.sort(function(a, b) {\n\t\t\tvar r = a.vars - b.vars;\n\t\t\treturn r ? r : b.pattern.localeCompare(a.pattern);\n\t\t});\n\t},\n\tget: function(path) {\n\t\tpath = absPath(path);\n\t\tvar params = {};\n\t\tvar bindings = this.bindings;\n\t\tfor (var i=0,l=bindings.length; i<l; i++) {\n\t\t\tvar binding = bindings[i];\n\t\t\tif (binding.match(path, params)) {\n\t\t\t\treturn [binding.value, params];\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n}\n\nexport default PathMapping;\n\n\n","import window from '@qute/window';\n\nimport LocationBar from \"./location-bar.js\";\nimport PathMapping from \"./path-mapping.js\";\nimport {absPath, expandVars} from \"./utils.js\";\n\nfunction detectCycles(redirects, from) {\n\tvar visited = {};\n\tvisited[from] = true;\n\tvar to = redirects[from];\n\twhile (to) {\n\t\tif (visited[to]) throw new Error('Found a redirection cycle: ['+from+\"] -> [\"+to+\"]\");\n\t\tvisited[to] = true;\n\t\tto = redirects[to];\n\t}\n}\n\nfunction Router(bindings) {\n\n\tthis.navigo = new LocationBar();\n\tthis.routes = new PathMapping();\n\tthis.redirects = {};\n\n\tbindings && this.map(bindings);\n}\n\nRouter.prototype = {\n\thandlerFromString: function(to) {\n\t\treturn null;\n\t},\n\tcreateRedirect: function(path, to) {\n\t\tto = absPath(to);\n\t\tthis.redirects[path] = to;\n\t\tdetectCycles(this.redirects);\n\t\tvar self = this;\n\t\treturn function(path, params) {\n\t\t\tself.navigate(expandVars(to, params), true); // replace the existing entry\n\t\t}\n\t},\n\tmap: function(bindings) {\n\t\tif (bindings) {\n\t\t\tvar self = this;\n\t\t\tObject.keys(bindings).forEach(function(key) {\n\t\t\t\tself.add(key, bindings[key]);\n\t\t\t});\n\t\t}\n\t\treturn this;\n\t},\n\tadd: function(path, to) {\n\t\tpath = absPath(path);\n\t\tvar handler = null;\n\t\tif (typeof to === 'string') {\n\t\t\tvar self = this;\n\t\t\thandler = this.handlerFromString(path, to);\n\t\t\tif (!handler) { // a redirect?\n\t\t\t\thandler = this.createRedirect(path, to);\n\t\t\t}\n\t\t}\n\t\tif (!handler) {\n\t\t\thandler = to;\n\t\t}\n\t\tthis.routes.add(path, handler);\n\t\treturn this;\n\t},\n\tstart: function(settings) {\n\t\tif (!this.routes.bindings.length) throw new Error('No routes set!');\n\t\tthis.routes.sort();\n\n\t\tvar self = this;\n\t\tthis.navigo.onChange(function(path) {\n\t\t\tvar r = self.routes.get(path);\n\t\t\tif (r) {\n\t\t\t\tr[0](path, r[1]);\n\t\t\t} else {\n\t\t\t\tthrow new Error('No route found for \"'+path+'\"');\n\t\t\t}\n\t\t});\n\t\tvar loadCb = function() {\n\t\t\tself.navigo.start(settings);\n\t\t\twindow.removeEventListener('load', loadCb);\n\t\t};\n\t\twindow.addEventListener('load', loadCb);\n\t\treturn this;\n\t},\n\tstop: function() {\n\t\tthis.navigo.stop();\n\t},\n\tnavigate: function(path, replace) {\n\t\tpath = absPath(path);\n\t\tif (!this.navigo.hasPushState()) {\n\t\t\tpath = '#'+path;\n\t\t}\n\t\tthis.navigo.navigate(path, replace ? {replace:true} : undefined);\n\t},\n\troute: function(path, replace) { // an alias to navigate\n\t\tthis.navigate(path, replace);\n\t},\n\tonChange: function(callback) {\n\t\tthis.navigo.onChange(function(path) {\n\t\t\tcallback(absPath(path));\n\t\t});\n\t},\n\tpath: function() {\n\t\treturn absPath(this.navigo.getFragment());\n\t}\n}\n\nexport default Router;\n","import Qute from '@qute/runtime';\nimport Router from './router.js';\n\nfunction QuteRouter(bindings, quteCtx) {\n\tRouter.call(this, bindings);\n\tthis.ctx = null;\n\tquteCtx && this.install(quteCtx);\n}\n\nvar QuteRouterProto = Object.create(Router.prototype);\nQuteRouterProto.handlerFromString = function(path, to) {\n\tif (to.substring(0, 5) === 'post:') {\n\t\tif (!this.ctx) throw new Error('Using \"post:\" protocol without a Qute context!');\n\t\tvar target = to.substring(5);\n\t\tvar i = target.indexOf('/');\n\t\tif (i === -1) throw new Error('Invalid message post target. Expecting \"post:channel/message-name\" but got '+to);\n\t\tvar msg = target.substring(i+1);\n\t\tvar channel = target.substring(0,  i);\n\t\tvar ctx = this.ctx;\n\t\treturn function(path, params) {\n\t\t\tctx.postAsync(expandVars(channel, params), expandVars(msg, params), params);\n\t\t}\n\t}\n\treturn null;\n};\nQuteRouterProto.install = function(ctx) {\n\tif (this.ctx) throw new Error('Qute Router already installed!');\n\tif (ctx.$ctx) ctx = ctx.$ctx; // accept Qute components too.\n\tthis.ctx = ctx;\n\tctx.router = this;\n\tctx.subscribe('route', function(msg, data) {\n\t\t// data can be 'true' to replace the current entry in history\n\t\tctx.router.navigate(msg, data);\n\t});\n\treturn this;\n};\n\nQuteRouter.prototype = QuteRouterProto;\n\nQute.Router = QuteRouter;\n\nexport default QuteRouter;\n"],"names":["objectAssign","Object","assign","obj","source","prop","on","type","fn","attachEvent","window","event","addEventListener","off","detachEvent","removeEventListener","History","this","listeners","self","checkUrl","apply","arguments","location","history","routeStripper","rootStripper","trailingSlash","pathStripper","prototype","atRoot","pathname","replace","root","getHash","match","href","getFragment","fragment","forcePushState","_hasPushState","_wantsHashChange","decodeURI","search","indexOf","slice","length","start","options","started","hashChange","_wantsPushState","pushState","loc","hash","replaceState","document","title","silent","loadUrl","stop","i","l","navigate","trigger","url","_updateHash","update","onChange","callback","push","hasPushState","Error","VARS_RX","absPath","path","charCodeAt","TextMatcher","text","segment","params","ANY","PathBinding","pattern","value","isModifier","index","m","exec","out","vars","prefix","substring","nextIndex","rx","mod","name","trim","matcher","v","param","RxMatcher","RegExp","$vars","compilePath","PathMapping","bindings","map","Router","navigo","LocationBar","routes","redirects","QuteRouter","quteCtx","call","ctx","install","add","keys","forEach","key","sort","a","b","r","localeCompare","get","binding","handlerFromString","to","createRedirect","from","visited","detectCycles","p1","val","undefined","String","expandVars","handler","settings","loadCb","route","QuteRouterProto","create","target","msg","channel","postAsync","$ctx","router","subscribe","data","Qute"],"mappings":"uHAOIA,EAAeC,OAAOC,OAASD,OAAOC,OAAS,SAAgBC,EAAKC,GACtE,IAAK,IAAIC,KAAQD,EACfD,EAAIE,GAAQD,EAAOC,GAErB,OAAOF,GAET,SAASG,EAAGH,EAAKI,EAAMC,GACjBL,EAAIM,aACNN,EAAI,IAAII,EAAKC,GAAMA,EACnBL,EAAII,EAAKC,GAAM,WAAYL,EAAI,IAAII,EAAKC,GAAKE,EAAOC,QACpDR,EAAIM,YAAa,KAAKF,EAAMJ,EAAII,EAAKC,KAErCL,EAAIS,iBAAkBL,EAAMC,GAAI,GAGpC,SAASK,EAAIV,EAAKI,EAAMC,GAClBL,EAAIW,aACNX,EAAIW,YAAY,KAAKP,EAAMJ,EAAII,EAAKC,IACpCL,EAAII,EAAKC,GAAM,MAEfL,EAAIY,oBAAoBR,EAAMC,GAAI,GAatC,IAAIQ,EAAU,WACZC,KAAKC,UAAY,GAEjB,IAAIC,EAAOF,KACPG,EAAWH,KAAKG,SACpBH,KAAKG,SAAW,WACdA,EAASC,MAAMF,EAAMG,iBAID,IAAXZ,IACTO,KAAKM,SAAWb,EAAOa,SACvBN,KAAKO,QAAUd,EAAOc,UAKtBC,EAAgB,eAGhBC,EAAe,aAGfC,EAAgB,MAGhBC,EAAe,OAOnB5B,EAAagB,EAAQa,UAAW,CAG9BC,OAAQ,WACN,OAAOb,KAAKM,SAASQ,SAASC,QAAQ,SAAU,SAAWf,KAAKgB,MAKlEC,QAAS,SAASxB,GAChB,IAAIyB,GAASzB,GAAUO,MAAMM,SAASa,KAAKD,MAAM,UACjD,OAAOA,EAAQA,EAAM,GAAK,IAK5BE,YAAa,SAASC,EAAUC,GAC9B,GAAgB,MAAZD,EACF,GAAIrB,KAAKuB,gBAAkBvB,KAAKwB,kBAAoBF,EAAgB,CAClED,EAAWI,UAAUzB,KAAKM,SAASQ,SAAWd,KAAKM,SAASoB,QAC5D,IAAIV,EAAOhB,KAAKgB,KAAKD,QAAQL,EAAe,IACvCW,EAASM,QAAQX,KAAOK,EAAWA,EAASO,MAAMZ,EAAKa,cAE5DR,EAAWrB,KAAKiB,UAGpB,OAAOI,EAASN,QAAQP,EAAe,KAKzCsB,MAAO,SAASC,GAId/B,KAAKgC,SAAU,EAIfhC,KAAK+B,QAAmBhD,EAAa,CAACiC,KAAM,KAAMe,GAClD/B,KAAKM,SAAmBN,KAAK+B,QAAQzB,UAAYN,KAAKM,SACtDN,KAAKO,QAAmBP,KAAK+B,QAAQxB,SAAWP,KAAKO,QACrDP,KAAKgB,KAAmBhB,KAAK+B,QAAQf,KACrChB,KAAKwB,kBAA+C,IAA5BxB,KAAK+B,QAAQE,WACrCjC,KAAKkC,kBAAqBlC,KAAK+B,QAAQI,UACvCnC,KAAKuB,iBAAsBvB,KAAK+B,QAAQI,WAAanC,KAAKO,SAAWP,KAAKO,QAAQ4B,WAClF,IAAId,EAAoBrB,KAAKoB,cAG7BpB,KAAKgB,MAAQ,IAAMhB,KAAKgB,KAAO,KAAKD,QAAQN,EAAc,KAItDT,KAAKuB,cACPlC,EAAGI,EAAQ,WAAYO,KAAKG,UAE5Bd,EAAGI,EAAQ,aAAcO,KAAKG,UAKhCH,KAAKqB,SAAWA,EAChB,IAAIe,EAAMpC,KAAKM,SAIf,GAAIN,KAAKwB,kBAAoBxB,KAAKkC,gBAAiB,CAIjD,IAAKlC,KAAKuB,gBAAkBvB,KAAKa,SAI/B,OAHAb,KAAKqB,SAAWrB,KAAKoB,YAAY,MAAM,GACvCpB,KAAKM,SAASS,QAAQf,KAAKgB,KAAO,IAAMhB,KAAKqB,WAEtC,EAIErB,KAAKuB,eAAiBvB,KAAKa,UAAYuB,EAAIC,OACpDrC,KAAKqB,SAAWrB,KAAKiB,UAAUF,QAAQP,EAAe,IACtDR,KAAKO,QAAQ+B,aAAa,GAAIC,WAASC,MAAOxC,KAAKgB,KAAOhB,KAAKqB,WAKnE,IAAKrB,KAAK+B,QAAQU,OAAQ,OAAOzC,KAAK0C,WAKxCC,KAAM,WACJ/C,EAAIH,EAAQ,WAAYO,KAAKG,UAC7BP,EAAIH,EAAQ,aAAcO,KAAKG,UAC/BH,KAAKgC,SAAU,GAMjB7B,SAAU,WAER,GADcH,KAAKoB,gBACHpB,KAAKqB,SAAU,OAAO,EACtCrB,KAAK0C,WAMPA,QAAS,SAASrB,GAChBA,EAAWrB,KAAKqB,SAAWrB,KAAKoB,YAAYC,GAE5C,IADA,IAAIpB,EAAYD,KAAKC,UACZ2C,EAAE,EAAEC,EAAE5C,EAAU4B,OAAQe,EAAEC,EAAGD,IACpC3C,EAAU2C,GAAGvB,IAWjByB,SAAU,SAASzB,EAAUU,GAC3B,IAAK/B,KAAKgC,QAAS,OAAO,EACrBD,IAAuB,IAAZA,IAAkBA,EAAU,CAACgB,UAAWhB,IAExD,IAAIiB,EAAMhD,KAAKgB,MAAQK,EAAWrB,KAAKoB,YAAYC,GAAY,KAK/D,GAFAA,EAAWA,EAASN,QAAQJ,EAAc,IAEtCX,KAAKqB,WAAaA,EAAtB,CAOA,GAHiB,MAHjBrB,KAAKqB,SAAWA,IAGe,MAAR2B,IAAaA,EAAMA,EAAIpB,MAAM,GAAI,IAGpD5B,KAAKuB,cACPvB,KAAKO,QAAQwB,EAAQhB,QAAU,eAAiB,aAAa,GAAIwB,WAASC,MAAOQ,OAI5E,CAAA,IAAIhD,KAAKwB,iBAKd,OAAOxB,KAAKM,SAASrB,OAAO+D,GAJ5BhD,KAAKiD,YAAYjD,KAAKM,SAAUe,EAAUU,EAAQhB,SAMpD,OAAIgB,EAAQgB,QAAgB/C,KAAK0C,QAAQrB,QAAzC,IAKF4B,YAAa,SAAS3C,EAAUe,EAAUN,GACxC,GAAIA,EAAS,CACX,IAAII,EAAOb,EAASa,KAAKJ,QAAQ,qBAAsB,IACvDT,EAASS,QAAQI,EAAO,IAAME,QAG9Bf,EAAS+B,KAAO,IAAMhB,KAW5BtB,EAAQa,UAAUsC,OAAS,WACzBlD,KAAK8C,SAAS1C,MAAMJ,KAAMK,YAI5BN,EAAQa,UAAUuC,SAAW,SAAUC,GACrCpD,KAAKC,UAAUoD,KAAKD,IAItBrD,EAAQa,UAAU0C,aAAe,WAE/B,IAAKtD,KAAKgC,QACR,MAAM,IAAIuB,MAAM,4CAElB,OAAOvD,KAAKuB,eCpQd,IAAIiC,EAAU,oCASd,SAASC,EAAQC,GAChB,OAA8B,KAAvBA,EAAKC,WAAW,GAAY,IAAID,EAAOA,ECR/C,IAAIF,EAAU,2BA0Bd,SAASI,EAAYC,GACpB,OAAO,SAASC,EAASC,GACxB,OAAOD,IAAYD,GAIrB,SAASG,IAAQ,OAAO,EAGxB,SAASC,EAAYC,EAASC,GAE7B,SAASC,EAAWV,EAAMW,GACzB,GAAIX,EAAK7B,SAAWwC,EAAM,GAAkC,KAA7BX,EAAKC,WAAWU,EAAM,GACpD,OAAQX,EAAKC,WAAWU,IACvB,KAAK,GAAI,OAAO,EAChB,KAAK,GAAI,OAAO,EAChB,KAAK,GAAI,OAAO,EAGlB,OAAO,EAmDRrE,KAAKkE,QAAUT,EAAQS,GACvBlE,KAAKkB,MAjDL,SAAqBwC,GACpB,GAAa,OAATA,EAAe,OAAOM,EAE1B,IAAW,IADHN,EAAK/B,QAAQ,KACP,OAAOiC,EAAYF,GAEjC,IAAIY,EAAId,EAAQe,KAAKb,GAErB,IAAKY,EAAG,OAAOV,EAAYF,GAG3B,IADA,IAAIc,EAAM,GAAIC,EAAO,GACdH,GAAG,CACT,IAAII,EAAmB,EAAVJ,EAAED,MAAYX,EAAKiB,UAAU,EAAGL,EAAED,OAAOtD,QAAQ,wBAAyB,QAAU,KAC7F6D,EAAYN,EAAED,MAAMC,EAAE,GAAGzC,OAAQgD,EAAKP,EAAE,IAAM,QAE9CQ,GADSpB,EAAKC,WAAWiB,GACnBR,EAAWV,EAAMkB,IAE3B,GAAIE,EAAK,CACR,IAAIJ,GAAiD,KAAvCA,EAAOf,WAAWe,EAAO7C,OAAO,GAI7C,MAAM,IAAI0B,MAAM,gEAAgEG,GAFhFgB,EAASA,EAAOC,UAAU,EAAGD,EAAO7C,OAAO,GAK5C+C,IACY,IAARE,EACHD,EAAK,QAAQA,EAAG,MACE,IAARC,EACVD,EAAK,QAAQA,EAAG,MACE,IAARC,IACVD,EAAK,QAAQA,EAAG,YAGjBA,EAAK,IAAIA,EAAG,IAEbJ,EAAKpB,KAAK,CAAC0B,KAAMT,EAAE,GAAGU,OAAQF,IAAKA,IACnCN,GAAOE,EAASA,EAAOG,EAAKA,EAC5BnB,EAAOA,EAAKiB,UAAUC,GACtBN,EAAId,EAAQe,KAAKb,GAEdA,EAAK7B,SACR2C,GAAOd,EAAK3C,QAAQ,wBAAyB,SAE9C,IAAIkE,EAzFN,SAAmBJ,EAAIJ,GACtB,OAAO,SAASX,EAASC,GACxB,IAAIO,EAAIO,EAAGN,KAAKT,GAChB,GAAIQ,EAAG,CACN,IAAK,IAAI1B,EAAE,EAAGC,EAAEyB,EAAEzC,OAAQe,EAAEC,EAAGD,IAAK,CACnC,IAAIsC,EAAIT,EAAK7B,EAAE,GACf,GAAIsC,EAAG,CACN,IAAIC,EAAQb,EAAE1B,GACVuC,IACCD,EAAEJ,KACuB,KAAxBK,EAAMxB,WAAW,KACpBwB,EAAQA,EAAMR,UAAU,IAG1BZ,EAAOmB,EAAEH,MAAQI,IAIpB,OAAO,EAER,OAAO,GAqEOC,CAAU,IAAIC,OAAOb,GAAMC,GAEzC,OADAQ,EAAQK,MAAQb,EAAK5C,OACdoD,EAIKM,CAAYvF,KAAKkE,SAC9BlE,KAAKyE,KAAOzE,KAAKkB,MAAMoE,OAAS,EAChCtF,KAAKmE,MAAQA,EAGd,SAASqB,EAAYC,GACpBzF,KAAKyF,SAAW,GAChBA,GAAYzF,KAAK0F,IAAID,GC1FtB,SAASE,EAAOF,GAEfzF,KAAK4F,OAAS,IAAIC,EAClB7F,KAAK8F,OAAS,IAAIN,EAClBxF,KAAK+F,UAAY,GAEjBN,GAAYzF,KAAK0F,IAAID,GCpBtB,SAASO,EAAWP,EAAUQ,GAC7BN,EAAOO,KAAKlG,KAAMyF,GAClBzF,KAAKmG,IAAM,KACXF,GAAWjG,KAAKoG,QAAQH,GF8BzBjC,EAAIsB,MAAQ,IA0EZE,EAAY5E,UAAY,CACvByF,IAAK,SAAS3C,EAAMS,GACnBnE,KAAKyF,SAASpC,KAAK,IAAIY,EAAYP,EAAMS,KAE1CuB,IAAK,SAASD,GACb,GAAIA,EAAU,CACb,IAAIvF,EAAOF,KACXhB,OAAOsH,KAAKb,GAAUc,QAAQ,SAASC,GACtCtG,EAAKmG,IAAIG,EAAKf,EAASe,MAGxBxG,KAAKyG,SAGPA,KAAM,WACLzG,KAAKyF,SAASgB,KAAK,SAASC,EAAGC,GAC9B,IAAIC,EAAIF,EAAEjC,KAAOkC,EAAElC,KACnB,OAAOmC,GAAQD,EAAEzC,QAAQ2C,cAAcH,EAAExC,YAG3C4C,IAAK,SAASpD,GACbA,EAAOD,EAAQC,GAGf,IAFA,IAAIK,EAAS,GACT0B,EAAWzF,KAAKyF,SACX7C,EAAE,EAAEC,EAAE4C,EAAS5D,OAAQe,EAAEC,EAAGD,IAAK,CACzC,IAAImE,EAAUtB,EAAS7C,GACvB,GAAImE,EAAQ7F,MAAMwC,EAAMK,GACvB,MAAO,CAACgD,EAAQ5C,MAAOJ,GAGzB,OAAO,OClHT4B,EAAO/E,UAAY,CAClBoG,kBAAmB,SAASC,GAC3B,OAAO,MAERC,eAAgB,SAASxD,EAAMuD,GAC9BA,EAAKxD,EAAQwD,GACbjH,KAAK+F,UAAUrC,GAAQuD,EA1BzB,SAAsBlB,EAAWoB,GAChC,IAAIC,EAAU,GACdA,EAAQD,IAAQ,EAEhB,IADA,IAAIF,EAAKlB,EAAUoB,GACZF,GAAI,CACV,GAAIG,EAAQH,GAAK,MAAM,IAAI1D,MAAM,+BAA+B4D,EAAK,SAASF,EAAG,KACjFG,EAAQH,IAAM,EACdA,EAAKlB,EAAUkB,IAoBfI,CAAarH,KAAK+F,WAClB,IAAI7F,EAAOF,KACX,OAAO,SAAS0D,EAAMK,GACrB7D,EAAK4C,SFjCR,SAAoBe,EAAMY,GACzB,OAAOZ,EAAK9C,QAAQyC,EAAS,SAASc,EAAGgD,GACxC,IAAIC,EAAM9C,EAAK6C,GACf,YAAeE,IAARD,EAAoBjD,EAAImD,OAAOF,KE8BvBG,CAAWT,EAAIlD,IAAS,KAGxC2B,IAAK,SAASD,GACb,GAAIA,EAAU,CACb,IAAIvF,EAAOF,KACXhB,OAAOsH,KAAKb,GAAUc,QAAQ,SAASC,GACtCtG,EAAKmG,IAAIG,EAAKf,EAASe,MAGzB,OAAOxG,MAERqG,IAAK,SAAS3C,EAAMuD,GACnBvD,EAAOD,EAAQC,GACf,IAAIiE,EAAU,KAYd,MAXkB,iBAAPV,KAEVU,EAAU3H,KAAKgH,kBAAkBtD,EAAMuD,MAEtCU,EAAU3H,KAAKkH,eAAexD,EAAMuD,KAGjCU,IACJA,EAAUV,GAEXjH,KAAK8F,OAAOO,IAAI3C,EAAMiE,GACf3H,MAER8B,MAAO,SAAS8F,GACf,IAAK5H,KAAK8F,OAAOL,SAAS5D,OAAQ,MAAM,IAAI0B,MAAM,kBAClDvD,KAAK8F,OAAOW,OAEZ,IAAIvG,EAAOF,KACXA,KAAK4F,OAAOzC,SAAS,SAASO,GAC7B,IAAIkD,EAAI1G,EAAK4F,OAAOgB,IAAIpD,GACxB,IAAIkD,EAGH,MAAM,IAAIrD,MAAM,uBAAuBG,EAAK,KAF5CkD,EAAE,GAAGlD,EAAMkD,EAAE,MAKf,IAAIiB,EAAS,WACZ3H,EAAK0F,OAAO9D,MAAM8F,GAClBnI,EAAOK,oBAAoB,OAAQ+H,IAGpC,OADApI,EAAOE,iBAAiB,OAAQkI,GACzB7H,MAER2C,KAAM,WACL3C,KAAK4F,OAAOjD,QAEbG,SAAU,SAASY,EAAM3C,GACxB2C,EAAOD,EAAQC,GACV1D,KAAK4F,OAAOtC,iBAChBI,EAAO,IAAIA,GAEZ1D,KAAK4F,OAAO9C,SAASY,EAAM3C,EAAU,CAACA,SAAQ,QAAQyG,IAEvDM,MAAO,SAASpE,EAAM3C,GACrBf,KAAK8C,SAASY,EAAM3C,IAErBoC,SAAU,SAASC,GAClBpD,KAAK4F,OAAOzC,SAAS,SAASO,GAC7BN,EAASK,EAAQC,OAGnBA,KAAM,WACL,OAAOD,EAAQzD,KAAK4F,OAAOxE,iBC9F7B,IAAI2G,EAAkB/I,OAAOgJ,OAAOrC,EAAO/E,kBAC3CmH,EAAgBf,kBAAoB,SAAStD,EAAMuD,GAClD,GAA2B,UAAvBA,EAAGtC,UAAU,EAAG,GAYpB,OAAO,KAXN,IAAK3E,KAAKmG,IAAK,MAAM,IAAI5C,MAAM,kDAC/B,IAAI0E,EAAShB,EAAGtC,UAAU,GACtB/B,EAAIqF,EAAOtG,QAAQ,KACvB,IAAW,IAAPiB,EAAU,MAAM,IAAIW,MAAM,8EAA8E0D,GAC5G,IAAIiB,EAAMD,EAAOtD,UAAU/B,EAAE,GACzBuF,EAAUF,EAAOtD,UAAU,EAAI/B,GAC/BuD,EAAMnG,KAAKmG,IACf,OAAO,SAASzC,EAAMK,GACrBoC,EAAIiC,UAAUV,WAAWS,EAASpE,GAAS2D,WAAWQ,EAAKnE,GAASA,KAKvEgE,EAAgB3B,QAAU,SAASD,GAClC,GAAInG,KAAKmG,IAAK,MAAM,IAAI5C,MAAM,kCAQ9B,OAPI4C,EAAIkC,OAAMlC,EAAMA,EAAIkC,OACxBrI,KAAKmG,IAAMA,GACPmC,OAAStI,KACbmG,EAAIoC,UAAU,QAAS,SAASL,EAAKM,GAEpCrC,EAAImC,OAAOxF,SAASoF,EAAKM,KAEnBxI,MAGRgG,EAAWpF,UAAYmH,EAEvBU,EAAK9C,OAASK"}