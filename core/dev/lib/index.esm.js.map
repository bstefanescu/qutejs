{"version":3,"file":"index.esm.js","sources":["../src/loader.js","../src/error-dev.js","../src/index.js"],"sourcesContent":["import window, {document} from '@qutejs/window';\nimport Qute from '@qutejs/runtime';\nimport Compiler from '@qutejs/compiler';\nimport {capitalizeFirst, kebabToCamel} from '@qutejs/commons';\n\nvar IMPORT_RX = /^\\s*import\\s+(\\S+)\\s+from\\s+(?:(\\\"[^\"]+\\\")|(\\'[^']+\\')|([^\"'][^;\\s]*));?$/mg;\nvar EXPORT_RX = /^\\s*export\\s+default\\s+/m;\n\n\nexport default function Loader() {\n\tthis.createScript = function(code, name) {\n\t\tvar deps = {};\n\t\tcode = code.replace(IMPORT_RX, function(m, p1, p2, p3, p4) {\n\t\t\tvar path = p2 || p3 || p4;\n\n\t\t\tif (path) {\n\t\t\t\tif (path[0] === '.' && path[1] === '/') {\n\t\t\t\t\t//TODO resolve file path\n\t\t\t\t\tdeps[p1] = path;\n\t\t\t\t} else if (p1 !== 'Qute') {\n\t\t\t\t\tconsole.warning('Imports are ignored in dev version!')\n\t\t\t\t\tthrow new Error('Only relative paths are supported for import statements: '+m.trim());\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn m.replace('import ', '//import ');\n\t\t});\n\t\tvar hasExport = false;\n\t\tcode = code.replace(EXPORT_RX, function(m) {\n\t\t\thasExport = true;\n\t\t\treturn \"var __DEFAULT_EXPORT__ = \";\n\t\t});\n\t\tcode = new Compiler().transpile(code);\n\t\t// apply buble if needed\n\t\tif (window.buble && window.buble.transform) {\n\t\t\tcode = window.buble.transform(code).code;\n\t\t}\n\t\tif (hasExport) code += '\\nreturn __DEFAULT_EXPORT__;\\n';\n\t\t// for now script deps are expected to be declared above the script - otherwise compiling will fail\n\t\tvar comp = (new Function(code))();\n\n\t\tvar script = new Script();\n\t\tscript.name = comp ? name || capitalizeFirst(kebabToCamel(comp.prototype.$tag)) : null;\n\t\tscript.code = code;\n\t\tscript.deps = deps;\n\t\tscript.comp = comp;\n\n\t\treturn script;\n\t}\n\n\tthis.loadScript = function(scriptEl, wnd) {\n\t\treturn this.createScript(scriptEl.textContent, scriptEl.getAttribute('name')).load(wnd);\n\t}\n\n\tthis.load = function(wnd) {\n\t\tvar scripts = (wnd ? wnd.document : document).querySelectorAll('script[type=\"text/jsq\"]');\n\t\tfor (var i=0,l=scripts.length; i<l; i++) {\n\t\t\tthis.loadScript(scripts[i], wnd);\n\t\t}\n\t}\n\n}\n\nfunction Script() {\n\tthis.name = null;\n\tthis.code = null;\n\tthis.comp = null;\n\tthis.deps = null;\n\n\tthis.load = function(wnd) {\n\t\tif (!wnd) wnd = window;\n\t\tif (this.name) window[this.name] = this.comp;\n\t\treturn this;\n\t}\n\n/*\n\tthis.resolve = function(path) {\n\t\tif (!this.file) return null;\n\t\tvar parts = this.file.split('/').pop();\n\t\tpath.split('/').forEach(function(part) {\n\t\t\tif (part === '..') {\n\t\t\t\tparts.pop();\n\t\t\t} else if (part !== '.') {\n\t\t\t\tparts.push(part);\n\t\t\t}\n\t\t});\n\t\treturn parts.join('/');\n\t}\n*/\n\n}\n\n\n","import Qute from '@qutejs/runtime';\n\nvar PRINT_RX = /%s/g;\nfunction print(text) {\n\tvar i = 1, args = arguments;\n\treturn text.replace(PRINT_RX, function(match, p1) {\n\t\treturn args[i++];\n\t});\n}\n\nQute.ERR.resolve = function (code) {\n\tvar text = errors[code];\n\tif (!text) text = \"Qute Error: \"+code;\n\telse {\n\t\tvar args = Array.prototype.slice.call(arguments);\n\t\targs[0] = text;\n\t\ttext = print.apply(null, args);\n\t}\n\tthrow new Error(text);\n}\n\nvar errors = {\n\n\n\t// ------------------------------------------------------\n\t// index.js\n\t/*\n\t1: \"Unsupported tag: '%s'\",\n\t2: \"template 'name' is required\",\n\t*/\n\t// runtime.js\n\t5: \"Usage: Qute(tag[, viewModelDefinition])\",\n\t// list.js\n\t10: \"Broken list fragment. Ignoring updates\",\n\t11: \"Invalid index: '%s'. Length is %s\",\n\t12: \"Invalid insertion index: '%s'. Length is %s'\",\n\t13: \"Remove anchor is invalid: '%s'. Length is %s\",\n\t14: \"Invalid move from index: '%s'. Length is %s\",\n\t15: \"Invalid move to index: '%s'. Length is %s\",\n\t// rendering.js\n\t20: \"Invalid dynamic component. Should be a ViewModel constructor or a xtag name\",\n\t// no more used\n\t//21: \"Found a 'nested' element without a 'name' attribute\",\n\t23: \"Could not resolve ViewModel at runtime for tag: '%s'\",\n\t24: \"dynamic for directive accepts only List instances and not regular arrays\",\n\t25: \"List properties cannot be used with the static for directive\",\n\t26: \"Bug? Unknown xattr name: %s\",\n\t27: \"Unknown converter: %s\",\n\t28: \"x-channel cannot be used on regular DOM elements: %s\",\n\t// update.js\n\t30: \"Possible infinite loop detected\",\n\t// vm.js\n\t31: \"Incompatible assign for list property: %s\",\n\t32: \"No render function defined for the ViewModel!\",\n\t33: \"VM is already mounted!\",\n\t34: \"VM is not mounted!\",\n\t35: \"View not connected\",\n\t36: \"No template found for tag '%s'\",\n\t37: \"Failed to install plugin %s. Plugins must provide an install(ctx) method.\",\n\t38: 'Posting message to unknown topic %s',\n\t39: \"x-channel used on a VM not defining channels: %s\",\n\t//36: \"Cannot unmount a child view\",\n\t// compiler.js\n\t/*\n\t50: \"<tag> requires an 'is' attribute\",\n\t51: \"Invalid for expression\",\n\t52: \"For directive take exatcly one attribute\",\n\t53: \"if has only one required attribute: value='expr' and an optional one: @change='onChangeHandler'\",\n\t54: \"slot node take zero or one 'name' parameter\",\n\t55: \"the root node must have a single children element\",\n\t56: \"Invalid if attribute '%s'\",\n\t57: \"Closing tag '%s' doesn't match the start tag '%s'\",\n\t58: \"Static node (x-html) must have some content\",\n\t*/\n\t// rollup-plugin.js\n\t/*\n\t60: \"Tag not supported: '%s'\",\n\t61: \"The <template> tag requires a name attribute\",\n\t62: \"Unresolved tag: '%s'. Please import the implementation in camel case! Ex: \\nimport '%s' from 'some-module'\",\n\t*/\n\t// xtags-parser.js\n\t/*\n\t70: \"Bug?\",\n\t72: \"Invalid qute file: No closing </'%s'> found.\",\n\t73: \"Invalid qute file: Found closing tag '%s'. Expecting '%s'\",\n\t*/\n\t// binding.js\n\t//80: \"Invalid x-radio expression: '%s'. Must be a tag name with a class. Ex: li.active\"\n};\n\nexport default ERR;\n","import {document} from '@qutejs/window';\nimport Loader from './loader.js'\nimport ERR from './error-dev.js';\nimport Qute from '@qutejs/runtime';\nimport Compiler from '@qutejs/compiler';\n\n\nQute.Compiler = Compiler;\nQute.compile = function(text, symbols) {\n\treturn new Compiler().compileFn(text, symbols);\n}\n\nQute.css('x-tag { display:none; }\\n');\n\nfunction loadXTag(text) {\n\tnew Compiler().loadXTags(text, function(xtagName, xtagFn, isCompiled) {\n\t\tQute.register(xtagName, xtagFn, isCompiled);\n\t});\n}\n// load templates\nQute.load = function(textOrId) {\n\tif (!textOrId) {\n\t\tvar xtags = document.getElementsByTagName('x-tag');\n\t    for (var i=0,l=xtags.length; i<l; i++) {\n\t    \tloadXTag(xtags[i].innerHTML);\n\t    }\n\t} else {\n\t\tloadXTag(textOrId[0] === '#' ? document.getElementById(textOrId.substring(1)).textContent : textOrId);\n\t}\n}\n\nQute.Loader = Loader;\nQute.loadScripts = function() {\n\tnew Loader().load();\n}\nexport default Qute;\n"],"names":[],"mappings":"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"}